<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SECURA | Gestion des Tables</title>
    <link rel="icon" href="assets/images/icon.png" type="image/x-icon">
    
    <!-- Styles et Polices -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Styles locaux -->
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/loading.css">
    <link rel="stylesheet" href="css/dash.css">
    
    <!-- SweetAlert2 -->
    <link rel="preload" href="js/auth-check.js" as="script">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
        /* ==========================================
           VARIABLES GLOBALES POUR LES THÈMES
           ========================================== */
        :root {
            /* Thème clair (par défaut) */
            --primary: #D97706;
            --primary-dark: #B45309;
            --primary-light: #F59E0B;
            --dark: #0A0A0A;
            --dark-card: #121212;
            --dark-elevated: #1A1A1A;
            --gradient: linear-gradient(135deg, #B45309 0%, #D97706 50%, #F59E0B 100%);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --success: #10B981;
            --danger: #EF4444;
            --warning: #F59E0B;
            --info: #3B82F6;
            --border-radius: 0.5rem;
            --border-radius-sm: 0.375rem;
            --card-shadow: 0 12px 40px rgba(0,0,0,0.4);
            
            /* Variables pour thème clair */
            --body-bg: #ffffff;
            --text-color: #333333;
            --card-bg: #f8f9fa;
            --input-bg: #ffffff;
            --input-border: #e0e0e0;
            --input-text: #333333;
            --placeholder-color: #666666;
            --border-color: rgba(0, 0, 0, 0.1);
            --hover-bg: rgba(0, 0, 0, 0.05);
            --shadow-color: rgba(0, 0, 0, 0.1);
            --progress-bg: rgba(0, 0, 0, 0.05);
        }

        /* Variables pour thème sombre */
        .dark-theme {
            --body-bg: #0A0A0A;
            --text-color: #ffffff;
            --card-bg: #121212;
            --input-bg: rgba(255, 255, 255, 0.04);
            --input-border: rgba(255, 255, 255, 0.12);
            --input-text: #ffffff;
            --placeholder-color: rgba(255, 255, 255, 0.4);
            --border-color: rgba(255, 255, 255, 0.1);
            --hover-bg: rgba(255, 255, 255, 0.05);
            --shadow-color: rgba(0, 0, 0, 0.5);
            --progress-bg: rgba(0, 0, 0, 0.2);
        }

        /* ==========================================
           STYLES DE BASE
           ========================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--body-bg);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
            
        }

        body {
            background-image:
                radial-gradient(circle at 10% 20%, rgba(217, 119, 6, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 90% 80%, rgba(217, 119, 6, 0.15) 0%, transparent 30%);
        }

        .dark-theme body {
            background-image:
                radial-gradient(circle at 10% 20%, rgba(217, 119, 6, 0.08) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(217, 119, 6, 0.08) 0%, transparent 40%);
        }

        /* === CONTENEUR PRINCIPAL === */
        .tables-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            margin-top: 100px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }

        /* === EN-TÊTE DE PAGE AMÉLIORÉ === */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-title h1 {
            font-size: 2rem;
            font-weight: 700;
            background: var(--gradient);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .page-title .event-name {
            font-size: 1rem;
            color: var(--text-color);
            opacity: 0.7;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .back-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--hover-bg);
            border-radius: var(--border-radius-sm);
            color: var(--text-color);
            text-decoration: none;
            font-size: 0.9rem;
            
        }

        .back-link:hover {
            background: var(--primary);
            color: white;
            transform: translateX(-3px);
        }

        .page-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* === BOUTONS === */
        .btn {
            padding: 12px 24px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.25);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(217, 119, 6, 0.35);
        }

        .btn-secondary {
            background: var(--hover-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--input-bg);
            color: var(--text-color);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #0DA673;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            background: #DC2626;
            transform: translateY(-2px);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover:not(:disabled) {
            background: #2563EB;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-xs {
            padding: 6px 12px;
            font-size: 0.75rem;
            gap: 5px;
        }

        /* === VUE TABLEAU DES TABLES === */
        .tables-table-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 30px var(--shadow-color);
            min-height: 500px;
            display: none;
        }

        .tables-table {
            width: 100%;
            border-collapse: collapse;
        }

        .tables-table th {
            background: var(--hover-bg);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
        }

        .tables-table td {
            padding: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .tables-table tbody tr:hover {
            background: rgba(217, 119, 6, 0.05);
        }

        /* === VUE VISUELLE DES TABLES (PLAN DE SALLE) === */
        .visual-layout-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 30px var(--shadow-color);
            min-height: 500px;
            display: none;
        }

        .layout-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .layout-view {
            display: flex;
            gap: 15px;
        }

        .layout-btn {
            padding: 10px 20px;
            border-radius: var(--border-radius-sm);
            background: var(--hover-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
            cursor: pointer;
            
        }

        .layout-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .layout-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .visual-layout {
            display: flex;
            flex-direction: column;
            gap: 40px;
            max-width: 100%;
            overflow-x: auto;
            padding: 20px;
        }

        .table-row {
            display: flex;
            gap: 40px;
            align-items: center;
            justify-content: center;
        }

        /* === REPRÉSENTATION VISUELLE D'UNE TABLE === */
        .table-visual {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .table-shape {
            width: 120px;
            height: 80px;
            background: var(--card-bg);
            border: 2px solid var(--primary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            
            cursor: pointer;
        }

        .table-shape:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(217, 119, 6, 0.2);
        }

        .table-shape.full {
            border-color: var(--danger);
            background: rgba(239, 68, 68, 0.05);
        }

        .table-shape.empty {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .table-visual-info {
            text-align: center;
        }

        .table-visual-number {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .table-visual-name {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        .table-visual-capacity {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.5;
        }

        /* === CHAISES AUTOUR DE LA TABLE === */
        .chairs-container {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }

        .chair {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            color: white;
            
        }

        .chair.empty {
            background: #666;
            opacity: 0.3;
        }

        .chair.occupied {
            background: var(--primary);
        }

        .chair.vip {
            background: var(--warning);
        }

        /* === VUE STATISTIQUES === */
        .stats-view-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 30px var(--shadow-color);
            min-height: 500px;
            display: none;
        }

        .stats-view-container.active {
            display: block;
        }

        .stats-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .stat-card-advanced {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 30px var(--shadow-color);
            
            position: relative;
            overflow: hidden;
        }

        .stat-card-advanced:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px var(--shadow-color);
        }

        .stat-card-advanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient);
        }

        .stat-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 10px;
            background: var(--gradient);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat-details {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        /* === CHARTS === */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 30px var(--shadow-color);
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-placeholder {
            width: 100%;
            height: 300px;
            background: var(--hover-bg);
            border-radius: var(--border-radius-sm);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-color);
            opacity: 0.5;
        }

        /* === ANIMATIONS === */
        .animate-fade-in {
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-slide-in {
            animation: slideIn 0.4s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* === RESPONSIVE === */
        @media (max-width: 1200px) {
            .tables-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .tables-main {
                margin-top: 80px;
                padding: 15px;
            }

            .page-header {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }

            .page-actions {
                width: 100%;
                justify-content: center;
            }

            .charts-container {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .page-title h1 {
                font-size: 1.5rem;
            }

            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }

        /* === VUE GRID DES TABLES === */
        .tables-grid-container {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 30px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 30px var(--shadow-color);
            min-height: 500px;
        }

        .grid-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .grid-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.4rem;
        }

        .tables-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        /* === CARTE DE TABLE AVEC APERÇU DÉTAILLÉ === */
        .table-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            overflow: hidden;
            
            cursor: pointer;
            position: relative;
        }

        .table-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px var(--shadow-color);
            border-color: var(--primary);
        }

        .table-card.full {
            border-color: var(--danger);
        }

        .table-card.empty {
            border-color: var(--success);
        }

        .table-card-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: rgba(217, 119, 6, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-number {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .table-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 5px 0;
        }

        .table-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-available {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-full {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .table-card-content {
            padding: 20px;
        }

        .table-capacity {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .capacity-bar {
            flex: 1;
            height: 8px;
            background: var(--hover-bg);
            border-radius: 4px;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            background: var(--gradient);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .table-location {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-color);
            opacity: 0.7;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .table-guests {
            margin-top: 15px;
        }

        .guests-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-color);
            opacity: 0.7;
        }

        .guests-list {
            max-height: 150px;
            overflow-y: auto;
        }

        .guest-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: var(--border-radius-sm);
            background: var(--hover-bg);
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .guest-item:last-child {
            margin-bottom: 0;
        }

        .guest-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: var(--gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .guest-info {
            flex: 1;
        }

        .guest-name {
            font-weight: 500;
        }

        .guest-seats {
            color: var(--text-color);
            opacity: 0.7;
            font-size: 0.8rem;
        }

        .table-card-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.02);
        }

        .dark-theme .table-card-footer {
            background: rgba(255, 255, 255, 0.02);
        }

        .table-actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            
        }

        .action-btn:hover {
            transform: scale(1.1);
            background: var(--primary);
            color: white;
        }

        .action-btn.edit:hover {
            background: var(--info);
        }

        .action-btn.delete:hover {
            background: var(--danger);
        }

        .action-btn.qr:hover {
            background: var(--success);
        }

        /* === TOGGLE DE VUE === */
        .view-toggle {
            display: flex;
            gap: 5px;
            background: var(--hover-bg);
            padding: 5px;
            border-radius: var(--border-radius-sm);
        }

        .view-btn {
            padding: 10px 20px;
            border-radius: var(--border-radius-sm);
            background: transparent;
            border: none;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-color);
            opacity: 0.7;
            
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .view-btn:hover {
            background: var(--hover-bg);
            opacity: 1;
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
            opacity: 1;
        }

        /* === FILTRES RAPIDES === */
        .quick-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-chip {
            padding: 8px 16px;
            background: var(--hover-bg);
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            
            border: 2px solid transparent;
        }

        .filter-chip:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-1px);
        }

        .filter-chip.active {
            background: var(--primary);
            color: white;
            border-color: white;
        }

        /* === BARRE DE RECHERCHE === */
        .search-container {
            position: relative;
            width: 300px;
        }

        @media (max-width: 768px) {
            .search-container {
                width: 100%;
            }
        }

        .search-container i {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--placeholder-color);
        }

        .search-container input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            font-size: 1rem;
            background: var(--input-bg);
            color: var(--input-text);
            
        }

        .search-container input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
        }

        /* === BARRE D'ACTIONS === */
        .actions-bar {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 25px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 30px var(--shadow-color);
        }

        .actions-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .actions-left, .actions-right {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* === VUE ACCUEIL DES ÉVÉNEMENTS === */
        .events-home-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            margin-top: 100px;
            max-width: 1400px;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }

        .events-home-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .events-home-header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .events-home-header p {
            color: var(--text-color);
            opacity: 0.7;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Mini version des cartes d'événements */
        .events-mini-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 10px;
            margin-bottom: 40px;
        }

        .event-mini-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            overflow: hidden;
            
            cursor: pointer;
            position: relative;
            height: 180px;
        }

        .event-mini-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px var(--shadow-color);
            border-color: var(--primary);
        }

        .event-mini-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            background: rgba(217, 119, 6, 0.05);
            height: 60px;
            overflow: hidden;
        }

        .event-mini-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--primary);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .event-content {
            background: rgb(0 0 0 / 75%);
            backdrop-filter: blur(2px);
        }

        .event-mini-meta {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .event-mini-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        .event-mini-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid var(--border-color);
        }

        .event-mini-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .event-mini-stat-number {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .event-mini-stat-label {
            font-size: 0.75rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        /* Vue tableau réduite */
        .events-mini-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: 0 8px 30px var(--shadow-color);
        }

        .events-mini-table th {
            background: var(--hover-bg);
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: var(--text-color);
            font-size: 0.9rem;
            border-bottom: 2px solid var(--border-color);
        }

        .events-mini-table td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
            cursor: pointer;
        }

        .events-mini-table tbody tr:hover {
            background: rgba(217, 119, 6, 0.05);
        }

        .events-mini-table .event-cell {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .event-cell-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }

        .event-cell-info {
            flex: 1;
            min-width: 0;
        }

        .event-cell-name {
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 2px;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .event-cell-location {
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.7;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .event-cell-date {
            white-space: nowrap;
            font-size: 0.85rem;
        }

        .event-cell-type {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            background: var(--primary);
            display: inline-block;
        }

        .event-cell-stats {
            display: flex;
            gap: 15px;
        }

        .event-cell-stat {
            text-align: center;
            min-width: 50px;
        }

        .event-cell-stat-number {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary);
            display: block;
        }

        .event-cell-stat-label {
            font-size: 0.75rem;
            color: var(--text-color);
            opacity: 0.7;
        }

        /* Toggle vue */
        .view-mode-toggle {
            display: flex;
            gap: 5px;
            background: var(--hover-bg);
            padding: 5px;
            border-radius: var(--border-radius-sm);
            margin: 0 auto 30px;
            width: fit-content;
        }

        .view-mode-btn {
            padding: 8px 20px;
            border-radius: var(--border-radius-sm);
            background: transparent;
            border: none;
            font-weight: 600;
            cursor: pointer;
            color: var(--text-color);
            opacity: 0.7;
            
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .view-mode-btn:hover {
            background: var(--hover-bg);
            opacity: 1;
        }

        .view-mode-btn.active {
            background: var(--primary);
            color: white;
            opacity: 1;
        }

        /* Message d'accueil */
        .home-message {
            text-align: center;
            padding: 60px 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .home-message i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
            opacity: 0.8;
        }

        .home-message h2 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .home-message p {
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        /* === EMPTY STATES === */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-color);
            opacity: 0.5;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .empty-state p {
            margin-bottom: 25px;
            font-size: 0.95rem;
        }

        /* === INDICATEUR DE STATUT === */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-inactive {
            background: rgba(107, 114, 128, 0.2);
            color: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        .status-draft {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        /* === BADGES === */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .badge-primary {
            background: rgba(217, 119, 6, 0.2);
            color: var(--primary);
            border: 1px solid rgba(217, 119, 6, 0.3);
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* === LOADER === */
        .loader {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 50px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* === PAGINATION === */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .page-btn {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--hover-bg);
            border: none;
            cursor: pointer;
            
            color: var(--text-color);
        }

        .page-btn:hover {
            background: var(--primary);
            color: white;
        }

        .page-btn.active {
            background: var(--primary);
            color: white;
        }

        .page-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .page-btn.disabled:hover {
            background: var(--hover-bg);
            color: var(--text-color);
        }

        /* === MODAL DE CRÉATION EN ÉTAPES === */
        .table-creation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            overflow-y: auto;
        }

        .table-creation-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .table-creation-wrapper {
            display: flex;
            width: 90%;
            max-width: 1200px;
            height: 85vh;
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(60px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Panel de progression vertical */
        .creation-progress-panel {
            flex: 0 0 350px;
            background: var(--progress-bg);
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border-color);
            
            position: relative;
        }

        .progress-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 40px;
            letter-spacing: 0.5px;
            
        }

        .vertical-steps {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: auto;
            position: relative;
        }

        /* Ligne de progression verticale */
        .vertical-steps::before {
            content: '';
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 1;
        }

        .dark-theme .vertical-steps::before {
            background: rgba(255, 255, 255, 0.1);
        }

        .vertical-step {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 18px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            
            position: relative;
            z-index: 2;
            background: transparent;
        }

        .vertical-step::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--hover-bg);
            border: 3px solid var(--border-color);
            
            z-index: 3;
        }

        .vertical-step.active::before {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(217, 119, 6, 0.15);
        }

        .vertical-step.completed::before {
            background: var(--success);
            border-color: var(--success);
        }

        .vertical-step-info {
            flex: 1;
            opacity: 0.5;
            
            transform: translateX(30px);
        }

        .vertical-step.active .vertical-step-info {
            opacity: 1;
            transform: translateX(0);
        }

        .vertical-step.completed .vertical-step-info {
            opacity: 0.8;
        }

        .vertical-step-label {
            display: block;
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--text-color);
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .vertical-step.active .vertical-step-label {
            color: var(--primary-light);
        }

        .vertical-step-description {
            display: block;
            font-size: 0.8rem;
            color: var(--text-color);
            opacity: 0.5;
            line-height: 1.3;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
        }

        .vertical-step:hover .vertical-step-description {
            max-height: 100px;
            opacity: 0.7;
        }

        .vertical-step.active .vertical-step-description {
            max-height: 100px;
            opacity: 0.7;
        }

        .creation-progress-info {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .creation-progress-text {
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.5;
            margin-bottom: 8px;
            
        }

        .creation-progress-percentage {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Panel de formulaire */
        .creation-form-panel {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
        }

        .creation-header {
            margin-bottom: 40px;
        }

        .creation-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .creation-subtitle {
            font-size: 0.95rem;
            color: var(--text-color);
            opacity: 0.6;
            line-height: 1.5;
            
        }

        /* Contenu des étapes */
        .creation-step-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 40px;
            opacity: 0;
            transform: translateX(40px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            overflow-y: auto;
        }

        .creation-step-content.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }

        .creation-step-content::-webkit-scrollbar {
            width: 6px;
        }

        .creation-step-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }

        .dark-theme .creation-step-content::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
        }

        .creation-step-content::-webkit-scrollbar-thumb {
            background: var(--gradient);
            border-radius: 3px;
        }

        /* === FORMULAIRES === */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-light);
            margin-bottom: 8px;
        }

        .form-control {
            width: 100%;
            background: var(--input-bg);
            border: 1.5px solid var(--input-border);
            color: var(--input-text);
            padding: 12px 16px;
            border-radius: var(--border-radius-sm);
            font-size: 0.95rem;
            
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background: var(--input-bg);
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
        }

        .form-control::placeholder {
            color: var(--placeholder-color);
            font-size: 0.9rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-help {
            display: block;
            margin-top: 6px;
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.5;
        }

        .required {
            color: var(--danger);
            font-size: 1.2rem;
            line-height: 1;
        }

        /* Étape de création multiple */
        .multiple-tables-form {
            background: var(--hover-bg);
            border-radius: var(--border-radius-sm);
            padding: 20px;
            margin-bottom: 20px;
        }

        .table-item {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-sm);
            padding: 15px;
            margin-bottom: 15px;
            
        }

        .table-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .table-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border-color);
        }

        .table-item-number {
            font-weight: 600;
            color: var(--primary);
        }

        .remove-table-btn {
            background: var(--danger);
            color: white;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            
        }

        .remove-table-btn:hover {
            transform: scale(1.1);
        }

        .add-table-btn {
            width: 100%;
            padding: 15px;
            background: var(--hover-bg);
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius-sm);
            color: var(--text-color);
            font-size: 1rem;
            cursor: pointer;
            
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .add-table-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Boutons de navigation */
        .creation-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        /* Aperçu de table */
        .table-preview-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 8px 30px var(--shadow-color);
        }

        .preview-table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-table-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-color);
        }

        .preview-table-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .preview-info-item {
            margin-bottom: 15px;
        }

        .preview-info-label {
            font-size: 0.85rem;
            color: var(--text-color);
            opacity: 0.7;
            margin-bottom: 5px;
        }

        .preview-info-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-color);
        }

        /* Transition globale */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }
    </style>
</head>

<body class="dark-theme">
    <!-- Particles Background -->
    <div id="particles-js"></div>
    
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">
                    <img src="assets/images/icon.png" alt="logo secura">
                </div>
                <div class="sidebar-logo-text">
                    <h1>SECURA</h1>
                    <p>Gestion Sécurisée</p>
                </div>
            </div>
            <button class="sidebar-close" id="sidebarClose" aria-label="Fermer le menu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <!-- Profile Section -->
        <div class="sidebar-profile">
            <div class="profile-avatar large">
                <i class="bi bi-person-circle"></i>
            </div>
            <div class="profile-details">
                <strong id="sidebarProfileName">Chargement...</strong>
                <small id="sidebarProfileEmail">email@exemple.com</small>
                <span class="badge-role" id="sidebarProfileRole">Utilisateur</span>
            </div>
        </div>
        <!-- Navigation Links -->
        <div id="navMenu" class="sidebar-menu">
            <a href="index.html" class="sidebar-link">
                <i class="fas fa-home"></i>
                <span>Accueil</span>
            </a>
            <a href="events.html" class="sidebar-link">
                <i class="fas fa-calendar-alt"></i>
                <span>Événements</span>
            </a>
            <a href="guests.html" class="sidebar-link">
                <i class="fas fa-users"></i>
                <span>Invités</span>
            </a>
            <a href="tables.html" class="sidebar-link active">
                <i class="fas fa-chair"></i>
                <span>Tables</span>
            </a>
            <a href="qr-generator.html" class="sidebar-link">
                <i class="bi bi-qr-code"></i>
                <span>Générateur QR</span>
            </a>
            <a href="ticket-generator.html" class="sidebar-link">
                <i class="fas fa-ticket-alt"></i>
                <span>Billets</span>
            </a>
            <a href="scanner.html" class="sidebar-link">
                <i class="fas fa-camera"></i>
                <span>Scanner</span>
            </a>
            <hr class="sidebar-divider">
            <a href="profile.html" class="sidebar-link">
                <i class="fas fa-user"></i>
                <span>Mon Profil</span>
            </a>
            <a href="settings.html" class="sidebar-link">
                <i class="fas fa-cog"></i>
                <span>Paramètres</span>
            </a>
            <button class="sidebar-link text-danger" id="sidebarLogout">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </button>
        </div>
        <!-- Footer -->
        <div class="sidebar-footer">
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
                <span>Mode Sombre</span>
            </button>
            <button class="fullscreen-toggle" id="fullscreenToggle">
                <i class="fas fa-expand"></i>
                <span>Plein écran</span>
            </button>
        </div>
    </nav>
    
    <!-- Overlay pour fermer la sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Bouton flottant pour ouvrir la sidebar -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Ouvrir le menu">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Top Bar -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <img src="assets/images/icon.png" alt="logo secura">
                </div>
                <div class="logo-text">
                    <h1>SECURA</h1>
                    <p class="form-title">Gestion des Tables</p>
                </div>
            </div>
           
            <!-- Profile Button -->
            <button class="profile-toggle header-profile-btn" id="profileToggle" aria-haspopup="true" aria-expanded="false">
                <div class="profile-avatar">
                    <i class="bi bi-person-circle"></i>
                </div>
                <div class="profile-info">
                    <span class="profile-name" id="profileName">Chargement...</span>
                    <span class="profile-role" id="profileRole">Utilisateur</span>
                </div>
                <i class="bi bi-chevron-down profile-arrow"></i>
            </button>
        </div>
    </header>
    
    <!-- Profile Menu -->
    <div class="floating-profile-menu" id="floatingProfileMenu">
        <div class="profile-dropdown show" id="profileDropdown" role="menu">
            <div class="profile-header">
                <div class="profile-avatar large">
                    <i class="bi bi-person-circle"></i>
                </div>
                <div class="profile-details">
                    <strong id="dropdownName">Chargement...</strong>
                    <small id="dropdownEmail">email@exemple.com</small>
                    <span class="badge-role" id="dropdownRole">Utilisateur</span>
                </div>
            </div>
            <div class="dropdown-actions">
                <a href="profile.html" class="dropdown-item" role="menuitem">
                    <i class="bi bi-person"></i> Mon Profil
                </a>
                <a href="settings.html" class="dropdown-item" role="menuitem">
                    <i class="bi bi-gear"></i> Paramètres
                </a>
                <hr class="dropdown-divider">
                <button class="dropdown-item text-danger" id="logout-btn" role="menuitem">
                    <i class="bi bi-box-arrow-right"></i> Déconnexion
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main id="mainContent">
        <!-- Vue Accueil (Liste des événements) -->
        <div id="eventsHomeView" class="events-home-container">
            <div class="events-home-header">
                <h1><i class="fas fa-chair"></i> Gestion des Tables</h1>
                <p>Sélectionnez un événement pour gérer ses tables de placement</p>
            </div>
            
            <!-- Toggle vue -->
            <div class="view-mode-toggle">
                <button class="view-mode-btn active" data-mode="grid">
                    <i class="fas fa-th-large"></i>
                    <span>Grille</span>
                </button>
                <button class="view-mode-btn" data-mode="table">
                    <i class="fas fa-table"></i>
                    <span>Tableau</span>
                </button>
            </div>
            
            <!-- Vue Grille (mini cartes) -->
            <div id="eventsGridView" class="events-mini-grid">
                <!-- Les mini cartes d'événements seront injectées ici -->
            </div>
            
            <!-- Vue Tableau -->
            <div id="eventsTableView" class="events-table-container" style="display: none;">
                <table class="events-mini-table">
                    <thead>
                        <tr>
                            <th>Événement</th>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Tables</th>
                            <th>Invitations</th>
                        </tr>
                    </thead>
                    <tbody id="eventsTableBody">
                        <!-- Les lignes du tableau seront injectées ici -->
                    </tbody>
                </table>
            </div>
            
            <!-- État vide -->
            <div id="emptyEventsState" class="home-message" style="display: none;">
                <i class="fas fa-calendar-times"></i>
                <h2>Aucun événement disponible</h2>
                <p>Créez d'abord un événement pour pouvoir gérer ses tables de placement.</p>
                <a href="events.html" class="btn btn-primary">
                    <i class="fas fa-plus-circle"></i>
                    Créer un événement
                </a>
            </div>
        </div>
        
        <!-- Vue Tables (affichage normal) -->
        <div id="tablesView" class="tables-main" style="display: none;">
            <!-- En-tête de page amélioré -->
            <div class="page-header">
                <div class="page-title">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <a href="#" class="back-link" id="backToEventsBtn">
                            <i class="fas fa-arrow-left"></i>
                            Retour
                        </a>
                        <div>
                            <h1><i class="fas fa-chair"></i> Gestion des Tables</h1>
                            <div class="event-name" id="eventNameDisplay">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Chargement de l'événement...</span>
                            </div>
                        </div>
                    </div>
                    <div class="status-indicator" id="eventStatusIndicator" style="display: none;">
                        <i class="fas fa-circle"></i>
                        <span>Chargement...</span>
                    </div>
                </div>
                <div class="page-actions">
                    <button class="btn btn-secondary" id="autoAssignBtn">
                        <i class="fas fa-robot"></i>
                        Auto-assigner
                    </button>
                    <button class="btn btn-secondary" id="importTablesBtn">
                        <i class="fas fa-file-import"></i>
                        Importer
                    </button>
                </div>
            </div>

            <!-- Barre d'actions -->
            <div class="actions-bar">
                <div class="actions-top">
                    <div class="actions-left">
                        <div class="quick-filters">
                            <div class="filter-chip active" data-filter="all">
                                <i class="fas fa-layer-group"></i> Toutes
                            </div>
                            <div class="filter-chip" data-filter="available">
                                <i class="fas fa-check-circle"></i> Disponibles
                            </div>
                            <div class="filter-chip" data-filter="full">
                                <i class="fas fa-ban"></i> Complètes
                            </div>
                            <div class="filter-chip" data-filter="empty">
                                <i class="fas fa-circle"></i> Vides
                            </div>
                        </div>
                    </div>
                    <div class="actions-right">
                        <div class="search-container">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchTables" placeholder="Rechercher une table...">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vue Grille des Tables -->
            <div class="tables-grid-container" id="gridView">
                <div class="grid-header">
                    <h3><i class="fas fa-list-ul"></i> Liste des Tables (<span id="tablesCount">0</span>)</h3>
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="grid">
                            <i class="fas fa-th-large"></i>
                            <span>Grille</span>
                        </button>
                        <button class="view-btn" data-view="table">
                            <i class="fas fa-table"></i>
                            <span>Tableau</span>
                        </button>
                        <button class="view-btn" data-view="visual">
                            <i class="fas fa-th"></i>
                            <span>Visuel</span>
                        </button>
                        <button class="view-btn" data-view="stats">
                            <i class="fas fa-chart-bar"></i>
                            <span>Statistiques</span>
                        </button>
                        <button class="view-btn create" id="createTableBtn">
                            <i class="fas fa-plus-circle"></i>
                            Nouvelle Table
                        </button>
                    </div>
                </div>
                <div class="tables-grid" id="tablesGrid">
                    <!-- Les cartes de tables seront injectées ici -->
                </div>
                <!-- État vide -->
                <div class="empty-state" id="emptyStateGrid" style="display: none;">
                    <i class="fas fa-chair"></i>
                    <h3>Aucune table trouvée</h3>
                    <p>Commencez par créer votre première table</p>
                    <button class="btn btn-primary" id="createFirstTable">
                        <i class="fas fa-plus-circle"></i>
                        Créer une table
                    </button>
                </div>
                <!-- Loader -->
                <div class="loader" id="gridLoader" style="display: none;"></div>
            </div>

            <!-- Vue Tableau des Tables -->
            <div class="tables-table-container" id="tableView">
                <div class="grid-header">
                    <h3><i class="fas fa-table"></i> Tableau des Tables (<span id="tablesTableCount">0</span>)</h3>
                    <button class="btn btn-secondary btn-sm" id="exportTablesBtn">
                        <i class="fas fa-download"></i>
                        Exporter
                    </button>
                </div>
                <table class="tables-table">
                    <thead>
                        <tr>
                            <th>Table #</th>
                            <th>Nom</th>
                            <th>Capacité</th>
                            <th>Inv. assignés</th>
                            <th>Places dispo.</th>
                            <th>Emplacement</th>
                            <th>Statut</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tablesTableBody">
                        <!-- Les lignes de tableau seront injectées ici -->
                    </tbody>
                </table>
                <!-- État vide -->
                <div class="empty-state" id="emptyStateTable" style="display: none;">
                    <i class="fas fa-table"></i>
                    <h3>Aucune table trouvée</h3>
                    <p>Commencez par créer votre première table</p>
                    <button class="btn btn-primary" id="createFirstTableTable">
                        <i class="fas fa-plus-circle"></i>
                        Créer une table
                    </button>
                </div>
                <!-- Loader -->
                <div class="loader" id="tableLoader" style="display: none;"></div>
            </div>

            <!-- Vue Visuelle (Plan de salle) -->
            <div class="visual-layout-container" id="visualView">
                <div class="layout-controls">
                    <h3><i class="fas fa-th"></i> Plan de Salle (<span id="visualTablesCount">0</span>)</h3>
                    <div class="layout-view">
                        <button class="layout-btn active" data-layout="grid">
                            <i class="fas fa-th-large"></i>
                            Grille
                        </button>
                        <button class="layout-btn" data-layout="rows">
                            <i class="fas fa-grip-lines"></i>
                            Rangées
                        </button>
                        <button class="layout-btn" data-layout="custom">
                            <i class="fas fa-pencil-ruler"></i>
                            Personnalisé
                        </button>
                    </div>
                </div>
                <div class="visual-layout" id="visualLayout">
                    <!-- Le plan de salle sera injecté ici -->
                </div>
                <!-- État vide -->
                <div class="empty-state" id="emptyStateVisual" style="display: none;">
                    <i class="fas fa-th"></i>
                    <h3>Aucune table à afficher</h3>
                    <p>Créez des tables pour visualiser le plan de salle</p>
                    <button class="btn btn-primary" id="createFirstTableVisual">
                        <i class="fas fa-plus-circle"></i>
                        Créer une table
                    </button>
                </div>
                <!-- Loader -->
                <div class="loader" id="visualLoader" style="display: none;"></div>
            </div>

            <!-- Vue Statistiques -->
            <div class="stats-view-container" id="statsView">
                <div class="stats-view-header">
                    <h3><i class="fas fa-chart-bar"></i> Statistiques des Tables (<span id="statsTablesCount">0</span>)</h3>
                    <button class="btn btn-secondary btn-sm" id="refreshStatsBtn">
                        <i class="fas fa-sync-alt"></i>
                        Actualiser
                    </button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card-advanced">
                        <div class="stat-title">
                            <i class="fas fa-chart-pie"></i>
                            Taux d'occupation global
                        </div>
                        <div class="stat-value" id="overallOccupancyRate">0%</div>
                        <div class="stat-details">
                            <span id="totalOccupiedSeats">0</span> places occupées sur <span id="totalCapacity">0</span>
                        </div>
                    </div>
                    
                    <div class="stat-card-advanced">
                        <div class="stat-title">
                            <i class="fas fa-users"></i>
                            Distribution des tables
                        </div>
                        <div class="stat-value" id="fullTablesCount">0</div>
                        <div class="stat-details">
                            <span id="emptyTablesCount">0</span> vides • <span id="availableTablesCount">0</span> disponibles
                        </div>
                    </div>
                    
                    <div class="stat-card-advanced">
                        <div class="stat-title">
                            <i class="fas fa-user-friends"></i>
                            Invités assignés
                        </div>
                        <div class="stat-value" id="totalAssignedGuests">0</div>
                        <div class="stat-details">
                            <span id="guestsWithSeats">0</span> invités • <span id="totalSeatsUsed">0</span> places utilisées
                        </div>
                    </div>
                    
                    <div class="stat-card-advanced">
                        <div class="stat-title">
                            <i class="bi bi-qr-code"></i>
                            Activité QR Code
                        </div>
                        <div class="stat-value" id="totalQRScans">0</div>
                        <div class="stat-details">
                            <span id="lastQRScan">Jamais</span> • <span id="mostScannedTable">Aucune</span>
                        </div>
                    </div>
                </div>
                
                <div class="charts-container">
                    <div class="chart-card">
                        <div class="chart-title">
                            <i class="fas fa-chart-bar"></i>
                            Distribution des capacités
                        </div>
                        <div class="chart-placeholder" id="capacityChart">
                            <i class="fas fa-chart-bar" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <p>Graphique des capacités</p>
                            <small>Les données seront affichées ici</small>
                        </div>
                    </div>
                    
                    <div class="chart-card">
                        <div class="chart-title">
                            <i class="fas fa-chart-pie"></i>
                            Occupation par catégorie
                        </div>
                        <div class="chart-placeholder" id="categoryChart">
                            <i class="fas fa-chart-pie" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <p>Répartition par catégorie</p>
                            <small>Les données seront affichées ici</small>
                        </div>
                    </div>
                </div>
                
                <!-- État vide -->
                <div class="empty-state" id="emptyStateStats" style="display: none;">
                    <i class="fas fa-chart-bar"></i>
                    <h3>Aucune donnée statistique</h3>
                    <p>Créez des tables pour générer des statistiques</p>
                    <button class="btn btn-primary" id="createFirstTableStats">
                        <i class="fas fa-plus-circle"></i>
                        Créer une table
                    </button>
                </div>
                <!-- Loader -->
                <div class="loader" id="statsLoader" style="display: none;"></div>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination" style="display: none;">
                <!-- La pagination sera injectée ici -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-top">
                <div class="row">
                    <div class="col-lg-4 mb-5 mb-lg-0">
                        <div class="footer-brand">
                            <div class="footer-logo">
                                <img src="assets/images/icon.png" alt="SECURA Logo">
                            </div>
                            <div class="footer-title">
                                <h3>SECURA</h3>
                                <p>Plateforme d'accès événementiel</p>
                            </div>
                        </div>
                        <p class="footer-description">
                            SECURA révolutionne l'accès aux événements avec des solutions innovantes, 
                            sécurisées et intuitives pour organisateurs et participants.
                        </p>
                        <div class="social-links">
                            <a href="#" class="social-link">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-4 mb-5">
                        <h4>Navigation</h4>
                        <ul class="footer-links">
                            <li><a href="index.html">Accueil</a></li>
                            <li><a href="access.html">Accès événement</a></li>
                            <li><a href="#features">Fonctionnalités</a></li>
                            <li><a href="#how-it-works">Comment ça marche</a></li>
                        </ul>
                    </div>
                    
                    <div class="col-lg-2 col-md-4 mb-5">
                        <h4>Compte</h4>
                        <ul class="footer-links">
                            <li><a href="login.html">Connexion</a></li>
                            <li><a href="register.html">Inscription</a></li>
                            <li><a href="forgot-password.html">Mot de passe oublié</a></li>
                        </ul>
                    </div>
                    
                    <div class="col-lg-4 col-md-4">
                        <h4>Newsletter</h4>
                        <p class="mb-4">Inscrivez-vous pour recevoir nos actualités et offres exclusives.</p>
                        <form class="newsletter-form" id="newsletterForm">
                            <div class="newsletter-input-group">
                                <input type="email" class="newsletter-input" placeholder="Votre email" required>
                                <button type="submit" class="newsletter-btn">
                                    <i class="fas fa-paper-plane"></i>
                                   
                                </button>
                            </div>
                        </form>
                       
                        <div class="footer-controls-inline">
                            <!-- Theme Switch Button -->
                            <div class="theme-switch-footer">
                                <label class="theme-switch">
                                    <input type="checkbox" id="themeSwitchFooter" aria-label="Basculer le thème">
                                    <span class="theme-switch-slider">
                                        <i class="fas fa-moon"></i>
                                        <i class="fas fa-sun"></i>
                                    </span>
                                </label>
                            </div>

                            <!-- Language Selector -->
                            <div class="language-selector"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <p class="copyright">© 2025 SECURA. Tous droits réservés.</p>
                    </div>
                    <div class="col-md-6">
                        <div class="footer-legal">
                            <a href="#">Mentions légales</a>
                            <a href="#">Confidentialité</a>
                            <a href="#">CGU</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bouton retour en haut -->
    <button class="scroll-top" id="scrollTop" aria-label="Retour en haut">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- MODAL DE CRÉATION EN ÉTAPES -->
    <div class="table-creation-modal" id="tableCreationModal">
        <div class="table-creation-wrapper">
            <!-- Panneau de progression vertical -->
            <div class="creation-progress-panel">
                <div class="progress-title">CRÉATION DE TABLE(S)</div>
                
                <div class="vertical-steps">
                    <div class="vertical-step active" data-step="1">
                        <div class="vertical-step-info">
                            <span class="vertical-step-label">Type de création</span>
                            <span class="vertical-step-description">Choisissez entre création simple ou multiple</span>
                        </div>
                    </div>
                    
                    <div class="vertical-step" data-step="2">
                        <div class="vertical-step-info">
                            <span class="vertical-step-label">Informations de base</span>
                            <span class="vertical-step-description">Numéro, nom et capacité de la table</span>
                        </div>
                    </div>
                    
                    <div class="vertical-step" data-step="3">
                        <div class="vertical-step-info">
                            <span class="vertical-step-label">Configuration</span>
                            <span class="vertical-step-description">Emplacement, catégorie et options</span>
                        </div>
                    </div>
                    
                    <div class="vertical-step" data-step="4">
                        <div class="vertical-step-info">
                            <span class="vertical-step-label">Assignation</span>
                            <span class="vertical-step-description">Ajouter des invités à la table</span>
                        </div>
                    </div>
                    
                    <div class="vertical-step" data-step="5">
                        <div class="vertical-step-info">
                            <span class="vertical-step-label">Confirmation</span>
                            <span class="vertical-step-description">Vérification avant création</span>
                        </div>
                    </div>
                </div>
                
                <div class="creation-progress-info">
                    <div class="creation-progress-text">Progression</div>
                    <div class="creation-progress-percentage" id="creationProgressPercentage">20%</div>
                </div>
            </div>

            <!-- Panneau de formulaire -->
            <div class="creation-form-panel">
                <!-- Étape 1: Type de création -->
                <div class="creation-step-content active" id="creationStep1">
                    <div class="creation-header">
                        <h2 class="creation-title">Type de création</h2>
                        <p class="creation-subtitle">Choisissez comment vous souhaitez créer vos tables</p>
                    </div>

                    <div class="form-group" style="text-align: center; margin-top: 40px;">
                        <div style="display: flex; gap: 30px; justify-content: center; margin-bottom: 40px;">
                            <div class="creation-option" id="singleTableOption" 
                                 style="flex: 1; max-width: 300px; cursor: pointer; padding: 30px; background: var(--hover-bg); border-radius: var(--border-radius); border: 2px solid var(--border-color); ">
                                <i class="fas fa-chair" style="font-size: 3rem; color: var(--primary); margin-bottom: 20px;"></i>
                                <h3 style="margin-bottom: 10px;">Table unique</h3>
                                <p style="color: var(--text-color); opacity: 0.7; margin-bottom: 20px;">
                                    Créer une seule table avec des paramètres détaillés
                                </p>
                                <div class="form-help">Idéal pour les tables spéciales (VIP, Mariés, etc.)</div>
                            </div>
                            
                            <div class="creation-option" id="multipleTablesOption" 
                                 style="flex: 1; max-width: 300px; cursor: pointer; padding: 30px; background: var(--hover-bg); border-radius: var(--border-radius); border: 2px solid var(--border-color); ">
                                <i class="fas fa-layer-group" style="font-size: 3rem; color: var(--info); margin-bottom: 20px;"></i>
                                <h3 style="margin-bottom: 10px;">Création multiple</h3>
                                <p style="color: var(--text-color); opacity: 0.7; margin-bottom: 20px;">
                                    Créer plusieurs tables similaires en une seule fois
                                </p>
                                <div class="form-help">Parfait pour les salles avec tables standardisées</div>
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-top: 30px;">
                            <label class="form-label" style="text-align: center; display: block; margin-bottom: 15px;">
                                <i class="fas fa-bolt"></i>
                                Option rapide
                            </label>
                            <div style="display: flex; gap: 15px; justify-content: center;">
                                <button class="btn btn-secondary" id="quickTableBtn" style="padding: 10px 20px;">
                                    <i class="fas fa-bolt"></i>
                                    Table rapide
                                </button>
                                <div class="form-help" style="text-align: center; margin-top: 10px;">
                                    Crée une table avec des paramètres par défaut en un clic
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="creation-navigation">
                        <button class="btn btn-secondary" id="cancelCreationBtn">
                            <i class="fas fa-times"></i>
                            Annuler
                        </button>
                        <button class="btn btn-primary" id="nextToStep2" style="display: none;">
                            Suivant
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Étape 2: Informations de base -->
                <div class="creation-step-content" id="creationStep2">
                    <div class="creation-header">
                        <h2 class="creation-title">Informations de base</h2>
                        <p class="creation-subtitle" id="step2Subtitle">Définissez les informations essentielles de votre table</p>
                    </div>

                    <div id="singleTableForm" style="display: none;">
                        <form id="singleTableStep2Form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-hashtag"></i>
                                        Numéro de table
                                        <span class="required">*</span>
                                    </label>
                                    <input type="text" id="singleTableNumber" class="form-control" 
                                           placeholder="Ex: 1, A, VIP-1" required maxlength="20">
                                    <div class="validation-message" id="singleNumberValidation"></div>
                                    <div class="form-help">Identifiant unique de la table</div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-tag"></i>
                                        Nom de la table
                                    </label>
                                    <input type="text" id="singleTableName" class="form-control" 
                                           placeholder="Ex: Table des Mariés, VIP Gold" maxlength="50">
                                    <div class="form-help">Nom optionnel pour identification</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-users"></i>
                                    Capacité
                                    <span class="required">*</span>
                                </label>
                                <input type="number" id="singleTableCapacity" class="form-control" 
                                       placeholder="Nombre de places" required min="1" max="50" value="8">
                                <div class="validation-message" id="singleCapacityValidation"></div>
                                <div class="form-help">Entre 1 et 50 places</div>
                            </div>
                        </form>
                    </div>

                    <div id="multipleTablesForm" style="display: none;">
                        <div class="multiple-tables-form">
                            <h4 style="margin-bottom: 20px; color: var(--text-color); display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-layer-group"></i>
                                Tables à créer
                            </h4>
                            
                            <div id="multipleTablesList">
                                <!-- Les formulaires de tables multiples seront ajoutés ici dynamiquement -->
                            </div>
                            
                            <button type="button" class="add-table-btn" id="addAnotherTableBtn">
                                <i class="fas fa-plus-circle"></i>
                                Ajouter une autre table
                            </button>
                        </div>
                        
                        <div class="form-group" style="margin-top: 30px;">
                            <label class="form-label">
                                <i class="fas fa-copy"></i>
                                Options de duplication
                            </label>
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <button type="button" class="btn btn-secondary btn-sm" id="duplicateSettingsBtn">
                                    <i class="fas fa-clone"></i>
                                    Dupliquer les paramètres
                                </button>
                                <div class="form-help">
                                    Applique les paramètres de la première table à toutes les autres
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="creation-navigation">
                        <button class="btn btn-secondary" id="backToStep1">
                            <i class="fas fa-arrow-left"></i>
                            Précédent
                        </button>
                        <button class="btn btn-primary" id="nextToStep3">
                            Suivant
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Étape 3: Configuration -->
                <div class="creation-step-content" id="creationStep3">
                    <div class="creation-header">
                        <h2 class="creation-title">Configuration</h2>
                        <p class="creation-subtitle">Configurez l'emplacement et la catégorie de votre table</p>
                    </div>

                    <div id="singleTableConfig" style="display: none;">
                        <form id="singleTableStep3Form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-map-marker-alt"></i>
                                        Emplacement
                                    </label>
                                    <input type="text" id="singleTableLocation" class="form-control" 
                                           placeholder="Ex: Zone VIP, Près de l'estrade" maxlength="100">
                                    <div class="form-help">Position dans la salle</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-tags"></i>
                                        Catégorie
                                    </label>
                                    <select id="singleTableCategory" class="form-control">
                                        <option value="standard">Standard</option>
                                        <option value="vip">VIP</option>
                                        <option value="family">Familiale</option>
                                        <option value="speaker">Conférencier</option>
                                        <option value="organizer">Organisateur</option>
                                        <option value="other">Autre</option>
                                    </select>
                                    <div class="form-help">Catégorie de la table</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-align-left"></i>
                                    Description
                                </label>
                                <textarea id="singleTableDescription" class="form-control" 
                                          placeholder="Description de la table..." 
                                          rows="3" maxlength="500"></textarea>
                                <div class="form-help">Maximum 500 caractères</div>
                            </div>
                        </form>
                    </div>

                    <div id="multipleTablesConfig" style="display: none;">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-map-marker-alt"></i>
                                Emplacement commun
                            </label>
                            <input type="text" id="multipleTablesLocation" class="form-control" 
                                   placeholder="Ex: Zone principale, Salle Est" maxlength="100">
                            <div class="form-help">Emplacement appliqué à toutes les tables</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-tags"></i>
                                Catégorie commune
                            </label>
                            <select id="multipleTablesCategory" class="form-control">
                                <option value="standard">Standard</option>
                                <option value="vip">VIP</option>
                                <option value="family">Familiale</option>
                                <option value="speaker">Conférencier</option>
                                <option value="organizer">Organisateur</option>
                                <option value="other">Autre</option>
                            </select>
                            <div class="form-help">Catégorie appliquée à toutes les tables</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-align-left"></i>
                                Description commune
                            </label>
                            <textarea id="multipleTablesDescription" class="form-control" 
                                      placeholder="Description commune pour toutes les tables..." 
                                      rows="3" maxlength="500"></textarea>
                            <div class="form-help">Description appliquée à toutes les tables</div>
                        </div>
                    </div>

                    <!-- Aperçu -->
                    <div class="table-preview-card" id="tablePreviewCard" style="display: none;">
                        <div class="preview-table-header">
                            <div class="preview-table-title">Aperçu de la table</div>
                            <button type="button" class="btn btn-secondary btn-sm" id="refreshPreviewBtn">
                                <i class="fas fa-sync-alt"></i>
                                Actualiser
                            </button>
                        </div>
                        <div class="preview-table-content" id="previewTableContent">
                            <!-- L'aperçu sera injecté ici -->
                        </div>
                    </div>

                    <div class="creation-navigation">
                        <button class="btn btn-secondary" id="backToStep2">
                            <i class="fas fa-arrow-left"></i>
                            Précédent
                        </button>
                        <button class="btn btn-primary" id="nextToStep4">
                            Suivant
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Étape 4: Assignation -->
                <div class="creation-step-content" id="creationStep4">
                    <div class="creation-header">
                        <h2 class="creation-title">Assignation d'invités</h2>
                        <p class="creation-subtitle" id="step4Subtitle">Assignez des invités à votre table (optionnel)</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-search"></i>
                            Rechercher des invités
                        </label>
                        <div class="search-container">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchGuestsCreation" class="form-control" 
                                   placeholder="Rechercher un invité par nom, email...">
                        </div>
                    </div>

                    <div class="form-group">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <label class="form-label" style="margin: 0;">
                                <i class="fas fa-users"></i>
                                Invités disponibles
                            </label>
                            <button type="button" class="btn btn-secondary btn-sm" id="autoAssignCreationBtn">
                                <i class="fas fa-robot"></i>
                                Auto-assigner
                            </button>
                        </div>
                        
                        <div class="available-guests" id="availableGuestsCreation" 
                             style="max-height: 300px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 15px;">
                            <!-- Les invités disponibles seront injectés ici -->
                            <div style="text-align: center; padding: 40px 20px; color: var(--text-color); opacity: 0.5;">
                                <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px;"></i>
                                <p>Chargement des invités...</p>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user-check"></i>
                            Invités sélectionnés
                            <span class="badge" id="selectedGuestsCount">0</span>
                        </label>
                        <div class="selected-guests" id="selectedGuestsList" 
                             style="min-height: 100px; border: 1px solid var(--border-color); border-radius: var(--border-radius-sm); padding: 15px;">
                            <!-- Les invités sélectionnés seront affichés ici -->
                            <div style="text-align: center; padding: 30px 20px; color: var(--text-color); opacity: 0.5;">
                                <i class="fas fa-user-plus" style="font-size: 2rem; margin-bottom: 10px;"></i>
                                <p>Aucun invité sélectionné</p>
                                <small>Sélectionnez des invités dans la liste ci-dessus</small>
                            </div>
                        </div>
                    </div>

                    <div class="creation-navigation">
                        <button class="btn btn-secondary" id="backToStep3">
                            <i class="fas fa-arrow-left"></i>
                            Précédent
                        </button>
                        <button class="btn btn-primary" id="nextToStep5">
                            Suivant
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Étape 5: Confirmation -->
                <div class="creation-step-content" id="creationStep5">
                    <div class="creation-header">
                        <h2 class="creation-title">Confirmation</h2>
                        <p class="creation-subtitle" id="step5Subtitle">Vérifiez les informations avant de créer</p>
                    </div>

                    <div id="confirmationContent">
                        <!-- Le contenu de confirmation sera injecté ici -->
                    </div>

                    <div class="creation-navigation">
                        <button class="btn btn-secondary" id="backToStep4">
                            <i class="fas fa-arrow-left"></i>
                            Précédent
                        </button>
                        <button class="btn btn-primary" id="submitTablesCreation">
                            <i class="fas fa-check-circle"></i>
                            Créer les tables
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/audio-utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            SECURA_AUDIO.preload();
        });
    </script>
    
    <!-- Librairies -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    
    <!-- Scripts locaux -->
    <script src="js/auth-check.js"></script>
    <script defer src="js/particles-config.js"></script>
    <script defer src="js/theme.js"></script>
    <script defer src="js/main.js"></script>
    <script defer src="js/sidebar.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/storage.js"></script>
    
    <script>
        // Variables globales
        let currentEvent = null;
        let currentUser = null;
        let allTables = [];
        let filteredTables = [];
        let currentView = 'grid';
        let currentFilter = 'all';
        let currentSearch = '';
        let currentPage = 1;
        const tablesPerPage = 12;
        let eventsViewMode = 'grid';
        let eventsList = [];
        
        // Variables pour la création
        let creationMode = 'single'; // 'single' ou 'multiple'
        let creationStep = 1;
        let multipleTablesData = [];
        let selectedGuests = [];
        let availableGuestsList = [];

        // Fonction pour afficher la vue événements
        async function showEventsHome() {
            document.getElementById('eventsHomeView').style.display = 'block';
            document.getElementById('tablesView').style.display = 'none';
            document.title = 'SECURA | Sélectionnez un événement';
            await loadEventsList();
        }

        // Fonction pour afficher la vue tables
        async function showTablesView(eventId) {
            document.getElementById('eventsHomeView').style.display = 'none';
            document.getElementById('tablesView').style.display = 'block';
            await loadTablesForEvent(eventId);
        }

        // Charger la liste des événements
        async function loadEventsList() {
            try {
                eventsList = await storage.getAllEvents();
                currentUser = await authManager.getProfile();
                
                if (currentUser.role !== 'admin') {
                    eventsList = eventsList.filter(event => 
                        event.organizerId == currentUser.id
                    );
                }
                
                if (eventsList.length === 0) {
                    document.getElementById('emptyEventsState').style.display = 'flex';
                    document.getElementById('eventsGridView').style.display = 'none';
                    document.getElementById('eventsTableView').style.display = 'none';
                    return;
                }
                
                document.getElementById('emptyEventsState').style.display = 'none';
                renderEventsList();
                
            } catch (error) {
                console.error('Erreur chargement événements:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de charger la liste des événements',
                    confirmButtonColor: '#D97706'
                });
            }
        }

        function renderEventsList() {
            if (eventsViewMode === 'grid') {
                renderEventsGrid();
            } else {
                renderEventsTable();
            }
        }

        // Rendre la vue grille
        async function renderEventsGrid() {
            const grid = document.getElementById('eventsGridView');
            grid.innerHTML = '';
            grid.style.display = 'grid';
            document.getElementById('eventsTableView').style.display = 'none';
            
            for (const event of eventsList) {
                const tables = await storage.getAllTables(event.id);
                const guests = storage.getGuestsByEventId(event.id);
                const scannedGuests = guests.filter(g => g.scanned).length;
                const eventDate = new Date(event.date);
                const isUpcoming = eventDate >= new Date();
                
                const eventCard = document.createElement('div');
                eventCard.className = 'event-mini-card';
                eventCard.onclick = () => showTablesView(event.id);
                
                eventCard.innerHTML = `
                    <div class="event-mini-header">
                        <div class="event-mini-title">${escapeHtml(event.name)}</div>
                    </div>
                    <div style="padding: 15px;">
                        <div class="event-mini-meta">
                            <div class="event-mini-meta-item">
                                <i class="fas fa-calendar-alt"></i>
                                <span>${eventDate.toLocaleDateString('fr-FR')}</span>
                            </div>
                            ${event.location ? `
                            <div class="event-mini-meta-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${escapeHtml(event.location)}</span>
                            </div>` : ''}
                        </div>
                        <div class="event-mini-stats">
                            <div class="event-mini-stat">
                                <div class="event-mini-stat-number">${tables.count || 0}</div>
                                <div class="event-mini-stat-label">Tables</div>
                            </div>
                            <div class="event-mini-stat">
                                <div class="event-mini-stat-number">${guests.length}</div>
                                <div class="event-mini-stat-label">Invités</div>
                            </div>
                            <div class="event-mini-stat">
                                <div class="event-mini-stat-number">${scannedGuests}</div>
                                <div class="event-mini-stat-label">Présents</div>
                            </div>
                        </div>
                    </div>
                `;
                
                grid.appendChild(eventCard);
            }
        }

        // Rendre la vue tableau
        async function renderEventsTable() {
            const table = document.getElementById('eventsTableBody');
            const grid = document.getElementById('eventsGridView');
            
            grid.style.display = 'none';
            document.getElementById('eventsTableView').style.display = 'block';
            table.innerHTML = '';
            
            for (const event of eventsList) {
                const tables = await storage.getAllTables(event.id);
                const guests = storage.getGuestsByEventId(event.id);
                const scannedGuests = guests.filter(g => g.scanned).length;
                const eventDate = new Date(event.date);
                
                const row = document.createElement('tr');
                row.onclick = () => showTablesView(event.id);
                row.style.cursor = 'pointer';
                
                row.innerHTML = `
                    <td>
                        <div class="event-cell">
                            <div class="event-cell-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="event-cell-info">
                                <div class="event-cell-name" title="${escapeHtml(event.name)}">
                                    ${escapeHtml(event.name)}
                                </div>
                                <div class="event-cell-location" title="${event.location || 'Non spécifié'}">
                                    ${escapeHtml(event.location || 'Non spécifié')}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="event-cell-date">
                            ${eventDate.toLocaleDateString('fr-FR')}
                        </div>
                    </td>
                    <td>
                        <div class="event-cell-type" style="background: ${getTypeColor(event.type)}">
                            ${getTypeLabel(event.type)}
                        </div>
                    </td>
                    <td>
                        <div class="event-cell-stats">
                            <div class="event-cell-stat">
                                <span class="event-cell-stat-number">${tables.count || 0}</span>
                                <span class="event-cell-stat-label">Tables</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="event-cell-stats">
                            <div class="event-cell-stat">
                                <span class="event-cell-stat-number">${guests.length}</span>
                                <span class="event-cell-stat-label">Total</span>
                            </div>
                            <div class="event-cell-stat">
                                <span class="event-cell-stat-number">${scannedGuests}</span>
                                <span class="event-cell-stat-label">Présents</span>
                            </div>
                        </div>
                    </td>
                `;
                
                table.appendChild(row);
            }
        }

        // Fonctions utilitaires pour les types d'événements
        function getTypeColor(type) {
            const colors = {
                marriage: '#EC4899',
                anniversaire: '#F59E0B',
                conference: '#3B82F6',
                corporate: '#6366F1',
                concert: '#8B5CF6',
                gala: '#D97706',
                football: '#10B981',
                autre: '#6B7280'
            };
            return colors[type] || colors.autre;
        }

        function getTypeLabel(type) {
            const labels = {
                marriage: 'Mariage',
                anniversaire: 'Anniversaire',
                conference: 'Conférence',
                corporate: 'Corporate',
                concert: 'Concert',
                gala: 'Gala',
                football: 'Football',
                autre: 'Autre'
            };
            return labels[type] || 'Autre';
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', async function() {
            // Vérifier l'authentification
            const authCheck = await checkAuth();
            if (!authCheck) return;
            
            // Récupérer l'ID de l'événement depuis l'URL
            const urlParams = new URLSearchParams(window.location.search);
            const eventId = urlParams.get('eventId');
            
            if (eventId) {
                await loadTablesForEvent(eventId);
            } else {
                initEventsViewListeners();
                await showEventsHome();
                document.getElementById('searchEvents')?.focus();
            }
        });

        // Initialiser les écouteurs pour la vue événements
        function initEventsViewListeners() {
            document.querySelectorAll('.view-mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.view-mode-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    eventsViewMode = this.dataset.mode;
                    renderEventsList();
                });
            });
            
            // Recherche dans la vue événements
            const searchInput = document.getElementById('searchEvents');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', function() {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        const searchTerm = this.value.trim().toLowerCase();
                        if (searchTerm) {
                            const filteredEvents = eventsList.filter(event =>
                                event.name.toLowerCase().includes(searchTerm) ||
                                event.location?.toLowerCase().includes(searchTerm) ||
                                event.type?.toLowerCase().includes(searchTerm)
                            );
                            eventsList = filteredEvents;
                        } else {
                            loadEventsList();
                        }
                    }, 300);
                });
            }
        }

        async function loadTablesForEvent(eventId) {
            try {
                currentEvent = storage.getEventById(eventId);
                
                if (!currentEvent) {
                    await Swal.fire({
                        icon: 'error',
                        title: 'Événement introuvable',
                        text: 'L\'événement spécifié n\'existe pas',
                        confirmButtonColor: '#D97706'
                    });
                    showEventsHome();
                    return;
                }
                
                // Vérifier les permissions
                if (currentUser.role !== 'admin' && currentEvent.organizerId !== currentUser.id) {
                    await Swal.fire({
                        icon: 'warning',
                        title: 'Accès refusé',
                        text: 'Vous n\'êtes pas autorisé à gérer cet événement',
                        confirmButtonColor: '#D97706'
                    });
                    showEventsHome();
                    return;
                }
                
                await loadTables();
                initEventListeners();
                updateUI();
                
                // Mettre à jour l'affichage
                document.getElementById('eventNameDisplay').innerHTML = `
                    <i class="fas fa-calendar-alt"></i>
                    <span>${escapeHtml(currentEvent.name)}</span>
                `;
                updateEventStatusIndicator();
                
                // Mettre à jour le titre
                document.title = `SECURA | Tables - ${currentEvent.name}`;
                
            } catch (error) {
                console.error('Erreur chargement tables:', error);
                await Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de charger les tables',
                    confirmButtonColor: '#D97706'
                });
            }
        }

        // Vérifier l'authentification
        async function checkAuth() {
            try {
                currentUser = await authManager.getProfile();
                if (!currentUser) {
                    window.location.href = 'login.html';
                    return false;
                }
                return true;
            } catch (error) {
                console.error('Erreur vérification auth:', error);
                window.location.href = 'login.html';
                return false;
            }
        }

        // Charger les tables
        async function loadTables() {
            try {
                showLoader('grid');
                
                const response = await storage.getAllTables(currentEvent.id);
                allTables = response.data || [];
                
                // Trier par numéro de table
                allTables.sort((a, b) => {
                    const numA = parseInt(a.tableNumber) || 0;
                    const numB = parseInt(b.tableNumber) || 0;
                    if (numA !== numB) return numA - numB;
                    return (a.tableNumber || '').localeCompare(b.tableNumber || '');
                });
                
                applyFilters();
                updateStats();
                renderTables();
                
                hideLoader('grid');
                
            } catch (error) {
                console.error('Erreur chargement tables:', error);
                await Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de charger les tables',
                    confirmButtonColor: '#D97706'
                });
                hideLoader('grid');
            }
        }

        // Appliquer les filtres
        function applyFilters() {
            filteredTables = [...allTables];
            
            // Filtre par statut
            if (currentFilter !== 'all') {
                switch(currentFilter) {
                    case 'available':
                        filteredTables = filteredTables.filter(table => {
                            const totalSeats = table.assignedGuests?.reduce((sum, g) => sum + (g.seats || 1), 0) || 0;
                            return totalSeats < table.capacity;
                        });
                        break;
                    case 'full':
                        filteredTables = filteredTables.filter(table => {
                            const totalSeats = table.assignedGuests?.reduce((sum, g) => sum + (g.seats || 1), 0) || 0;
                            return totalSeats >= table.capacity;
                        });
                        break;
                    case 'empty':
                        filteredTables = filteredTables.filter(table => 
                            !table.assignedGuests || table.assignedGuests.length === 0
                        );
                        break;
                }
            }
            
            // Filtre par recherche
            if (currentSearch) {
                const searchTerm = currentSearch.toLowerCase();
                filteredTables = filteredTables.filter(table =>
                    table.tableNumber?.toLowerCase().includes(searchTerm) ||
                    table.tableName?.toLowerCase().includes(searchTerm) ||
                    table.location?.toLowerCase().includes(searchTerm) ||
                    table.category?.toLowerCase().includes(searchTerm) ||
                    table.description?.toLowerCase().includes(searchTerm)
                );
            }
            
            updatePagination();
        }

        // Mettre à jour les statistiques
        function updateStats() {
            const totalTables = allTables.length;
            let totalGuests = 0;
            let totalCapacity = 0;
            let occupiedSeats = 0;
            
            allTables.forEach(table => {
                totalCapacity += table.capacity || 0;
                const guestsCount = table.assignedGuests?.length || 0;
                totalGuests += guestsCount;
                
                const seatsOccupied = table.assignedGuests?.reduce((sum, guest) => 
                    sum + (guest.seats || 1), 0) || 0;
                occupiedSeats += seatsOccupied;
            });
            
            const occupancyRate = totalCapacity > 0 ? 
                Math.round((occupiedSeats / totalCapacity) * 100) : 0;
            
            // Mettre à jour les compteurs
            document.getElementById('tablesCount').textContent = filteredTables.length;
            document.getElementById('tablesTableCount').textContent = filteredTables.length;
            document.getElementById('visualTablesCount').textContent = filteredTables.length;
            document.getElementById('statsTablesCount').textContent = filteredTables.length;
            
            // Mettre à jour les statistiques avancées
            updateAdvancedStats();
        }

        // Mettre à jour les statistiques avancées
        function updateAdvancedStats() {
            if (currentView !== 'stats') return;
            
            let totalCapacity = 0;
            let occupiedSeats = 0;
            let fullTables = 0;
            let emptyTables = 0;
            let availableTables = 0;
            let totalGuests = 0;
            let totalSeatsUsed = 0;
            let totalQRScans = 0;
            let lastQRScan = null;
            let mostScannedTable = null;
            
            allTables.forEach(table => {
                totalCapacity += table.capacity || 0;
                const seatsOccupied = table.assignedGuests?.reduce((sum, guest) => 
                    sum + (guest.seats || 1), 0) || 0;
                occupiedSeats += seatsOccupied;
                
                const guestsCount = table.assignedGuests?.length || 0;
                totalGuests += guestsCount;
                totalSeatsUsed += seatsOccupied;
                
                if (seatsOccupied >= table.capacity) fullTables++;
                if (seatsOccupied === 0) emptyTables++;
                if (seatsOccupied < table.capacity && seatsOccupied > 0) availableTables++;
                
                // Statistiques QR
                if (table.qrCode?.scanCount) {
                    totalQRScans += table.qrCode.scanCount;
                    
                    if (!lastQRScan || (table.qrCode.lastScan && table.qrCode.lastScan > lastQRScan)) {
                        lastQRScan = table.qrCode.lastScan;
                    }
                    
                    if (!mostScannedTable || table.qrCode.scanCount > mostScannedTable.scanCount) {
                        mostScannedTable = {
                            name: table.tableName || `Table ${table.tableNumber}`,
                            scanCount: table.qrCode.scanCount
                        };
                    }
                }
            });
            
            const occupancyRate = totalCapacity > 0 ? 
                Math.round((occupiedSeats / totalCapacity) * 100) : 0;
            
            // Mettre à jour l'interface
            document.getElementById('overallOccupancyRate').textContent = `${occupancyRate}%`;
            document.getElementById('totalOccupiedSeats').textContent = occupiedSeats;
            document.getElementById('totalCapacity').textContent = totalCapacity;
            
            document.getElementById('fullTablesCount').textContent = fullTables;
            document.getElementById('emptyTablesCount').textContent = emptyTables;
            document.getElementById('availableTablesCount').textContent = availableTables;
            
            document.getElementById('totalAssignedGuests').textContent = totalGuests;
            document.getElementById('guestsWithSeats').textContent = totalGuests;
            document.getElementById('totalSeatsUsed').textContent = totalSeatsUsed;
            
            document.getElementById('totalQRScans').textContent = totalQRScans;
            document.getElementById('lastQRScan').textContent = lastQRScan ? 
                new Date(lastQRScan).toLocaleDateString('fr-FR') : 'Jamais';
            document.getElementById('mostScannedTable').textContent = mostScannedTable ? 
                `${mostScannedTable.name} (${mostScannedTable.scanCount})` : 'Aucune';
        }

        // Rendre les tables
        function renderTables() {
            const startIndex = (currentPage - 1) * tablesPerPage;
            const endIndex = startIndex + tablesPerPage;
            const tablesToShow = filteredTables.slice(startIndex, endIndex);
            
            // Afficher/masquer l'état vide
            const emptyStates = ['grid', 'table', 'visual', 'stats'];
            emptyStates.forEach(view => {
                const emptyState = document.getElementById(`emptyState${view.charAt(0).toUpperCase() + view.slice(1)}`);
                if (emptyState) {
                    emptyState.style.display = filteredTables.length === 0 ? 'block' : 'none';
                }
            });
            
            // Cacher les loaders
            hideLoader('all');
            
            // Mode grille
            if (currentView === 'grid') {
                renderGridView(tablesToShow);
            } else if (currentView === 'table') {
                renderTableView(tablesToShow);
            } else if (currentView === 'visual') {
                renderVisualView(tablesToShow);
            } else if (currentView === 'stats') {
                updateAdvancedStats();
            }
        }

        // Rendre la vue grille avec aperçu amélioré
        function renderGridView(tables) {
            const grid = document.getElementById('tablesGrid');
            grid.innerHTML = '';
            
            tables.forEach(table => {
                const totalSeats = table.assignedGuests?.reduce((sum, guest) => 
                    sum + (guest.seats || 1), 0) || 0;
                const availableSeats = Math.max(0, (table.capacity || 0) - totalSeats);
                const occupancyRate = table.capacity > 0 ? 
                    Math.round((totalSeats / table.capacity) * 100) : 0;
                const isFull = totalSeats >= table.capacity;
                const isEmpty = totalSeats === 0;
                
                const tableCard = document.createElement('div');
                tableCard.className = `table-card animate-fade-in ${isFull ? 'full' : isEmpty ? 'empty' : ''}`;
                tableCard.onclick = () => showTableDetails(table);
                
                tableCard.innerHTML = `
                    <div class="table-card-header">
                        <div>
                            <div class="table-number">#${escapeHtml(table.tableNumber)}</div>
                            <div class="table-name">${escapeHtml(table.tableName || '')}</div>
                        </div>
                        <div class="table-status ${isFull ? 'status-full' : 'status-available'}">
                            <i class="fas ${isFull ? 'fa-ban' : 'fa-check-circle'}"></i>
                            <span>${isFull ? 'Complète' : `${availableSeats} places`}</span>
                        </div>
                    </div>
                    
                    <div class="table-card-content">
                        <div class="table-capacity">
                            <span>${totalSeats}/${table.capacity} places</span>
                            <div class="capacity-bar">
                                <div class="capacity-fill" style="width: ${Math.min(occupancyRate, 100)}%"></div>
                            </div>
                        </div>
                        
                        ${table.location ? `
                        <div class="table-location">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${escapeHtml(table.location)}</span>
                        </div>` : ''}
                        
                        <div class="table-guests">
                            <div class="guests-title">
                                <i class="fas fa-users"></i>
                                Invités assignés (${table.assignedGuests?.length || 0})
                            </div>
                            ${table.assignedGuests && table.assignedGuests.length > 0 ? `
                            <div class="guests-list">
                                ${table.assignedGuests.slice(0, 3).map(guest => `
                                    <div class="guest-item">
                                        <div class="guest-avatar">
                                            ${getInitials(guest.guestName)}
                                        </div>
                                        <div class="guest-info">
                                            <div class="guest-name">${escapeHtml(guest.guestName)}</div>
                                            <div class="guest-seats">${guest.seats || 1} place(s)</div>
                                        </div>
                                    </div>
                                `).join('')}
                                ${table.assignedGuests.length > 3 ? `
                                    <div class="guest-item">
                                        <div class="guest-avatar">+${table.assignedGuests.length - 3}</div>
                                        <div class="guest-info">
                                            <div class="guest-name">${table.assignedGuests.length - 3} autres</div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                            ` : `
                            <div style="text-align: center; padding: 15px; color: var(--text-color); opacity: 0.5;">
                                <i class="fas fa-user-plus"></i>
                                <p>Aucun invité assigné</p>
                            </div>
                            `}
                        </div>
                    </div>
                    
                    <div class="table-card-footer">
                        <div class="badge badge-primary">
                            <i class="fas fa-tag"></i>
                            ${escapeHtml(table.category || 'standard')}
                        </div>
                        <div class="table-actions" onclick="event.stopPropagation()">
                            <button class="action-btn edit" onclick="event.stopPropagation(); editTable('${table.id}')" title="Modifier">
                                <i class="bi bi-pencil-square"></i>
                            </button>
                            <button class="action-btn qr" onclick="event.stopPropagation(); generateTableQR('${table.id}')" title="QR Code">
                                <i class="bi bi-qr-code"></i>
                            </button>
                            <button class="action-btn delete" onclick="event.stopPropagation(); deleteTable('${table.id}')" title="Supprimer">
                                <i class="bi bi-trash3"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(tableCard);
            });
        }

        // Rendre la vue tableau
        function renderTableView(tables) {
            const tbody = document.getElementById('tablesTableBody');
            tbody.innerHTML = '';
            
            tables.forEach(table => {
                const totalSeats = table.assignedGuests?.reduce((sum, guest) => 
                    sum + (guest.seats || 1), 0) || 0;
                const availableSeats = Math.max(0, (table.capacity || 0) - totalSeats);
                const occupancyRate = table.capacity > 0 ? 
                    Math.round((totalSeats / table.capacity) * 100) : 0;
                const isFull = totalSeats >= table.capacity;
                
                const row = document.createElement('tr');
                row.className = 'animate-fade-in';
                row.onclick = () => showTableDetails(table);
                row.style.cursor = 'pointer';
                
                row.innerHTML = `
                    <td>
                        <strong>#${escapeHtml(table.tableNumber)}</strong>
                    </td>
                    <td>${escapeHtml(table.tableName || '-')}</td>
                    <td>${table.capacity}</td>
                    <td>
                        <div>${totalSeats}</div>
                        <div style="font-size: 0.8rem; color: var(--text-color); opacity: 0.7;">
                            ${table.assignedGuests?.length || 0} invité(s)
                        </div>
                    </td>
                    <td>
                        <div class="${availableSeats === 0 ? 'status-full' : 'status-available'}">
                            ${availableSeats}
                        </div>
                    </td>
                    <td>${escapeHtml(table.location || '-')}</td>
                    <td>
                        <div class="table-status ${isFull ? 'status-full' : 'status-available'}">
                            <i class="fas ${isFull ? 'fa-ban' : 'fa-check-circle'}"></i>
                            <span>${isFull ? 'Complète' : `${occupancyRate}%`}</span>
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; gap: 8px; justify-content: center;">
                            <button class="action-btn edit" onclick="event.stopPropagation(); editTable('${table.id}')" title="Modifier">
                                <i class="bi bi-pencil-square"></i>
                            </button>
                            <button class="action-btn qr" onclick="event.stopPropagation(); generateTableQR('${table.id}')" title="QR Code">
                                <i class="bi bi-qr-code"></i>
                            </button>
                            <button class="action-btn delete" onclick="event.stopPropagation(); deleteTable('${table.id}')" title="Supprimer">
                                <i class="bi bi-trash3"></i>
                            </button>
                        </div>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Rendre la vue visuelle
        function renderVisualView(tables) {
            const layout = document.getElementById('visualLayout');
            layout.innerHTML = '';
            
            // Grouper par rangées (simplifié)
            const rows = {};
            tables.forEach((table, index) => {
                const rowNum = Math.floor(index / 4) + 1;
                if (!rows[rowNum]) rows[rowNum] = [];
                rows[rowNum].push(table);
            });
            
            // Créer les rangées
            Object.keys(rows).sort().forEach(rowNum => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'table-row animate-fade-in';
                
                rows[rowNum].forEach(table => {
                    const totalSeats = table.assignedGuests?.reduce((sum, guest) => 
                        sum + (guest.seats || 1), 0) || 0;
                    const isFull = totalSeats >= table.capacity;
                    const isEmpty = totalSeats === 0;
                    
                    const tableVisual = document.createElement('div');
                    tableVisual.className = 'table-visual';
                    tableVisual.onclick = () => showTableDetails(table);
                    
                    // Créer les chaises
                    const chairs = [];
                    const chairCount = Math.min(table.capacity, 8);
                    
                    for (let i = 0; i < chairCount; i++) {
                        const isOccupied = i < totalSeats;
                        chairs.push(`
                            <div class="chair ${isOccupied ? 'occupied' : 'empty'}">
                                ${isOccupied ? '<i class="fas fa-user"></i>' : ''}
                            </div>
                        `);
                    }
                    
                    tableVisual.innerHTML = `
                        <div class="table-shape ${isFull ? 'full' : isEmpty ? 'empty' : ''}">
                            <div class="table-visual-info">
                                <div class="table-visual-number">#${escapeHtml(table.tableNumber)}</div>
                                ${table.tableName ? `<div class="table-visual-name">${escapeHtml(table.tableName)}</div>` : ''}
                                <div class="table-visual-capacity">${totalSeats}/${table.capacity}</div>
                            </div>
                        </div>
                        <div class="chairs-container">
                            ${chairs.join('')}
                        </div>
                    `;
                    
                    rowDiv.appendChild(tableVisual);
                });
                
                layout.appendChild(rowDiv);
            });
        }

        // Mettre à jour la pagination
        function updatePagination() {
            const pagination = document.getElementById('pagination');
            const totalPages = Math.ceil(filteredTables.length / tablesPerPage);
            
            if (totalPages <= 1) {
                pagination.style.display = 'none';
                return;
            }
            
            let paginationHTML = '';
            
            // Bouton précédent
            paginationHTML += `
                <button class="page-btn ${currentPage === 1 ? 'disabled' : ''}" 
                        onclick="changePage(${currentPage - 1})" 
                        ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // Pages
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) {
                    paginationHTML += `
                        <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                                onclick="changePage(${i})">
                            ${i}
                        </button>
                    `;
                } else if (i === currentPage - 2 || i === currentPage + 2) {
                    paginationHTML += `<span class="page-btn" style="cursor: default;">...</span>`;
                }
            }
            
            // Bouton suivant
            paginationHTML += `
                <button class="page-btn ${currentPage === totalPages ? 'disabled' : ''}" 
                        onclick="changePage(${currentPage + 1})" 
                        ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            pagination.innerHTML = paginationHTML;
            pagination.style.display = 'flex';
        }

        // Changer de page
        function changePage(page) {
            if (page < 1 || page > Math.ceil(filteredTables.length / tablesPerPage)) return;
            currentPage = page;
            renderTables();
        }

        // Initialiser les écouteurs d'événements
        function initEventListeners() {
            // Bouton retour aux événements
            document.getElementById('backToEventsBtn').addEventListener('click', (e) => {
                e.preventDefault();
                showEventsHome();
            });
            
            // Bouton création de table
            document.getElementById('createTableBtn').addEventListener('click', openTableCreationModal);
            document.getElementById('createFirstTable').addEventListener('click', openTableCreationModal);
            document.getElementById('createFirstTableTable').addEventListener('click', openTableCreationModal);
            document.getElementById('createFirstTableVisual').addEventListener('click', openTableCreationModal);
            document.getElementById('createFirstTableStats').addEventListener('click', openTableCreationModal);
            
            // Filtres rapides
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.addEventListener('click', function() {
                    document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
                    this.classList.add('active');
                    currentFilter = this.dataset.filter;
                    currentPage = 1;
                    applyFilters();
                    renderTables();
                });
            });
            
            // Recherche
            const searchInput = document.getElementById('searchTables');
            let searchTimeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    currentSearch = this.value.trim();
                    currentPage = 1;
                    applyFilters();
                    renderTables();
                }, 300);
            });
            
            // Changement de vue
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (this.classList.contains('create')) return;
                    
                    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentView = this.dataset.view;
                    
                    // Afficher/masquer les conteneurs
                    ['grid', 'table', 'visual', 'stats'].forEach(view => {
                        const container = document.getElementById(`${view}View`);
                        if (container) {
                            container.style.display = view === currentView ? 'block' : 'none';
                        }
                    });
                    
                    currentPage = 1;
                    renderTables();
                });
            });
            
            // Layout visuel
            document.querySelectorAll('.layout-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.layout-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    // Implémenter le changement de layout ici
                });
            });
            
            // Auto-assignation
            document.getElementById('autoAssignBtn').addEventListener('click', async () => {
                await autoAssignGuests();
            });
            
            // Export
            document.getElementById('exportTablesBtn').addEventListener('click', async () => {
                await exportTables();
            });
            
            // Actualiser les statistiques
            document.getElementById('refreshStatsBtn')?.addEventListener('click', () => {
                updateAdvancedStats();
            });
            
            // Initialiser les écouteurs du modal de création
            initCreationModalListeners();
        }

        // Initialiser les écouteurs du modal de création
        function initCreationModalListeners() {
            // Options de création
            document.getElementById('singleTableOption').addEventListener('click', () => {
                selectCreationMode('single');
            });
            
            document.getElementById('multipleTablesOption').addEventListener('click', () => {
                selectCreationMode('multiple');
            });
            
            // Table rapide
            document.getElementById('quickTableBtn').addEventListener('click', createQuickTable);
            
            // Navigation
            document.getElementById('cancelCreationBtn').addEventListener('click', closeTableCreationModal);
            document.getElementById('nextToStep2').addEventListener('click', () => goToCreationStep(2));
            document.getElementById('nextToStep3').addEventListener('click', () => goToCreationStep(3));
            document.getElementById('nextToStep4').addEventListener('click', () => goToCreationStep(4));
            document.getElementById('nextToStep5').addEventListener('click', () => goToCreationStep(5));
            
            document.getElementById('backToStep1').addEventListener('click', () => goToCreationStep(1));
            document.getElementById('backToStep2').addEventListener('click', () => goToCreationStep(2));
            document.getElementById('backToStep3').addEventListener('click', () => goToCreationStep(3));
            document.getElementById('backToStep4').addEventListener('click', () => goToCreationStep(4));
            
            // Ajouter une autre table (mode multiple)
            document.getElementById('addAnotherTableBtn').addEventListener('click', addAnotherTable);
            
            // Dupliquer les paramètres
            document.getElementById('duplicateSettingsBtn').addEventListener('click', duplicateTableSettings);
            
            // Actualiser l'aperçu
            document.getElementById('refreshPreviewBtn')?.addEventListener('click', updateTablePreview);
            
            // Auto-assignation dans le modal
            document.getElementById('autoAssignCreationBtn').addEventListener('click', autoAssignInCreation);
            
            // Soumission finale
            document.getElementById('submitTablesCreation').addEventListener('click', submitTablesCreation);
            
            // Recherche d'invités
            const searchGuestsInput = document.getElementById('searchGuestsCreation');
            let searchGuestsTimeout;
            searchGuestsInput?.addEventListener('input', function() {
                clearTimeout(searchGuestsTimeout);
                searchGuestsTimeout = setTimeout(() => {
                    filterAvailableGuests(this.value);
                }, 300);
            });
        }

        // Sélectionner le mode de création
        function selectCreationMode(mode) {
            creationMode = mode;
            
            // Mettre en évidence l'option sélectionnée
            document.querySelectorAll('.creation-option').forEach(option => {
                option.style.borderColor = 'var(--border-color)';
                option.style.transform = 'none';
            });
            
            if (mode === 'single') {
                document.getElementById('singleTableOption').style.borderColor = 'var(--primary)';
                document.getElementById('singleTableOption').style.transform = 'translateY(-5px)';
                document.getElementById('step2Subtitle').textContent = 'Définissez les informations de votre table';
            } else {
                document.getElementById('multipleTablesOption').style.borderColor = 'var(--info)';
                document.getElementById('multipleTablesOption').style.transform = 'translateY(-5px)';
                document.getElementById('step2Subtitle').textContent = 'Définissez les informations des tables à créer';
            }
            
            // Afficher le bouton suivant
            document.getElementById('nextToStep2').style.display = 'flex';
        }

        // Ouvrir le modal de création
        function openTableCreationModal() {
            // Réinitialiser les données
            creationStep = 1;
            creationMode = 'single';
            multipleTablesData = [];
            selectedGuests = [];
            
            // Réinitialiser l'interface
            document.querySelectorAll('.creation-option').forEach(option => {
                option.style.borderColor = 'var(--border-color)';
                option.style.transform = 'none';
            });
            
            document.getElementById('nextToStep2').style.display = 'none';
            document.getElementById('singleTableForm').style.display = 'none';
            document.getElementById('multipleTablesForm').style.display = 'none';
            document.getElementById('singleTableConfig').style.display = 'none';
            document.getElementById('multipleTablesConfig').style.display = 'none';
            document.getElementById('tablePreviewCard').style.display = 'none';
            
            // Réinitialiser les étapes
            document.querySelectorAll('.vertical-step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            document.querySelector('.vertical-step[data-step="1"]').classList.add('active');
            
            // Afficher le modal
            document.getElementById('tableCreationModal').classList.add('active');
            updateCreationProgress();
        }

        // Fermer le modal de création
        function closeTableCreationModal() {
            document.getElementById('tableCreationModal').classList.remove('active');
        }

        // Aller à une étape de création
        async function goToCreationStep(step) {
            // Valider l'étape actuelle si nécessaire
            if (step > creationStep) {
                const isValid = await validateCurrentCreationStep();
                if (!isValid) return;
            }
            
            creationStep = step;
            
            // Mettre à jour les indicateurs de progression
            document.querySelectorAll('.vertical-step').forEach(stepEl => {
                const stepNum = parseInt(stepEl.dataset.step);
                stepEl.classList.remove('active', 'completed');
                
                if (stepNum < step) {
                    stepEl.classList.add('completed');
                } else if (stepNum === step) {
                    stepEl.classList.add('active');
                }
            });
            
            // Mettre à jour le contenu
            document.querySelectorAll('.creation-step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`creationStep${step}`).classList.add('active');
            
            // Configurer l'interface selon l'étape
            switch(step) {
                case 2:
                    setupStep2();
                    break;
                case 3:
                    setupStep3();
                    break;
                case 4:
                    await setupStep4();
                    break;
                case 5:
                    setupStep5();
                    break;
            }
            
            updateCreationProgress();
        }

        // Valider l'étape actuelle de création
        async function validateCurrentCreationStep() {
            switch(creationStep) {
                case 1:
                    if (!creationMode) {
                        Swal.fire({
                            icon: 'error',
                            title: 'Sélection requise',
                            text: 'Veuillez sélectionner un mode de création',
                            confirmButtonColor: '#D97706'
                        });
                        return false;
                    }
                    break;
                    
                case 2:
                    if (creationMode === 'single') {
                        const tableNumber = document.getElementById('singleTableNumber').value.trim();
                        const capacity = parseInt(document.getElementById('singleTableCapacity').value);
                        
                        if (!tableNumber) {
                            showValidation('singleNumberValidation', 'Le numéro de table est requis', false);
                            return false;
                        }
                        
                        if (isNaN(capacity) || capacity < 1 || capacity > 50) {
                            showValidation('singleCapacityValidation', 'La capacité doit être entre 1 et 50', false);
                            return false;
                        }
                        
                        // Vérifier l'unicité
                        const existingTable = allTables.find(t => 
                            t.tableNumber === tableNumber
                        );
                        
                        if (existingTable) {
                            showValidation('singleNumberValidation', 'Ce numéro de table existe déjà', false);
                            return false;
                        }
                        
                        // Sauvegarder les données
                        multipleTablesData = [{
                            tableNumber,
                            tableName: document.getElementById('singleTableName').value.trim(),
                            capacity
                        }];
                        
                    } else {
                        // Valider les tables multiples
                        if (multipleTablesData.length === 0) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Tables requises',
                                text: 'Veuillez ajouter au moins une table',
                                confirmButtonColor: '#D97706'
                            });
                            return false;
                        }
                        
                        // Vérifier l'unicité des numéros
                        const tableNumbers = multipleTablesData.map(t => t.tableNumber);
                        const duplicates = tableNumbers.filter((num, index) => tableNumbers.indexOf(num) !== index);
                        
                        if (duplicates.length > 0) {
                            Swal.fire({
                                icon: 'error',
                                title: 'Numéros dupliqués',
                                text: `Les numéros suivants sont en double: ${duplicates.join(', ')}`,
                                confirmButtonColor: '#D97706'
                            });
                            return false;
                        }
                        
                        // Vérifier l'existence
                        const existingTables = allTables.filter(t => 
                            tableNumbers.includes(t.tableNumber)
                        );
                        
                        if (existingTables.length > 0) {
                            const existingNumbers = existingTables.map(t => t.tableNumber);
                            Swal.fire({
                                icon: 'error',
                                title: 'Tables existantes',
                                text: `Les tables suivantes existent déjà: ${existingNumbers.join(', ')}`,
                                confirmButtonColor: '#D97706'
                            });
                            return false;
                        }
                    }
                    break;
                    
                case 3:
                    // Récupérer les configurations
                    if (creationMode === 'single') {
                        multipleTablesData[0].location = document.getElementById('singleTableLocation').value.trim();
                        multipleTablesData[0].category = document.getElementById('singleTableCategory').value;
                        multipleTablesData[0].description = document.getElementById('singleTableDescription').value.trim();
                    } else {
                        const location = document.getElementById('multipleTablesLocation').value.trim();
                        const category = document.getElementById('multipleTablesCategory').value;
                        const description = document.getElementById('multipleTablesDescription').value.trim();
                        
                        multipleTablesData = multipleTablesData.map(table => ({
                            ...table,
                            location,
                            category,
                            description
                        }));
                    }
                    break;
            }
            
            return true;
        }

        // Configurer l'étape 2
        function setupStep2() {
            if (creationMode === 'single') {
                document.getElementById('singleTableForm').style.display = 'block';
                document.getElementById('multipleTablesForm').style.display = 'none';
                
                // Réinitialiser les champs
                document.getElementById('singleTableNumber').value = '';
                document.getElementById('singleTableName').value = '';
                document.getElementById('singleTableCapacity').value = '8';
            } else {
                document.getElementById('singleTableForm').style.display = 'none';
                document.getElementById('multipleTablesForm').style.display = 'block';
                
                // Initialiser avec une table si vide
                if (multipleTablesData.length === 0) {
                    addAnotherTable();
                } else {
                    renderMultipleTablesList();
                }
            }
        }

        // Ajouter une autre table (mode multiple)
        function addAnotherTable() {
            const tableIndex = multipleTablesData.length + 1;
            const defaultTableNumber = (allTables.length + tableIndex).toString();
            
            multipleTablesData.push({
                tableNumber: defaultTableNumber,
                tableName: '',
                capacity: 8,
                location: '',
                category: 'standard',
                description: ''
            });
            
            renderMultipleTablesList();
        }

        // Rendre la liste des tables multiples
        function renderMultipleTablesList() {
            const listContainer = document.getElementById('multipleTablesList');
            listContainer.innerHTML = '';
            
            multipleTablesData.forEach((table, index) => {
                const tableItem = document.createElement('div');
                tableItem.className = 'table-item';
                tableItem.innerHTML = `
                    <div class="table-item-header">
                        <div class="table-item-number">Table #${index + 1}</div>
                        ${multipleTablesData.length > 1 ? `
                        <button type="button" class="remove-table-btn" data-index="${index}">
                            <i class="fas fa-times"></i>
                        </button>
                        ` : ''}
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-hashtag"></i>
                                Numéro de table
                                <span class="required">*</span>
                            </label>
                            <input type="text" class="form-control table-number-input" 
                                   data-index="${index}" value="${table.tableNumber}" 
                                   placeholder="Ex: 1, A, VIP-1" required maxlength="20">
                        </div>
                        <div class="form-group">
                            <label class="form-label">
                                <i class="fas fa-tag"></i>
                                Nom de la table
                            </label>
                            <input type="text" class="form-control table-name-input" 
                                   data-index="${index}" value="${table.tableName}" 
                                   placeholder="Ex: Table standard" maxlength="50">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-users"></i>
                            Capacité
                            <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control table-capacity-input" 
                               data-index="${index}" value="${table.capacity}" 
                               min="1" max="50" required>
                    </div>
                `;
                
                listContainer.appendChild(tableItem);
            });
            
            // Ajouter les écouteurs
            listContainer.querySelectorAll('.remove-table-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    multipleTablesData.splice(index, 1);
                    renderMultipleTablesList();
                });
            });
            
            listContainer.querySelectorAll('.table-number-input').forEach(input => {
                input.addEventListener('input', function() {
                    const index = parseInt(this.dataset.index);
                    multipleTablesData[index].tableNumber = this.value.trim();
                });
            });
            
            listContainer.querySelectorAll('.table-name-input').forEach(input => {
                input.addEventListener('input', function() {
                    const index = parseInt(this.dataset.index);
                    multipleTablesData[index].tableName = this.value.trim();
                });
            });
            
            listContainer.querySelectorAll('.table-capacity-input').forEach(input => {
                input.addEventListener('input', function() {
                    const index = parseInt(this.dataset.index);
                    multipleTablesData[index].capacity = parseInt(this.value) || 8;
                });
            });
        }

        // Dupliquer les paramètres
        function duplicateTableSettings() {
            if (multipleTablesData.length < 2) return;
            
            const firstTable = multipleTablesData[0];
            
            // Appliquer les paramètres de la première table à toutes les autres
            for (let i = 1; i < multipleTablesData.length; i++) {
                multipleTablesData[i].tableName = firstTable.tableName;
                multipleTablesData[i].capacity = firstTable.capacity;
            }
            
            renderMultipleTablesList();
            
            Toastify({
                text: "Paramètres dupliqués sur toutes les tables",
                duration: 3000,
                gravity: "top",
                position: "right",
                backgroundColor: "var(--success)"
            }).showToast();
        }

        // Configurer l'étape 3
        function setupStep3() {
            if (creationMode === 'single') {
                document.getElementById('singleTableConfig').style.display = 'block';
                document.getElementById('multipleTablesConfig').style.display = 'none';
                
                // Remplir avec les données existantes si disponibles
                if (multipleTablesData[0]) {
                    document.getElementById('singleTableLocation').value = multipleTablesData[0].location || '';
                    document.getElementById('singleTableCategory').value = multipleTablesData[0].category || 'standard';
                    document.getElementById('singleTableDescription').value = multipleTablesData[0].description || '';
                }
            } else {
                document.getElementById('singleTableConfig').style.display = 'none';
                document.getElementById('multipleTablesConfig').style.display = 'block';
                
                // Remplir avec les données communes si disponibles
                if (multipleTablesData[0]) {
                    document.getElementById('multipleTablesLocation').value = multipleTablesData[0].location || '';
                    document.getElementById('multipleTablesCategory').value = multipleTablesData[0].category || 'standard';
                    document.getElementById('multipleTablesDescription').value = multipleTablesData[0].description || '';
                }
            }
            
            // Afficher l'aperçu
            document.getElementById('tablePreviewCard').style.display = 'block';
            updateTablePreview();
        }

        // Mettre à jour l'aperçu de la table
        function updateTablePreview() {
            const previewContent = document.getElementById('previewTableContent');
            
            if (creationMode === 'single') {
                const table = multipleTablesData[0];
                if (!table) return;
                
                previewContent.innerHTML = `
                    <div class="preview-info-item">
                        <div class="preview-info-label">Numéro de table</div>
                        <div class="preview-info-value">#${escapeHtml(table.tableNumber)}</div>
                    </div>
                    <div class="preview-info-item">
                        <div class="preview-info-label">Nom</div>
                        <div class="preview-info-value">${escapeHtml(table.tableName || 'Non spécifié')}</div>
                    </div>
                    <div class="preview-info-item">
                        <div class="preview-info-label">Capacité</div>
                        <div class="preview-info-value">${table.capacity} places</div>
                    </div>
                    <div class="preview-info-item">
                        <div class="preview-info-label">Emplacement</div>
                        <div class="preview-info-value">${escapeHtml(table.location || 'Non spécifié')}</div>
                    </div>
                    <div class="preview-info-item">
                        <div class="preview-info-label">Catégorie</div>
                        <div class="preview-info-value">${getCategoryLabel(table.category || 'standard')}</div>
                    </div>
                `;
            } else {
                previewContent.innerHTML = `
                    <div class="preview-info-item" style="grid-column: 1 / -1;">
                        <div class="preview-info-label">Nombre de tables</div>
                        <div class="preview-info-value">${multipleTablesData.length} tables</div>
                    </div>
                    <div class="preview-info-item">
                        <div class="preview-info-label">Capacité commune</div>
                        <div class="preview-info-value">${multipleTablesData[0]?.capacity || 8} places/table</div>
                    </div>
                    <div class="preview-info-item">
                        <div class="preview-info-label">Emplacement</div>
                        <div class="preview-info-value">${escapeHtml(document.getElementById('multipleTablesLocation').value || 'Non spécifié')}</div>
                    </div>
                    <div class="preview-info-item">
                        <div class="preview-info-label">Catégorie</div>
                        <div class="preview-info-value">${getCategoryLabel(document.getElementById('multipleTablesCategory').value || 'standard')}</div>
                    </div>
                    <div class="preview-info-item" style="grid-column: 1 / -1;">
                        <div class="preview-info-label">Tables</div>
                        <div class="preview-info-value" style="font-size: 0.9rem; opacity: 0.8;">
                            ${multipleTablesData.map(t => `#${escapeHtml(t.tableNumber)}`).join(', ')}
                        </div>
                    </div>
                `;
            }
        }

        // Configurer l'étape 4
        async function setupStep4() {
            // Mettre à jour le sous-titre
            document.getElementById('step4Subtitle').textContent = creationMode === 'single' ?
                `Assignez des invités à la table #${multipleTablesData[0]?.tableNumber || ''}` :
                'Assignez des invités aux tables (optionnel)';
            
            // Charger les invités disponibles
            await loadAvailableGuestsForCreation();
            
            // Mettre à jour le compteur
            updateSelectedGuestsCount();
        }

        // Charger les invités disponibles pour la création
        async function loadAvailableGuestsForCreation() {
            try {
                const guests = await storage.getAllGuests({ eventId: currentEvent.id });
                
                // Filtrer les invités non assignés
                availableGuestsList = guests.filter(guest => !guest.tableId);
                
                // Afficher la liste
                filterAvailableGuests('');
                
            } catch (error) {
                console.error('Erreur chargement invités:', error);
                document.getElementById('availableGuestsCreation').innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-color); opacity: 0.5;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Impossible de charger les invités</p>
                    </div>
                `;
            }
        }

        // Filtrer les invités disponibles
        function filterAvailableGuests(searchTerm) {
            const container = document.getElementById('availableGuestsCreation');
            let filtered = [...availableGuestsList];
            
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filtered = filtered.filter(guest =>
                    guest.firstName?.toLowerCase().includes(term) ||
                    guest.lastName?.toLowerCase().includes(term) ||
                    guest.email?.toLowerCase().includes(term)
                );
            }
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px 20px; color: var(--text-color); opacity: 0.5;">
                        <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px;"></i>
                        <p>Aucun invité disponible</p>
                        <small>Tous les invités sont déjà assignés ou aucun invité n'a été créé</small>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map(guest => `
                <div class="guest-select-item ${selectedGuests.some(g => g.id === guest.id) ? 'selected' : ''}" 
                     data-guest-id="${guest.id}" style="margin-bottom: 10px; padding: 10px; border-radius: 8px; background: var(--hover-bg); cursor: pointer; ">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="guest-checkbox" style="width: 20px; height: 20px; border-radius: 4px; border: 2px solid var(--border-color); background: ${selectedGuests.some(g => g.id === guest.id) ? 'var(--primary)' : 'var(--input-bg)'}; display: flex; align-items: center; justify-content: center;">
                            ${selectedGuests.some(g => g.id === guest.id) ? '<i class="fas fa-check" style="color: white; font-size: 0.8rem;"></i>' : ''}
                        </div>
                        <div class="guest-avatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem;">
                            ${getInitials(`${guest.firstName || ''} ${guest.lastName || ''}`.trim() || guest.email)}
                        </div>
                        <div style="flex: 1;">
                            <div style="font-weight: 600; color: var(--text-color);">
                                ${escapeHtml(`${guest.firstName || ''} ${guest.lastName || ''}`.trim() || guest.email)}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-color); opacity: 0.7;">
                                ${guest.email || ''} • ${guest.seats || 1} place(s)
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Ajouter les écouteurs
            container.querySelectorAll('.guest-select-item').forEach(item => {
                item.addEventListener('click', function() {
                    const guestId = this.dataset.guestId;
                    toggleGuestSelection(guestId);
                });
            });
        }

        // Basculer la sélection d'un invité
        function toggleGuestSelection(guestId) {
            const guest = availableGuestsList.find(g => g.id === guestId);
            if (!guest) return;
            
            const existingIndex = selectedGuests.findIndex(g => g.id === guestId);
            
            if (existingIndex === -1) {
                selectedGuests.push(guest);
            } else {
                selectedGuests.splice(existingIndex, 1);
            }
            
            filterAvailableGuests(document.getElementById('searchGuestsCreation').value);
            updateSelectedGuestsList();
            updateSelectedGuestsCount();
        }

        // Mettre à jour la liste des invités sélectionnés
        function updateSelectedGuestsList() {
            const container = document.getElementById('selectedGuestsList');
            
            if (selectedGuests.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 30px 20px; color: var(--text-color); opacity: 0.5;">
                        <i class="fas fa-user-plus" style="font-size: 2rem; margin-bottom: 10px;"></i>
                        <p>Aucun invité sélectionné</p>
                        <small>Sélectionnez des invités dans la liste ci-dessus</small>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = selectedGuests.map(guest => `
                <div class="selected-guest-item" data-guest-id="${guest.id}" 
                     style="display: flex; align-items: center; justify-content: space-between; padding: 10px; margin-bottom: 8px; background: var(--hover-bg); border-radius: 8px;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div class="guest-avatar" style="width: 36px; height: 36px; border-radius: 50%; background: var(--gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.85rem;">
                            ${getInitials(`${guest.firstName || ''} ${guest.lastName || ''}`.trim() || guest.email)}
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--text-color);">
                                ${escapeHtml(`${guest.firstName || ''} ${guest.lastName || ''}`.trim() || guest.email)}
                            </div>
                            <div style="font-size: 0.8rem; color: var(--text-color); opacity: 0.7;">
                                ${guest.seats || 1} place(s)
                            </div>
                        </div>
                    </div>
                    <button type="button" class="remove-selected-guest" data-guest-id="${guest.id}"
                            style="background: none; border: none; color: var(--danger); cursor: pointer; padding: 5px; border-radius: 4px; ">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
            
            // Ajouter les écouteurs pour supprimer
            container.querySelectorAll('.remove-selected-guest').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const guestId = this.dataset.guestId;
                    toggleGuestSelection(guestId);
                });
            });
        }

        // Mettre à jour le compteur d'invités sélectionnés
        function updateSelectedGuestsCount() {
            document.getElementById('selectedGuestsCount').textContent = selectedGuests.length;
        }

        // Auto-assignation dans la création
        async function autoAssignInCreation() {
            if (creationMode === 'single') {
                // Pour une table unique, assigner jusqu'à la capacité
                const table = multipleTablesData[0];
                const capacity = table.capacity;
                let seatsAvailable = capacity;
                
                // Sélectionner les invités non assignés
                const guestsToAssign = availableGuestsList.filter(guest => 
                    !selectedGuests.some(g => g.id === guest.id)
                );
                
                for (const guest of guestsToAssign) {
                    if (seatsAvailable <= 0) break;
                    
                    const guestSeats = guest.seats || 1;
                    if (guestSeats <= seatsAvailable) {
                        selectedGuests.push(guest);
                        seatsAvailable -= guestSeats;
                    }
                }
                
                filterAvailableGuests(document.getElementById('searchGuestsCreation').value);
                updateSelectedGuestsList();
                updateSelectedGuestsCount();
                
                Toastify({
                    text: `${selectedGuests.length} invité(s) auto-assigné(s)`,
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "var(--success)"
                }).showToast();
            } else {
                // Pour le mode multiple, demander la stratégie
                const { value: strategy } = await Swal.fire({
                    title: 'Stratégie d\'auto-assignation',
                    input: 'select',
                    inputOptions: {
                        'fill': 'Remplir chaque table avant de passer à la suivante',
                        'distribute': 'Répartir uniformément sur toutes les tables',
                        'smart': 'Intelligente (par groupes)'
                    },
                    inputPlaceholder: 'Sélectionnez une stratégie',
                    showCancelButton: true,
                    confirmButtonText: 'Auto-assigner',
                    cancelButtonText: 'Annuler',
                    confirmButtonColor: '#D97706'
                });
                
                if (!strategy) return;
                
                // Implémenter la logique d'auto-assignation selon la stratégie
                // Pour l'instant, on assigne simplement les invités disponibles
                const availableGuests = availableGuestsList.filter(guest => 
                    !selectedGuests.some(g => g.id === guest.id)
                );
                
                // Limiter à un certain nombre pour éviter la surcharge
                const limit = Math.min(availableGuests.length, multipleTablesData.length * 5);
                const guestsToAdd = availableGuests.slice(0, limit);
                
                selectedGuests.push(...guestsToAdd);
                
                filterAvailableGuests(document.getElementById('searchGuestsCreation').value);
                updateSelectedGuestsList();
                updateSelectedGuestsCount();
                
                Toastify({
                    text: `${guestsToAdd.length} invité(s) auto-assigné(s)`,
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "var(--success)"
                }).showToast();
            }
        }

        // Configurer l'étape 5
        function setupStep5() {
            document.getElementById('step5Subtitle').textContent = creationMode === 'single' ?
                'Vérifiez les informations de votre table avant création' :
                `Vérifiez les informations des ${multipleTablesData.length} tables avant création`;
            
            const confirmationContent = document.getElementById('confirmationContent');
            
            if (creationMode === 'single') {
                const table = multipleTablesData[0];
                confirmationContent.innerHTML = `
                    <div class="table-preview-card">
                        <div class="preview-table-content">
                            <div class="preview-info-item">
                                <div class="preview-info-label">Numéro de table</div>
                                <div class="preview-info-value">#${escapeHtml(table.tableNumber)}</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Nom</div>
                                <div class="preview-info-value">${escapeHtml(table.tableName || 'Non spécifié')}</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Capacité</div>
                                <div class="preview-info-value">${table.capacity} places</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Emplacement</div>
                                <div class="preview-info-value">${escapeHtml(table.location || 'Non spécifié')}</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Catégorie</div>
                                <div class="preview-info-value">${getCategoryLabel(table.category || 'standard')}</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Description</div>
                                <div class="preview-info-value" style="font-style: italic; opacity: 0.8;">
                                    ${escapeHtml(table.description || 'Aucune description')}
                                </div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Invités assignés</div>
                                <div class="preview-info-value">${selectedGuests.length} invité(s)</div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const totalCapacity = multipleTablesData.reduce((sum, table) => sum + table.capacity, 0);
                const commonLocation = document.getElementById('multipleTablesLocation').value;
                const commonCategory = document.getElementById('multipleTablesCategory').value;
                const commonDescription = document.getElementById('multipleTablesDescription').value;
                
                confirmationContent.innerHTML = `
                    <div class="table-preview-card">
                        <div class="preview-table-content">
                            <div class="preview-info-item" style="grid-column: 1 / -1;">
                                <div class="preview-info-label">Nombre de tables</div>
                                <div class="preview-info-value">${multipleTablesData.length} tables</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Capacité totale</div>
                                <div class="preview-info-value">${totalCapacity} places</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Capacité moyenne</div>
                                <div class="preview-info-value">${Math.round(totalCapacity / multipleTablesData.length)} places/table</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Emplacement commun</div>
                                <div class="preview-info-value">${escapeHtml(commonLocation || 'Non spécifié')}</div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Catégorie commune</div>
                                <div class="preview-info-value">${getCategoryLabel(commonCategory || 'standard')}</div>
                            </div>
                            <div class="preview-info-item" style="grid-column: 1 / -1;">
                                <div class="preview-info-label">Description commune</div>
                                <div class="preview-info-value" style="font-style: italic; opacity: 0.8;">
                                    ${escapeHtml(commonDescription || 'Aucune description')}
                                </div>
                            </div>
                            <div class="preview-info-item" style="grid-column: 1 / -1;">
                                <div class="preview-info-label">Liste des tables</div>
                                <div class="preview-info-value" style="font-size: 0.9rem; opacity: 0.8; line-height: 1.6;">
                                    ${multipleTablesData.map((t, i) => 
                                        `Table ${i + 1}: #${escapeHtml(t.tableNumber)} (${t.capacity} places)`
                                    ).join('<br>')}
                                </div>
                            </div>
                            <div class="preview-info-item">
                                <div class="preview-info-label">Invités assignés</div>
                                <div class="preview-info-value">${selectedGuests.length} invité(s) à répartir</div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        // Créer une table rapide
        async function createQuickTable() {
            try {
                // Générer un numéro de table unique
                let tableNumber = (allTables.length + 1).toString();
                let attempts = 0;
                
                while (allTables.some(t => t.tableNumber === tableNumber) && attempts < 100) {
                    tableNumber = (parseInt(tableNumber) + 1).toString();
                    attempts++;
                }
                
                const tableData = {
                    tableNumber,
                    tableName: `Table ${tableNumber}`,
                    capacity: 8,
                    location: 'Zone principale',
                    category: 'standard',
                    description: 'Table créée automatiquement',
                    eventId: currentEvent.id
                };
                
                const saveBtn = document.getElementById('quickTableBtn');
                const originalText = saveBtn.innerHTML;
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<div class="spinner"></div>';
                
                const savedTable = await storage.createTable(currentEvent.id, tableData);
                
                if (savedTable) {
                    closeTableCreationModal();
                    await loadTables();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Table créée !',
                        text: `La table #${savedTable.tableNumber} a été créée avec succès`,
                        timer: 2000,
                        showConfirmButton: false
                    });
                }
                
            } catch (error) {
                console.error('Erreur création table rapide:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de créer la table',
                    confirmButtonColor: '#D97706'
                });
            } finally {
                const saveBtn = document.getElementById('quickTableBtn');
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalText;
            }
        }

        // Soumettre la création des tables
        async function submitTablesCreation() {
            try {
                const submitBtn = document.getElementById('submitTablesCreation');
                const originalText = submitBtn.innerHTML;
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<div class="spinner"></div>';
                
                let createdTables = [];
                
                if (creationMode === 'single') {
                    // Créer une seule table
                    const tableData = {
                        ...multipleTablesData[0],
                        eventId: currentEvent.id
                    };
                    
                    const savedTable = await storage.createTable(currentEvent.id, tableData);
                    if (savedTable) {
                        createdTables.push(savedTable);
                        
                        // Assigner les invités si sélectionnés
                        if (selectedGuests.length > 0) {
                            for (const guest of selectedGuests) {
                                await storage.assignGuestToTable(savedTable.id, guest.id, guest.seats || 1);
                            }
                        }
                    }
                } else {
                    // Créer plusieurs tables
                    const tablesToCreate = multipleTablesData.map(table => ({
                        ...table,
                        eventId: currentEvent.id
                    }));
                    
                    // Utiliser l'endpoint bulk si disponible
                    const response = await storage.createMultipleTables(currentEvent.id, tablesToCreate);
                    if (response && response.data) {
                        createdTables = response.data;
                        
                        // Répartir les invités entre les tables créées
                        if (selectedGuests.length > 0 && createdTables.length > 0) {
                            // Stratégie simple : répartir équitablement
                            const guestsPerTable = Math.ceil(selectedGuests.length / createdTables.length);
                            
                            for (let i = 0; i < selectedGuests.length; i++) {
                                const tableIndex = Math.floor(i / guestsPerTable);
                                if (tableIndex < createdTables.length) {
                                    await storage.assignGuestToTable(
                                        createdTables[tableIndex].id, 
                                        selectedGuests[i].id, 
                                        selectedGuests[i].seats || 1
                                    );
                                }
                            }
                        }
                    }
                }
                
                if (createdTables.length > 0) {
                    closeTableCreationModal();
                    await loadTables();
                    
                    SECURA_AUDIO.play('success');
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                    
                    await Swal.fire({
                        icon: 'success',
                        title: creationMode === 'single' ? 'Table créée !' : 'Tables créées !',
                        html: `
                            <div style="text-align: center; padding: 20px 0;">
                                <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success); margin-bottom: 15px;"></i>
                                <p><strong>${createdTables.length} table(s)</strong> créée(s) avec succès.</p>
                                ${selectedGuests.length > 0 ? `
                                    <p style="color: rgba(255,255,255,0.7); margin-top: 10px;">
                                        <i class="fas fa-users"></i>
                                        ${selectedGuests.length} invité(s) assigné(s)
                                    </p>
                                ` : ''}
                            </div>
                        `,
                        confirmButtonColor: '#D97706',
                        timer: 3000,
                        showConfirmButton: false
                    });
                }
                
            } catch (error) {
                console.error('Erreur création tables:', error);
                
                SECURA_AUDIO.play('error');
                
                await Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    html: `
                        <div style="text-align: center; padding: 20px 0;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: var(--danger); margin-bottom: 15px;"></i>
                            <p>Impossible de créer ${creationMode === 'single' ? 'la table' : 'les tables'}.</p>
                            <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-top: 10px;">
                                ${error.message || 'Une erreur est survenue'}
                            </p>
                        </div>
                    `,
                    confirmButtonColor: '#D97706'
                });
            } finally {
                const submitBtn = document.getElementById('submitTablesCreation');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-check-circle"></i> Créer les tables';
            }
        }

        // Mettre à jour la progression de création
        function updateCreationProgress() {
            const progress = Math.round(((creationStep - 1) / 4) * 100);
            document.getElementById('creationProgressPercentage').textContent = `${progress}%`;
        }

        // Mettre à jour l'indicateur de statut de l'événement
        function updateEventStatusIndicator() {
            const indicator = document.getElementById('eventStatusIndicator');
            if (!currentEvent) return;
            
            let statusText = '';
            let statusClass = '';
            
            switch(currentEvent.status) {
                case 'active':
                    statusText = 'Actif';
                    statusClass = 'status-active';
                    break;
                case 'draft':
                    statusText = 'Brouillon';
                    statusClass = 'status-inactive';
                    break;
                case 'archived':
                    statusText = 'Archivé';
                    statusClass = 'status-inactive';
                    break;
                default:
                    statusText = currentEvent.status;
                    statusClass = 'status-inactive';
            }
            
            indicator.innerHTML = `
                <i class="fas fa-circle"></i>
                <span>${statusText}</span>
            `;
            indicator.className = `status-indicator ${statusClass}`;
            indicator.style.display = 'flex';
        }

        // Mettre à jour l'interface
        function updateUI() {
            document.title = `SECURA | Tables - ${currentEvent?.name || 'Événement'}`;
        }

        // Afficher le loader
        function showLoader(view = 'all') {
            const loaders = {
                grid: 'gridLoader',
                table: 'tableLoader',
                visual: 'visualLoader',
                stats: 'statsLoader'
            };
            
            if (view === 'all') {
                Object.values(loaders).forEach(loaderId => {
                    const loader = document.getElementById(loaderId);
                    if (loader) loader.style.display = 'block';
                });
            } else if (loaders[view]) {
                const loader = document.getElementById(loaders[view]);
                if (loader) loader.style.display = 'block';
            }
        }

        // Cacher le loader
        function hideLoader(view = 'all') {
            const loaders = {
                grid: 'gridLoader',
                table: 'tableLoader',
                visual: 'visualLoader',
                stats: 'statsLoader'
            };
            
            if (view === 'all') {
                Object.values(loaders).forEach(loaderId => {
                    const loader = document.getElementById(loaderId);
                    if (loader) loader.style.display = 'none';
                });
            } else if (loaders[view]) {
                const loader = document.getElementById(loaders[view]);
                if (loader) loader.style.display = 'none';
            }
        }

        // Auto-assigner tous les invités
        async function autoAssignGuests() {
            const result = await Swal.fire({
                title: 'Auto-assigner les invités ?',
                html: `
                    <div style="text-align: center; padding: 20px 0;">
                        <i class="fas fa-robot" style="font-size: 4rem; color: var(--primary); margin-bottom: 15px;"></i>
                        <p>Cette opération assignera automatiquement tous les invités non assignés aux tables disponibles.</p>
                        <p style="color: var(--text-color); opacity: 0.7; font-size: 0.9rem; margin-top: 10px;">
                            Stratégie: Équilibrage optimal
                        </p>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Auto-assigner',
                cancelButtonText: 'Annuler',
                confirmButtonColor: '#D97706',
                cancelButtonColor: '#6B7280'
            });
            
            if (!result.isConfirmed) return;
            
            try {
                const saveBtn = document.getElementById('autoAssignBtn');
                const originalText = saveBtn.innerHTML;
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<div class="spinner"></div>';
                
                const result = await storage.autoAssignGuests(currentEvent.id, 'balanced');
                
                if (result) {
                    await loadTables();
                    
                    await Swal.fire({
                        icon: 'success',
                        title: 'Auto-assignation terminée !',
                        html: `
                            <div style="text-align: center; padding: 20px 0;">
                                <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success); margin-bottom: 15px;"></i>
                                <p><strong>${result.assigned?.length || 0} invité(s)</strong> assigné(s) avec succès</p>
                                ${result.errors && result.errors.length > 0 ? `
                                    <p style="color: var(--warning); font-size: 0.9rem; margin-top: 10px;">
                                        <i class="fas fa-exclamation-triangle"></i>
                                        ${result.errors.length} erreur(s) rencontrée(s)
                                    </p>
                                ` : ''}
                            </div>
                        `,
                        confirmButtonColor: '#D97706'
                    });
                }
                
            } catch (error) {
                console.error('Erreur auto-assignation:', error);
                await Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible d\'auto-assigner les invités',
                    confirmButtonColor: '#D97706'
                });
            } finally {
                const saveBtn = document.getElementById('autoAssignBtn');
                saveBtn.disabled = false;
                saveBtn.innerHTML = originalText;
            }
        }

        // Exporter les tables
        async function exportTables() {
            try {
                const csv = [];
                const headers = ['Numéro', 'Nom', 'Capacité', 'Invités assignés', 'Places occupées', 'Places disponibles', 'Emplacement', 'Catégorie', 'Statut'];
                csv.push(headers.join(','));
                
                filteredTables.forEach(table => {
                    const totalSeats = table.assignedGuests?.reduce((sum, guest) => 
                        sum + (guest.seats || 1), 0) || 0;
                    const availableSeats = Math.max(0, (table.capacity || 0) - totalSeats);
                    const status = totalSeats >= table.capacity ? 'Complète' : 
                                  totalSeats === 0 ? 'Vide' : 'Partiellement occupée';
                    
                    const row = [
                        `"${table.tableNumber || ''}"`,
                        `"${table.tableName || ''}"`,
                        table.capacity,
                        table.assignedGuests?.length || 0,
                        totalSeats,
                        availableSeats,
                        `"${table.location || ''}"`,
                        `"${table.category || 'standard'}"`,
                        `"${status}"`
                    ];
                    
                    csv.push(row.join(','));
                });
                
                const csvContent = csv.join('\n');
                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `secura-tables-${currentEvent.name}-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
                window.URL.revokeObjectURL(url);
                
                Toastify({
                    text: `${filteredTables.length} tables exportées`,
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "var(--success)"
                }).showToast();
                
            } catch (error) {
                console.error('Erreur export tables:', error);
                Toastify({
                    text: "Erreur lors de l'export",
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "var(--danger)"
                }).showToast();
            }
        }

        // Fonctions utilitaires
        function showValidation(elementId, message, isValid) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            element.textContent = message;
            element.className = `validation-message ${isValid ? 'valid' : 'invalid'}`;
            element.style.opacity = '0';
            element.style.transform = 'translateY(-5px)';
            
            setTimeout(() => {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
            }, 10);
            
            return isValid;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function getInitials(name) {
            if (!name) return '?';
            return name
                .split(' ')
                .map(word => word[0])
                .join('')
                .toUpperCase()
                .slice(0, 2);
        }

        function getCategoryLabel(category) {
            const labels = {
                standard: 'Standard',
                vip: 'VIP',
                family: 'Familiale',
                speaker: 'Conférencier',
                organizer: 'Organisateur',
                other: 'Autre'
            };
            return labels[category] || category;
        }

        // Fonctions globales
        window.showTableDetails = async function(table) {
            // Ouvrir une modale ou une page dédiée avec les détails de la table
            // Pour l'instant, on affiche une alerte avec les informations
            const totalSeats = table.assignedGuests?.reduce((sum, guest) => 
                sum + (guest.seats || 1), 0) || 0;
            const availableSeats = Math.max(0, table.capacity - totalSeats);
            
            await Swal.fire({
                title: `Table #${table.tableNumber}`,
                html: `
                    <div style="text-align: left; padding: 20px 0;">
                        <div style="margin-bottom: 20px;">
                            <h3 style="color: var(--primary); margin-bottom: 10px;">${escapeHtml(table.tableName || 'Sans nom')}</h3>
                            <p style="color: var(--text-color); opacity: 0.8;">${escapeHtml(table.description || 'Aucune description')}</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;">
                            <div style="background: var(--hover-bg); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 0.9rem; color: var(--text-color); opacity: 0.7; margin-bottom: 5px;">Capacité</div>
                                <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary);">${table.capacity}</div>
                            </div>
                            <div style="background: var(--hover-bg); padding: 15px; border-radius: 8px;">
                                <div style="font-size: 0.9rem; color: var(--text-color); opacity: 0.7; margin-bottom: 5px;">Places occupées</div>
                                <div style="font-size: 1.5rem; font-weight: 600; color: ${availableSeats === 0 ? 'var(--danger)' : 'var(--success)'};">${totalSeats}</div>
                            </div>
                        </div>
                        
                        ${table.location ? `
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 0.9rem; color: var(--text-color); opacity: 0.7; margin-bottom: 5px;">Emplacement</div>
                            <div style="color: var(--text-color);"><i class="fas fa-map-marker-alt"></i> ${escapeHtml(table.location)}</div>
                        </div>
                        ` : ''}
                        
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 0.9rem; color: var(--text-color); opacity: 0.7; margin-bottom: 5px;">Catégorie</div>
                            <div style="color: var(--text-color);"><i class="fas fa-tag"></i> ${getCategoryLabel(table.category || 'standard')}</div>
                        </div>
                        
                        <div style="margin-top: 25px;">
                            <div style="font-size: 0.9rem; color: var(--text-color); opacity: 0.7; margin-bottom: 10px;">Invités assignés (${table.assignedGuests?.length || 0})</div>
                            ${table.assignedGuests && table.assignedGuests.length > 0 ? `
                            <div style="max-height: 200px; overflow-y: auto;">
                                ${table.assignedGuests.map(guest => `
                                    <div style="display: flex; align-items: center; gap: 10px; padding: 10px; background: var(--hover-bg); border-radius: 8px; margin-bottom: 8px;">
                                        <div style="width: 36px; height: 36px; border-radius: 50%; background: var(--gradient); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.9rem;">
                                            ${getInitials(guest.guestName)}
                                        </div>
                                        <div style="flex: 1;">
                                            <div style="font-weight: 600; color: var(--text-color);">${escapeHtml(guest.guestName)}</div>
                                            <div style="font-size: 0.85rem; color: var(--text-color); opacity: 0.7;">${guest.seats || 1} place(s)</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            ` : `
                            <div style="text-align: center; padding: 20px; color: var(--text-color); opacity: 0.5;">
                                <i class="fas fa-user-plus"></i>
                                <p>Aucun invité assigné</p>
                            </div>
                            `}
                        </div>
                    </div>
                `,
                width: '600px',
                showConfirmButton: false,
                showCloseButton: true,
                background: 'var(--card-bg)'
            });
        };

        window.editTable = async function(tableId) {
            const table = allTables.find(t => t.id === tableId);
            if (table) {
                // Pour l'instant, on ouvre le modal de création en mode édition
                // Vous pouvez implémenter l'édition complète ici
                await Swal.fire({
                    title: 'Modifier la table',
                    text: 'Fonctionnalité d\'édition à implémenter',
                    icon: 'info',
                    confirmButtonColor: '#D97706'
                });
            }
        };

        window.deleteTable = async function(tableId) {
            const table = allTables.find(t => t.id === tableId);
            if (!table) return;
            
            const result = await Swal.fire({
                title: 'Supprimer la table ?',
                html: `
                    <div style="text-align: center; padding: 20px 0;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: #EF4444; margin-bottom: 15px;"></i>
                        <p>La table <strong>#${escapeHtml(table.tableNumber)}</strong> sera définitivement supprimée.</p>
                        ${table.assignedGuests && table.assignedGuests.length > 0 ? `
                            <p style="color: var(--warning); font-size: 0.9rem; margin-top: 10px;">
                                <i class="fas fa-users"></i>
                                ${table.assignedGuests.length} invité(s) seront retiré(s) de cette table
                            </p>
                        ` : ''}
                    </div>
                `,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Oui, supprimer',
                cancelButtonText: 'Annuler',
                confirmButtonColor: '#EF4444',
                cancelButtonColor: '#6B7280',
                reverseButtons: true
            });
            
            if (result.isConfirmed) {
                try {
                    await storage.deleteTable(tableId);
                    await loadTables();
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'Supprimé !',
                        text: 'La table a été supprimée avec succès',
                        timer: 2000,
                        showConfirmButton: false
                    });
                } catch (error) {
                    console.error('Erreur suppression table:', error);
                    Swal.fire({
                        icon: 'error',
                        title: 'Erreur',
                        text: 'Impossible de supprimer la table',
                        confirmButtonColor: '#D97706'
                    });
                }
            }
        };

        window.generateTableQR = async function(tableId) {
            try {
                const qrCode = await storage.generateTableQR(tableId);
                
                if (qrCode) {
                    await Swal.fire({
                        title: 'QR Code de Table',
                        html: `
                            <div style="text-align: center; padding: 20px 0;">
                                <div style="margin: 20px auto; width: 200px; height: 200px; background: #f0f0f0; display: flex; align-items: center; justify-content: center; border-radius: 10px;">
                                    <i class="bi bi-qr-code" style="font-size: 6rem; color: #333;"></i>
                                </div>
                                <p style="color: var(--text-color); opacity: 0.7; font-size: 0.9rem;">
                                    QR Code généré avec succès
                                </p>
                                <p style="color: var(--text-color); opacity: 0.7; font-size: 0.9rem;">
                                    Scans: ${qrCode.scanCount || 0}
                                </p>
                            </div>
                        `,
                        showCancelButton: true,
                        confirmButtonText: 'Télécharger',
                        cancelButtonText: 'Fermer',
                        confirmButtonColor: '#D97706'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Ici vous implémenteriez le téléchargement du QR Code
                            Toastify({
                                text: "QR Code téléchargé",
                                duration: 3000,
                                gravity: "top",
                                position: "right",
                                backgroundColor: "var(--success)"
                            }).showToast();
                        }
                    });
                }
            } catch (error) {
                console.error('Erreur génération QR:', error);
                Toastify({
                    text: "Erreur génération QR Code",
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "var(--danger)"
                }).showToast();
            }
        };

        // Gestion de la fermeture de page
        window.addEventListener('beforeunload', (e) => {
            if (allTables.length > 0) {
                e.preventDefault();
                e.returnValue = 'Vous avez des modifications non sauvegardées. Voulez-vous vraiment quitter ?';
                return e.returnValue;
            }
        });
    </script>
</body>
</html>

lsof -ti:3000 | xargs kill -9 2>/dev/null; sleep 1; echo "Port 3000 libéré"