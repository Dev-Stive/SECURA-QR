<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SECURA | Création d'événement</title>
    <link rel="icon" href="assets/images/icon.png" type="image/x-icon">
    
    <!-- Styles et Polices -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    

    <link rel="stylesheet" href="css/loading.css">
    <link rel="stylesheet" href="css/dash.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/toastify.css">
    <link rel="stylesheet" href="css/index.css">
    
    <!-- SweetAlert2 -->
    <link rel="preload" href="js/auth-check.js" as="script">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <style>
/* ==========================================
   VARIABLES GLOBALES POUR LES THÈMES
   ========================================== */
:root {
    /* Thème clair (par défaut) */
    --primary: #D97706;
    --primary-dark: #B45309;
    --primary-light: #F59E0B;
    --dark: #0A0A0A;
    --dark-card: #121212;
    --dark-elevated: #1A1A1A;
    --gradient: linear-gradient(135deg, #B45309 0%, #D97706 50%, #F59E0B 100%);
    --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    --success: #10B981;
    --danger: #EF4444;
    --warning: #F59E0B;
    --border-radius: 0.5rem;
    --border-radius-sm: 10px;
    --card-shadow: 0 12px 40px rgba(0,0,0,0.4);
    
    /* Variables pour thème clair */
    --body-bg: #ffffff;
    --text-color: #333333;
    --card-bg: #f8f9fa;
    --input-bg: #ffffff;
    --input-border: #e0e0e0;
    --input-text: #333333;
    --placeholder-color: #666666;
    --border-color: rgba(0, 0, 0, 0.1);
    --hover-bg: rgba(0, 0, 0, 0.05);
    --shadow-color: rgba(0, 0, 0, 0.1);
    --progress-bg: rgba(0, 0, 0, 0.05);
}

/* Variables pour thème sombre */
.dark-theme {
    --body-bg: #0A0A0A;
    --text-color: #ffffff;
    --card-bg: #121212;
    --input-bg: rgba(255, 255, 255, 0.04);
    --input-border: rgba(255, 255, 255, 0.12);
    --input-text: #ffffff;
    --placeholder-color: rgba(255, 255, 255, 0.4);
    --border-color: rgba(255, 255, 255, 0.1);
    --hover-bg: rgba(255, 255, 255, 0.05);
    --shadow-color: rgba(0, 0, 0, 0.5);
    --progress-bg: rgba(0, 0, 0, 0.2);
}

/* ==========================================
   STYLES DE BASE
   ========================================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Poppins', sans-serif;
    background-color: var(--body-bg);
    color: var(--text-color);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
    
}

body {
    background-image:
        radial-gradient(circle at 10% 20%, rgba(217, 119, 6, 0.15) 0%, transparent 30%),
        radial-gradient(circle at 90% 80%, rgba(217, 119, 6, 0.15) 0%, transparent 30%);
}

.dark-theme body {
    background-image:
        radial-gradient(circle at 10% 20%, rgba(217, 119, 6, 0.08) 0%, transparent 40%),
        radial-gradient(circle at 90% 80%, rgba(217, 119, 6, 0.08) 0%, transparent 40%);
}

/* === CONTENEUR PRINCIPAL === */
.event-form-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    margin-top: 100px;
}

.main-content {
    min-height: calc(100vh - 80px);
}
.form-wrapper {
    display: flex;
    width: 100%;
    max-width: 1150px;
    background: var(--card-bg);
    border-radius: var(--border-radius);
    border: 1px solid var(--border-color);
    box-shadow: 0 12px 40px var(--shadow-color);
    backdrop-filter: blur(20px);
    overflow: hidden;
    height: 650px;
    animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(40px); }
    to { opacity: 1; transform: translateY(0); }
}

/* === PANEL DE PROGRESSION (GAUCHE) === */
.progress-panel {
    flex: 0 0 350px;
    background: var(--progress-bg);
    padding: 40px 30px;
    display: flex;
    flex-direction: column;
    border-right: 1px solid var(--border-color);
    
}

.progress-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-color);
    opacity: 0.7;
    margin-bottom: 40px;
    letter-spacing: 0.5px;
    
}

.steps-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: auto;
}

.step-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 18px 20px;
    border-radius: var(--radius-lg);
    cursor: pointer;
    
    position: relative;
    overflow: hidden;
}

.step-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background: var(--gradient);
    transform: scaleY(0);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.step-item.active {
    background: rgba(217, 119, 6, 0.08);
    border: 1px solid rgba(217, 119, 6, 0.2);
}

.step-item.active::before {
    transform: scaleY(1);
}

.step-item.completed {
    opacity: 0.8;
}

.step-number {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.15);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.5);
    
}

.step-item.active .step-number {
    background: var(--gradient);
    border-color: var(--primary);
    color: white;
    box-shadow: 0 0 0 4px rgba(217, 119, 6, 0.15);
}

.step-item.completed .step-number {
    background: var(--primary);
    border-color: var(--primary);
    color: white;
}

.step-info {
    flex: 1;
}

.step-label {
    display: block;
    font-weight: 600;
    font-size: 0.95rem;
    color: var(--text-color);
    margin-bottom: 4px;
    
}

.step-item.active .step-label {
    color: var(--primary-light);
}

.step-description {
    display: block;
    font-size: 0.8rem;
    color: var(--text-color);
    opacity: 0.5;
    line-height: 1.3;
    
}

.progress-info {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

.progress-text {
    font-size: 0.85rem;
    color: var(--text-color);
    opacity: 0.5;
    margin-bottom: 8px;
    
}

.progress-percentage {
    font-size: 1.8rem;
    font-weight: 700;
    background: var(--gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

/* === PANEL DE FORMULAIRE (DROITE) === */
.form-panel {
    flex: 1;
    padding: 40px;
    overflow: hidden;
    position: relative;
}

.form-header {
    margin-bottom: 40px;
}

.form-title {
    font-size: 1.8rem;
    font-weight: 700;
    margin-bottom: 8px;
    background: var(--gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.form-subtitle {
    font-size: 0.95rem;
    color: var(--text-color);
    opacity: 0.6;
    line-height: 1.5;
    
}

/* === CONTENU DES ÉTAPES === */
.step-content {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    padding: 40px;
    opacity: 0;
    transform: translateX(40px);
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
    overflow-y: auto;
}

.step-content::-webkit-scrollbar {
    width: 6px;
}

.step-content::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 3px;
}

.dark-theme .step-content::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.2);
}

.step-content::-webkit-scrollbar-thumb {
    background: var(--gradient);
    border-radius: 3px;
}

.step-content.active {
    opacity: 1;
    transform: translateX(0);
    pointer-events: all;
}

/* === FORMULAIRES === */
.form-group {
    margin-bottom: 20px;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
}

.form-col {

    display: flex;
    flex-direction: column;
    gap: 20px;

}

@media (max-width: 768px) {
    .form-row {
        grid-template-columns: 1fr;
    }
}

.form-label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--primary-light);
    margin-bottom: 8px;
}

.required {
    color: var(--danger);
    font-size: 1.2rem;
    line-height: 1;
}

.input-wrapper {
    position: relative;
}

.input-icon {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary);
    font-size: 1rem;
    pointer-events: none;
    z-index: 2;
}

.form-control {
    width: 100%;
    background: var(--input-bg);
    border: 1.5px solid var(--input-border);
    color: var(--input-text);
    padding: 12px 16px 12px 44px;
    border-radius: var(--border-radius-sm);
    font-size: 0.95rem;
    
    font-family: inherit;
}

textarea.form-control {
    padding: 12px 16px;
    min-height: 120px;
    resize: vertical;
}

.form-control:focus {
    outline: none;
    border-color: var(--primary);
    background: var(--input-bg);
    box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
}

.form-control::placeholder {
    color: var(--placeholder-color);
    font-size: 0.9rem;
}

.form-help {
    display: block;
    margin-top: 6px;
    font-size: 0.85rem;
    color: var(--text-color);
    opacity: 0.5;
    
}

/* === SELECT STYLÉ === */
select.form-control , .swal2-select{
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23D97706' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
    background-size: 16px;
    padding-right: 40px;
}




/* === CHECKBOX STYLÉ === */
.checkbox-label {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 10px;
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
    border-radius: 4px;
    border: 2px solid var(--input-border);
    background: var(--input-bg);
    cursor: pointer;
    
}

.checkbox-label input[type="checkbox"]:checked {
    background: var(--primary);
    border-color: var(--primary);
}

/* === COLOR PICKER === */
.color-picker-group {
    display: inline-flex;
    align-items: center;
    gap: 15px;
}

.color-preview {
    width: 40px;
    height: 40px;
    border-radius: var(--border-radius-sm);
    border: 2px solid var(--input-border);
    cursor: pointer;
    
    position: relative;
}

.color-preview:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.color-input {
    position: absolute;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
    z-index: 2;
}

.color-text-input {
    flex: 1;
    background: var(--input-bg);
    border: 1.5px solid var(--input-border);
    color: var(--input-text);
    padding: 12px 16px;
    border-radius: var(--border-radius-sm);
    font-size: 0.95rem;
    font-family: inherit;
    width: 7rem;
}

.color-text-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
}

/* === FILE UPLOAD === */
.file-upload-area {
    background: var(--input-bg);
    border: 2px dashed var(--input-border);
    border-radius: var(--border-radius-sm);
    padding: 30px;
    text-align: center;
    cursor: pointer;
    
}

.file-upload-area:hover {
    border-color: var(--primary);
    background: rgba(217, 119, 6, 0.05);
}

.file-upload-area i {
    font-size: 2rem;
    color: var(--primary);
    margin-bottom: 10px;
}

/* === IMAGE UPLOAD PREVIEW === */
.image-upload-container {
    position: relative;
    width: 100%;
    margin-bottom: 10px;
}

.image-preview {
    width: 100%;
    height: 200px;
    background: var(--input-bg);
    border: 2px dashed var(--input-border);
    border-radius: var(--border-radius-sm);
    overflow: hidden;
    position: relative;
    cursor: pointer;
    
}

.image-preview:hover {
    border-color: var(--primary);
    background: rgba(217, 119, 6, 0.05);
}

.image-preview:hover .image-overlay {
    opacity: 1;
}

.image-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: none; /* Caché par défaut */
}

.image-preview.has-image img {
    display: block; /* Affiche l'image seulement quand elle existe */
}

.image-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: white;
    opacity: 1;
    width: 100%;
    
    text-align: center;
    padding: 20px;
}

.image-preview.has-image .image-overlay {
    opacity: 0; /* Caché quand il y a une image */
    background: rgba(0, 0, 0, 0.7); /* Garder la même couleur */
}

.image-preview.has-image:hover .image-overlay {
    opacity: 1;
    background: rgba(0, 0, 0, 0.5);
}

.image-overlay i {
    font-size: 2.5rem;
    margin-bottom: 10px;
    color: var(--primary);
}

.image-overlay p {
    margin: 5px 0;
    font-size: 0.9rem;
}

.image-overlay .form-help {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.8rem;
    margin-top: 5px;
}

.image-actions {
    position: absolute;
    top: 10px;
    right: 10px;
    display: none; /* Caché par défaut */
    gap: 5px;
    z-index: 10;
}

.image-preview.has-image .image-actions {
    display: flex; /* Affiche seulement quand il y a une image */
}

.image-upload-container:hover .image-actions {
    opacity: 1;
}

.image-action-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: none;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    
    font-size: 0.9rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    opacity: 0.9;
}

.image-action-btn.change {
    background: var(--primary);
    color: white;
}

.image-action-btn.remove {
    background: var(--danger);
    color: white;
}

.image-action-btn:hover {
    transform: scale(1.1);
    opacity: 1;
}

.image-action-btn.change:hover {
    background: var(--primary-dark);
}

.image-action-btn.remove:hover {
    background: #DC2626;
}


.image-thumbnail {
    margin-top: 5px;
    cursor: pointer;
    color: var(--primary);
    font-size: 0.8rem;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 4px 8px;
    background: rgba(217, 119, 6, 0.1);
    border-radius: 4px;
    
}

.image-thumbnail:hover {
    background: rgba(217, 119, 6, 0.2);
    transform: translateY(-1px);
}


/* === PRÉVISUALISATION === */
.preview-container {
    background: var(--input-bg);
    border-radius: var(--border-radius-sm);
    padding: 25px;
    margin-top: 20px;
    border: 1px solid var(--border-color);
    
}

.preview-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-light);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.preview-card {
    background: linear-gradient(145deg, rgba(255, 255, 255, 0.05), rgba(255, 255, 255, 0.02));
    border-radius: var(--border-radius-sm);
    padding: 20px;
    border-left: 4px solid var(--primary);
}

.preview-card-title {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 10px;
    color: var(--text-color);
}

.preview-card-meta {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 15px;
}

.preview-meta-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
    color: var(--text-color);
    opacity: 0.7;
}

.preview-card-stats {
    display: flex;
    justify-content: space-around;
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
}

.preview-stat {
    text-align: center;
}

.preview-stat-value {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--primary);
}

.preview-stat-label {
    font-size: 0.8rem;
    color: var(--text-color);
    opacity: 0.5;
}

/* === RÉCAPITULATIF === */
.summary-section {
    margin-bottom: 25px;
}

.summary-title {
    font-size: 1rem;
    font-weight: 600;
    color: var(--primary-light);
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.summary-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
}

.summary-item {
    background: rgba(255, 255, 255, 0.03);
    padding: 12px 15px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-radius: var(--border-radius-sm);
    border: 1px solid var(--border-color);
    
}

.dark-theme .summary-item {
    background: rgba(0, 0, 0, 0.2);
}

.summary-item strong {
    color: var(--primary-light);
    font-size: 0.9rem;
    display: block;
    margin-bottom: 4px;
}

.summary-item span {
    color: var(--text-color);
    font-size: 0.9rem;
    opacity: 0.8;
}

/* === BOUTONS DE NAVIGATION === */
.navigation-buttons {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid var(--border-color);
}

.actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
}


.btn {
    padding: 12px 28px;
    border-radius: var(--border-radius-sm);
    font-weight: 600;
    font-size: 0.95rem;
    cursor: pointer;
    
    border: none;
    display: flex;
    align-items: center;
    gap: 10px;
}

.btn-prev {
    background: var(--hover-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
}

.btn-prev:hover:not(:disabled) {
    background: var(--input-bg);
    color: var(--text-color);
    transform: translateY(-2px);
}

.btn-next, .btn-submit {
    background: var(--gradient);
    color: white;
    box-shadow: 0 4px 15px rgba(217, 119, 6, 0.25);
}

.btn-next:hover:not(:disabled), .btn-submit:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(217, 119, 6, 0.35);
}

.btn-save-draft {
    background: transparent;
    color: var(--text-color);
    opacity: 0.6;
    border: 1px solid var(--border-color);
}

.btn-save-draft:hover {
    background: var(--hover-bg);
    color: var(--text-color);
    opacity: 1;
}

.btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
    box-shadow: none !important;
}

.spinner {
    width: 18px;
    height: 18px;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* === MESSAGES DE VALIDATION === */
.validation-message {
    font-size: 0.8rem;
    margin-top: 6px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.validation-message.valid {
    color: var(--success);
}

.validation-message.invalid {
    color: var(--danger);
}

/* === RESPONSIVE === */
@media (max-width: 992px) {
    .form-wrapper {
        flex-direction: column;
        height: auto;
        max-height: 90vh;
    }
    
    .progress-panel {
        flex: none;
        border-right: none;
        border-bottom: 1px solid var(--border-color);
    }
    
    .steps-container {
        flex-direction: row;
        overflow-x: auto;
        padding-bottom: 10px;
    }
    
    .step-item {
        min-width: 200px;
    }
}

@media (max-width: 768px) {
    .event-form-main {
        margin-top: 80px;
        padding: 15px;
    }
    
    .form-wrapper {
        border-radius: 12px;
    }
    
    .form-panel {
        padding: 30px 20px;
    }
    
    .step-content {
        padding: 30px 20px;
    }
    
    .btn {
        padding: 10px 20px;
        font-size: 0.9rem;
    }
}

@media (max-width: 480px) {
    .form-title {
        font-size: 1.5rem;
    }
    
    .progress-panel {
        padding: 25px 20px;
    }
    
    .step-item {
        padding: 15px;
    }
    
    .form-row {
        gap: 15px;
    }
}

/* Section du formulaire */
.form-section {
    margin-bottom: 30px;
    padding-bottom: 25px;
    border-bottom: 1px solid var(--border-color);
}

.form-section:last-child {
    border-bottom: none;
    margin-bottom: 0;
    padding-bottom: 0;
}

.section-title {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--primary-light);
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.char-count {
    font-size: 0.8rem;
    color: var(--text-color);
    opacity: 0.5;
    text-align: right;
    margin-top: 4px;
    
}

.char-count.warning {
    color: var(--warning);
}

.char-count.error {
    color: var(--danger);
}

/* Gestion des tags */
.tags-container {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 10px;
}

.tag {
    background: rgba(217, 119, 6, 0.1);
    color: var(--primary-light);
    padding: 4px 12px;
    border-radius: 0.5rem;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    gap: 6px;
    border: 1px solid rgba(217, 119, 6, 0.2);
}

.tag-remove {
    background: none;
    border: none;
    color: inherit;
    font-size: 0.8rem;
    cursor: pointer;
    padding: 0;
    width: 18px;
    height: 18px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    
}

.tag-remove:hover {
    background: var(--hover-bg);
}

/* Radio buttons pour les options */
.radio-group {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 10px;
}

.radio-option {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
}

.radio-option input[type="radio"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
}

.radio-label {
    flex: 1;
    color: var(--text-color);
}

.radio-help {
    font-size: 0.85rem;
    color: var(--text-color);
    opacity: 0.5;
    margin-top: 2px;
}


.event-welcome {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1rem;
    color: rgba(255, 255, 255, 0.95);
    font-style: italic;
    line-height: 1.6;
    max-width: 700px;
    margin: 10px auto;
    margin-bottom: 10px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
}


/* Indicateur de statut */
.status-indicator {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 600;
}

.status-draft {
    background: rgba(245, 158, 11, 0.2);
    color: var(--warning);
    border: 1px solid rgba(245, 158, 11, 0.3);
}

.status-active {
    background: rgba(16, 185, 129, 0.2);
    color: var(--success);
    border: 1px solid rgba(16, 185, 129, 0.3);
}

.status-archived {
    background: rgba(107, 114, 128, 0.2);
    color: rgba(255, 255, 255, 0.6);
    border: 1px solid rgba(107, 114, 128, 0.3);
}

/* Améliorations pour le thème clair */
body:not(.dark-theme) .step-number {
    background: rgba(0, 0, 0, 0.05);
    border-color: rgba(0, 0, 0, 0.1);
    color: rgba(0, 0, 0, 0.5);
}

body:not(.dark-theme) .preview-card {
    background: rgba(0, 0, 0, 0.02);
}

body:not(.dark-theme) .summary-item {
    background: rgba(0, 0, 0, 0.02);
}

/* Transition fluide pour tous les éléments */
* {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
}
</style>


</head>

<body class="dark-theme">
    <!-- Particles Background -->
    <div id="particles-js"></div>
    
    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">
                    <img src="assets/images/icon.png" alt="logo secura">
                </div>
                <div class="sidebar-logo-text">
                    <h1>SECURA</h1>
                    <p>Gestion Sécurisée</p>
                </div>
            </div>
            <button class="sidebar-close action-btn" id="sidebarClose" aria-label="Fermer le menu">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <!-- Profile Section -->
        <div class="sidebar-profile">
            <div class="profile-avatar large">
                <i class="bi bi-person-circle"></i>
            </div>
            <div class="profile-details">
                <strong id="sidebarProfileName">Chargement...</strong>
                <small id="sidebarProfileEmail">email@exemple.com</small>
                <span class="badge-role" id="sidebarProfileRole">Utilisateur</span>
            </div>
        </div>
        <!-- Navigation Links -->
        <div id="navMenu" class="sidebar-menu">
            <a href="index.html" class="sidebar-link">
                <i class="fas fa-home"></i>
                <span>Accueil</span>
            </a>
            <a href="events.html" class="sidebar-link active">
                <i class="fas fa-calendar-alt"></i>
                <span>Événements</span>
            </a>
            <a href="guests.html" class="sidebar-link">
                <i class="fas fa-users"></i>
                <span>Invités</span>
            </a>
<a href="tables.html" class="sidebar-link">
                <i class="fas fa-chair"></i>
                <span>Tables</span>
            </a>
            <a href="galleries.html" class="sidebar-link active">
                <i class="fas fa-images"></i>
                <span>Galeries</span>
            </a>
            <a href="qr-generator.html" class="sidebar-link">
                <i class="bi bi-qr-code"></i>
                <span>Générateur QR</span>
            </a>
            <a href="ticket-generator.html" class="sidebar-link">
                <i class="fas fa-ticket-alt"></i>
                <span>Billets</span>
            </a>
            <a href="checkin.html" class="sidebar-link">
                <i class="fas fa-clipboard-check"></i>
                <span>Validation de Présence</span>
            </a>
            <hr class="sidebar-divider">
            <a href="profile.html" class="sidebar-link">
                <i class="fas fa-user"></i>
                <span>Mon Profil</span>
            </a>
            <a href="settings.html" class="sidebar-link">
                <i class="fas fa-cog"></i>
                <span>Paramètres</span>
            </a>
            <button class="sidebar-link text-danger" id="sidebarLogout">
                <i class="fas fa-sign-out-alt"></i>
                <span>Déconnexion</span>
            </button>
        </div>
        <!-- Footer -->
        <div class="sidebar-footer">
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
                <span>Mode Sombre</span>
            </button>
            <button class="fullscreen-toggle" id="fullscreenToggle">
                <i class="fas fa-expand"></i>
                <span>Plein écran</span>
            </button>
        </div>
    </nav>
    
    <!-- Overlay pour fermer la sidebar -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    
    <!-- Bouton flottant pour ouvrir la sidebar -->
    <button class="sidebar-toggle" id="sidebarToggle" aria-label="Ouvrir le menu">
        <i class="fas fa-bars"></i>
    </button>
    
    <!-- Top Bar -->
    <header class="header">
            <div class="header-content">
                <a href="index.html" class="logo-section" style="text-decoration: none; display: flex; align-items: center; gap: 12px; cursor: pointer;">
                    <div class="logo-icon">
                        <img src="assets/images/icon.png" alt="logo secura">
                    </div>
                    <div class="logo-text">
                        <h1>SECURA</h1>
                        <p>Tableau de Bord </p>
                    </div>
                </a>
                
                
                <!-- Profile Button -->
                <button class="profile-toggle header-profile-btn" id="profileToggle" aria-haspopup="true" aria-expanded="false">
                    <div class="profile-avatar">
                        <i class="bi bi-person-circle"></i>
                    </div>
                    <div class="profile-info">
                        <span class="profile-name" id="profileName">Chargement...</span>
                        <span class="profile-role" id="profileRole">Utilisateur</span>
                    </div>
                    <i class="bi bi-chevron-down profile-arrow"></i>
                </button>
            </div>
        </header>
    
    <!-- Profile Menu -->
    <div class="floating-profile-menu" id="floatingProfileMenu">
        <div class="profile-dropdown show" id="profileDropdown" role="menu">
            <div class="profile-header">
                <div class="profile-avatar large">
                    <i class="bi bi-person-circle"></i>
                </div>
                <div class="profile-details">
                    <strong id="dropdownName">Chargement...</strong>
                    <small id="dropdownEmail">email@exemple.com</small>
                    <span class="badge-role" id="dropdownRole">Utilisateur</span>
                </div>
            </div>
            <div class="dropdown-actions">
                <a href="profile.html" class="dropdown-item" role="menuitem">
                    <i class="bi bi-person"></i> Mon Profil
                </a>
                <a href="settings.html" class="dropdown-item" role="menuitem">
                    <i class="bi bi-gear"></i> Paramètres
                </a>
                <hr class="dropdown-divider">
                <button class="dropdown-item text-danger" id="logout-btn" role="menuitem">
                    <i class="bi bi-box-arrow-right"></i> Déconnexion
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="event-form-main main-content" id="mainContent">
        <div class="form-wrapper">
            <!-- Panneau de progression (gauche) -->
            <div class="progress-panel">
                <div class="progress-title">CRÉATION D'ÉVÉNEMENT</div>
                
                <div class="steps-container">
                    <div class="step-item active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-info">
                            <span class="step-label">Informations de base</span>
                            <span class="step-description">Nom, date et lieu</span>
                        </div>
                    </div>
                    
                    <div class="step-item" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-info">
                            <span class="step-label">Paramètres</span>
                            <span class="step-description">Options et fonctionnalités</span>
                        </div>
                    </div>
                    
                    <div class="step-item" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-info">
                            <span class="step-label">Personnalisation</span>
                            <span class="step-description">Design et apparence</span>
                        </div>
                    </div>
                    
                    <div class="step-item" data-step="4">
                        <div class="step-number">4</div>
                        <div class="step-info">
                            <span class="step-label">Confirmation</span>
                            <span class="step-description">Vérification finale</span>
                        </div>
                    </div>
                </div>
                
                <div class="progress-info">
                    <div class="progress-text">Progression</div>
                    <div class="progress-percentage" id="progressPercentage">25%</div>
                </div>
            </div>

            <!-- Panneau de formulaire (droite) -->
            <div class="form-panel">
                <!-- Étape 1: Informations de base -->
                <div class="step-content active" id="step1">
                    <div class="form-header">
                        <h2 class="form-title">Informations de base</h2>
                        <p class="form-subtitle">Définissez les informations essentielles de votre événement</p>
                    </div>

                    <form id="step1Form">
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-info-circle"></i> Identification</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-signature"></i>
                                        Nom de l'événement
                                        <span class="required">*</span>
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="text" id="eventName" class="form-control" 
                                               placeholder="Ex: Conférence Tech 2024" required maxlength="100">
                                        <i class="fas fa-signature input-icon"></i>
                                    </div>
                                    <div class="validation-message" id="nameValidation"></div>
                                    <div class="form-help">Maximum 100 caractères</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-tag"></i>
                                        Type d'événement
                                        <span class="required">*</span>
                                    </label>
                                    <select id="eventType" class="form-control" required>
                                        <option value="">Sélectionnez un type</option>
                                        <option value="marriage">Mariage</option>
                                        <option value="anniversaire">Anniversaire</option>
                                        <option value="conference">Conférence</option>
                                        <option value="corporate">Corporate</option>
                                        <option value="concert">Concert</option>
                                        <option value="gala">Gala</option>
                                        <option value="football">Football</option>
                                        <option value="autre">Autre</option>
                                    </select>
                                    <div class="validation-message" id="typeValidation"></div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-calendar-alt"></i> Date et lieu</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-calendar-day"></i>
                                        Date
                                        <span class="required">*</span>
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="date" id="eventDate" class="form-control" required>
                                        <i class="fas fa-calendar-day input-icon"></i>
                                    </div>
                                    <div class="validation-message" id="dateValidation"></div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-clock"></i>
                                        Heure
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="time" id="eventTime" class="form-control">
                                        <i class="fas fa-clock input-icon"></i>
                                    </div>
                                    <div class="form-help">Format HH:MM</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Lieu
                                    <span class="required">*</span>
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" id="eventLocation" class="form-control" 
                                           placeholder="Adresse complète" required maxlength="200">
                                    <i class="fas fa-map-marker-alt input-icon"></i>
                                </div>
                                <div class="validation-message" id="locationValidation"></div>
                                <div class="form-help">Maximum 200 caractères</div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-users"></i> Capacité</h3>
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-user-friends"></i>
                                    Nombre maximum de participants
                                </label>
                                <div class="input-wrapper">
                                    <input type="number" id="eventCapacity" class="form-control" 
                                           placeholder="Laisser vide pour illimité" min="1" max="100000">
                                    <i class="fas fa-user-friends input-icon"></i>
                                </div>
                                <div class="validation-message" id="capacityValidation"></div>
                                <div class="form-help">Entre 1 et 100000, laisser vide pour illimité</div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-align-left"></i> Description</h3>
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-file-alt"></i>
                                    Description de l'événement
                                </label>
                                <textarea id="eventDescription" class="form-control" 
                                          placeholder="Décrivez votre événement en détail..." 
                                          rows="5" maxlength="1000"></textarea>
                                <div class="char-count" id="descriptionCharCount">0/1000 caractères</div>
                                <div class="form-help">Cette description sera visible par les participants</div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-comment-alt"></i>
                                    Message de bienvenue
                                </label>
                                <textarea id="eventWelcomeMessage" class="form-control" 
                                          placeholder="Message affiché lors du scan des billets..." 
                                          rows="3" maxlength="500"></textarea>
                                <div class="char-count" id="welcomeCharCount">0/500 caractères</div>
                                <div class="form-help">Message personnalisé pour les participants</div>
                            </div>
                        </div>
                    </form>

                    <div class="navigation-buttons">
                        <button class="btn btn-save-draft" id="saveDraftBtn">
                            <i class="fas fa-save"></i>
                            Sauvegarder brouillon
                        </button>
                        <button class="btn btn-next" id="nextStep1">
                            Suivant
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Étape 2: Paramètres -->
                <div class="step-content" id="step2">
                    <div class="form-header">
                        <h2 class="form-title">Paramètres avancés</h2>
                        <p class="form-subtitle">Configurez les options et fonctionnalités de votre événement</p>
                    </div>

                    <form id="step2Form">
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-user-plus"></i> Inscriptions</h3>
                            
                            <div class="form-group">
                                <div class="checkbox-label">
                                    <input type="checkbox" id="allowRegistration" checked>
                                    <label for="allowRegistration">
                                        <strong>Autoriser les inscriptions</strong>
                                    </label>
                                </div>
                                <div class="form-help">
                                    Les invités pourront s'inscrire via un lien public
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-user-check"></i>
                                        Validation des inscriptions
                                    </label>
                                    <select id="registrationApproval" class="form-control">
                                        <option value="auto">Automatique (acceptation immédiate)</option>
                                        <option value="manual">Manuelle (validation requise)</option>
                                    </select>
                                    <div class="form-help">
                                        Contrôlez comment les inscriptions sont validées
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-user-friends"></i>
                                        Invités max par inscription
                                    </label>
                                    <div class="input-wrapper">
                                        <input type="number" id="maxGuestsPerUser" class="form-control" 
                                               value="5" min="1" max="50">
                                        <i class="fas fa-user-friends input-icon"></i>
                                    </div>
                                    <div class="form-help">Maximum 50 invités par inscription</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="bi bi-qr-code"></i> Codes QR</h3>
                            
                            <div class="form-group">
                                <div class="checkbox-label">
                                    <input type="checkbox" id="autoGenerateQRCodes" checked>
                                    <label for="autoGenerateQRCodes">
                                        <strong>Génération automatique des codes QR</strong>
                                    </label>
                                </div>
                                <div class="form-help">
                                    Un code QR unique sera généré pour chaque invité
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <div class="checkbox-label">
                                    <input type="checkbox" id="allowQRSharing" checked>
                                    <label for="allowQRSharing">
                                        <strong>Autoriser le partage des codes QR</strong>
                                    </label>
                                </div>
                                <div class="form-help">
                                    Les invités pourront partager leur code QR
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-cog"></i> Fonctionnalités</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="checkbox-label">
                                        <input type="checkbox" id="enablePhotoGallery">
                                        <label for="enablePhotoGallery">
                                            <strong>Galerie photo</strong>
                                        </label>
                                    </div>
                                    <div class="form-help">
                                        Album photos de l'événement
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="checkbox-label">
                                        <input type="checkbox" id="enableGuestMessages">
                                        <label for="enableGuestMessages">
                                            <strong>Messages invités</strong>
                                        </label>
                                    </div>
                                    <div class="form-help">
                                        Livre d'or numérique
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <div class="checkbox-label">
                                        <input type="checkbox" id="enableTableQR">
                                        <label for="enableTableQR">
                                            <strong>QR par table</strong>
                                        </label>
                                    </div>
                                    <div class="form-help">
                                        Codes QR pour les tables
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <div class="checkbox-label">
                                        <input type="checkbox" id="enableNotifications">
                                        <label for="enableNotifications">
                                            <strong>Notifications push</strong>
                                        </label>
                                    </div>
                                    <div class="form-help">
                                        Alertes pendant l'événement
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-eye"></i> Visibilité</h3>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-globe"></i>
                                    Type de visibilité
                                </label>
                                <select id="eventVisibility" class="form-control">
                                    <option value="private">Privé (par invitation seulement)</option>
                                    <option value="public">Public (visible par tous)</option>
                                    <option value="unlisted">Non listé (accessible par lien)</option>
                                </select>
                                <div class="form-help">
                                    Contrôlez qui peut voir votre événement
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-tags"></i>
                                    Tags
                                </label>
                                <div class="input-wrapper">
                                    <input type="text" id="eventTags" class="form-control" 
                                           placeholder="Ex: tech, conférence, réseautage">
                                    <i class="fas fa-tags input-icon"></i>
                                </div>
                                <div class="form-help">
                                    Séparez les tags par des virgules
                                </div>
                                <div class="tags-container" id="tagsContainer"></div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-clock"></i> Fuseau horaire</h3>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-globe-africa"></i>
                                    Fuseau horaire
                                </label>
                                <select id="eventTimezone" class="form-control">
                                    <option value="Africa/Douala">Douala (GMT+1)</option>
                                    <option value="Europe/Paris">Paris (GMT+1/2)</option>
                                    <option value="America/New_York">New York (GMT-5/-4)</option>
                                    <option value="Asia/Tokyo">Tokyo (GMT+9)</option>
                                    <option value="Australia/Sydney">Sydney (GMT+10/+11)</option>
                                </select>
                                <div class="form-help">
                                    Définit le fuseau horaire pour toutes les heures de l'événement
                                </div>
                            </div>
                        </div>
                    </form>

                    <div class="navigation-buttons">
                        <button class="btn btn-prev" id="prevStep2">
                            <i class="fas fa-arrow-left"></i>
                            Précédent
                        </button>
                        <button class="btn btn-next" id="nextStep2">
                            Suivant
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Étape 3: Personnalisation -->
                <div class="step-content" id="step3">
                    <div class="form-header">
                        <h2 class="form-title">Personnalisation</h2>
                        <p class="form-subtitle">Personnalisez l'apparence et le design de votre événement</p>
                    </div>

                    <form id="step3Form">
                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-palette"></i> Couleurs</h3>
                            
                            <div class="form-row" style="display: flex !important;">
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-paint-brush"></i>
                                        Couleur principale
                                        <span class="required">*</span>
                                    </label>
                                    <div class="color-picker-group">
                                        <div class="color-preview" id="primaryColorPreview" 
                                            style="background-color: #D97706;">
                                            <input type="color" id="eventPrimaryColor" value="#D97706" class="color-input">
                                        </div>
                                        <input type="text" id="primaryColorText" class="color-text-input" 
                                            value="#D97706" maxlength="7" placeholder="#RRGGBB">
                                    </div>
                                    <div class="validation-message" id="colorValidation"></div>
                                    <div class="form-help">Format hexadécimal (#RRGGBB)</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">
                                        <i class="fas fa-paint-brush"></i>
                                        Couleur secondaire
                                    </label>
                                    <div class="color-picker-group">
                                        <div class="color-preview" id="secondaryColorPreview" 
                                            style="background-color: #3B82F6;">
                                            <input type="color" id="eventSecondaryColor" value="#3B82F6" class="color-input">
                                        </div>
                                        <input type="text" id="secondaryColorText" class="color-text-input" 
                                            value="#3B82F6" maxlength="7" placeholder="#RRGGBB">
                                    </div>
                                    <div class="form-help">Utilisée pour les accents et bordures</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                        <h3 class="section-title"><i class="fas fa-images"></i> Images</h3>
                        
                        <div class="form-row" >
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-image"></i>
                                    Image de fond
                                </label>
                                <div class="image-upload-container">
                                    <div class="image-preview" id="backgroundPreview">
                                        <div class="image-overlay">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <p>Cliquez pour ajouter une image</p>
                                            <p class="form-help">Taille recommandée: 1920x1080px</p>
                                        </div>
                                    </div>
                                    
                                    <input type="file" id="eventBackgroundImage" accept="image/*" style="display: none;">
                                </div>
                                <div class="form-help">
                                    Sera utilisée comme arrière-plan des cartes
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-camera"></i>
                                    Logo
                                </label>
                                <div class="image-upload-container">
                                    <div class="image-preview" id="logoPreview">
                                        <div class="image-overlay">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <p>Cliquez pour ajouter un logo</p>
                                            <p class="form-help">Taille recommandée: 200x200px</p>
                                        </div>
                                    </div>
                                    <div class="image-actions" id="logoActions">
                                        <button class="image-action-btn change" id="changeLogoBtn">
                                            <i class="fas fa-pencil-alt"></i>
                                        </button>
                                        <button class="image-action-btn remove" id="removeLogoBtn">
                                            <i class="bi bi-trash3"></i>
                                        </button>
                                    </div>
                                    <input type="file" id="eventLogo" accept="image/*" style="display: none;">
                                </div>
                                <div class="form-help">
                                    Logo affiché sur les billets et invitations
                                </div>
                            </div>
                        </div>
                    </div>

                        <div class="form-section">
                            <h3 class="section-title"><i class="fas fa-desktop"></i> Thème</h3>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-paint-roller"></i>
                                    Style de thème
                                </label>
                                <select id="eventTheme" class="form-control">
                                    <option value="modern">Moderne</option>
                                    <option value="classic">Classique</option>
                                    <option value="elegant">Élégant</option>
                                    <option value="minimal">Minimaliste</option>
                                    <option value="festive">Festif</option>
                                </select>
                                <div class="form-help">
                                    Affecte la présentation globale de l'événement
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="fas fa-code"></i>
                                    CSS personnalisé
                                </label>
                                <textarea id="eventCustomCSS" class="form-control" 
                                          placeholder="/* Votre CSS personnalisé */" 
                                          rows="5" spellcheck="false"></textarea>
                                <div class="form-help">
                                    Pour les développeurs avancés seulement
                                </div>
                            </div>
                        </div>

                        <!-- Aperçu en temps réel -->
                        <div class="preview-container">
                            <div class="preview-title">
                                <i class="fas fa-eye"></i>
                                Aperçu de la carte
                            </div>
                            <div class="card-preview" id="eventCardPreview">
                                <div class="card-preview-image" id="previewImage" 
                                     style="background-image: url('https://images.unsplash.com/photo-1511578314322-379afb476865?w=800&q=80');">
                                    <div class="card-preview-overlay">
                                        <div class="card-preview-title" id="previewTitle">Nom de l'événement</div>
                                        <div class="card-preview-meta">
                                            <span id="previewDate"><i class="fas fa-calendar-alt"></i> Date non définie</span>
                                            <span id="previewLocation"><i class="fas fa-map-marker-alt"></i> Lieu non défini</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="preview-card">
                                <div class="preview-card-stats">
                                    <div class="preview-stat">
                                        <div class="preview-stat-value" id="previewCapacity">∞</div>
                                        <div class="preview-stat-label">Capacité</div>
                                    </div>
                                    <div class="preview-stat">
                                        <div class="preview-stat-value">0</div>
                                        <div class="preview-stat-label">Invités</div>
                                    </div>
                                    <div class="preview-stat">
                                        <div class="preview-stat-value">0%</div>
                                        <div class="preview-stat-label">Présents</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>

                    <div class="navigation-buttons">
                        <button class="btn btn-prev" id="prevStep3">
                            <i class="fas fa-arrow-left"></i>
                            Précédent
                        </button>
                        <button class="btn btn-next" id="nextStep3">
                            Suivant
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Étape 4: Confirmation -->
                <div class="step-content" id="step4">
                    <div class="form-header">
                        <h2 class="form-title">Confirmation</h2>
                        <p class="form-subtitle">Vérifiez toutes les informations avant de créer votre événement</p>
                    </div>

                    <div class="preview-container" style="background: transparent;">
                        <div class="summary-section">
                            <h3 class="summary-title"><i class="fas fa-info-circle"></i> Informations principales</h3>
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <strong>Nom </strong>
                                    <span id="summaryName">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Type </strong>
                                    <span id="summaryType">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Date </strong>
                                    <span id="summaryDate">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Heure </strong>
                                    <span id="summaryTime">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Lieu </strong>
                                    <span id="summaryLocation">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Capacité </strong>
                                    <span id="summaryCapacity">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="summary-section">
                            <h3 class="summary-title"><i class="fas fa-sliders-h"></i> Paramètres</h3>
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <strong>Inscriptions </strong>
                                    <span id="summaryRegistration">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Validation </strong>
                                    <span id="summaryApproval">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Codes QR </strong>
                                    <span id="summaryQR">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Fonctionnalités </strong>
                                    <span id="summaryFeatures">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Visibilité </strong>
                                    <span id="summaryVisibility">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Fuseau horaire </strong>
                                    <span id="summaryTimezone">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="summary-section">
                            <h3 class="summary-title"><i class="fas fa-palette"></i> Design</h3>
                            <div class="summary-grid">
                                <div class="summary-item">
                                    <strong>Couleur principale </strong>
                                    <span id="summaryPrimaryColor">-</span>
                                    <div class="color-preview" id="summaryColorPreview" 
                                        style="width: 20px; height: 20px; display: inline-block; vertical-align: middle; margin-left: 10px; cursor: default;">
                                    </div>
                                </div> <!-- Fermer ce div -->
                                <div class="summary-item">
                                    <strong>Thème </strong>
                                    <span id="summaryTheme">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Image de fond </strong>
                                    <span id="summaryBackground">-</span>
                                </div>
                                <div class="summary-item">
                                    <strong>Logo </strong>
                                    <span id="summaryLogo">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="summary-section">
                            <h3 class="summary-title"><i class="fas fa-align-left"></i> Description</h3>
                            <div class="summary-grid">
                            <div class="summary-item" style="display: grid; grid-column: 1 / -1 !important;">
                                <strong>Description </strong>
                                <div id="summaryDescription" style="margin-top: 8px; font-style: italic;">
                                    Aucune description fournie
                                </div>
                            </div>
                             <div class="summary-item" style="display: grid; grid-column: 1 / -1 !important;">
                                <strong> Message de bienvenue </strong>
                                <div id="summaryWelcomeMessage" style="margin-top: 8px; font-style: italic;">
                                    Aucun Message de bienvenue fournie
                                </div>
                            </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="navigation-buttons">
                        <div class="actions">
                            <button class="btn btn-prev" id="prevStep4">
                                <i class="fas fa-arrow-left"></i>
                                Précédent
                            </button>
                            <button class="btn btn-save-draft" id="editEventBtn" style="margin-left: 15px;">
                                <i class="bi bi-pencil-square"></i> Modifier
                            </button>
                        </div>
                        <div>
                            <button class="btn btn-submit" id="submitEvent">
                                <i class="fas fa-check-circle"></i>
                                Créer l'événement
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-top">
                <div class="row">
                    <div class="col-lg-4 mb-5 mb-lg-0">
                        <div class="footer-brand">
                            <div class="footer-logo">
                                <img src="assets/images/icon.png" alt="SECURA Logo">
                            </div>
                            <div class="footer-title">
                                <h3>SECURA</h3>
                                <p>Plateforme d'accès événementiel</p>
                            </div>
                        </div>
                        <p class="footer-description">
                            SECURA révolutionne l'accès aux événements avec des solutions innovantes, 
                            sécurisées et intuitives pour organisateurs et participants.
                        </p>
                        <div class="social-links">
                            <a href="#" class="social-link">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-twitter"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-linkedin-in"></i>
                            </a>
                            <a href="#" class="social-link">
                                <i class="fab fa-youtube"></i>
                            </a>
                        </div>
                    </div>
                    
                    <div class="col-lg-2 col-md-4 mb-5">
                        <h4>Navigation</h4>
                        <ul class="footer-links">
                            <li><a href="index.html">Accueil</a></li>
                            <li><a href="access.html">Accès événement</a></li>
                            <li><a href="#features">Fonctionnalités</a></li>
                            <li><a href="#how-it-works">Comment ça marche</a></li>
                        </ul>
                    </div>
                    
                    <div class="col-lg-2 col-md-4 mb-5">
                        <h4>Compte</h4>
                        <ul class="footer-links">
                            <li><a href="login.html">Connexion</a></li>
                            <li><a href="register.html">Inscription</a></li>
                            <li><a href="forgot-password.html">Mot de passe oublié</a></li>
                        </ul>
                    </div>
                    
                    <div class="col-lg-4 col-md-4">
                        <h4>Newsletter</h4>
                        <p class="mb-4">Inscrivez-vous pour recevoir nos actualités et offres exclusives.</p>
                        <form class="newsletter-form" id="newsletterForm">
                            <div class="newsletter-input-group">
                                <input type="email" class="newsletter-input" placeholder="Votre email" required>
                                <button type="submit" class="newsletter-btn">
                                    <i class="fas fa-paper-plane"></i>
                                   
                                </button>
                            </div>
                        </form>
                       
                        <div class="footer-controls-inline">
                            <!-- Theme Switch Button -->
                            <div class="theme-switch-footer">
                                <label class="theme-switch">
                                    <input type="checkbox" id="themeSwitchFooter" aria-label="Basculer le thème">
                                    <span class="theme-switch-slider">
                                        <i class="fas fa-moon"></i>
                                        <i class="fas fa-sun"></i>
                                    </span>
                                </label>
                            </div>

                            <!-- Language Selector -->
                            <div class="language-selector"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <p class="copyright">© 2025 SECURA. Tous droits réservés.</p>
                    </div>
                    <div class="col-md-6">
                        <div class="footer-legal">
                            <a href="#">Mentions légales</a>
                            <a href="#">Confidentialité</a>
                            <a href="#">CGU</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bouton retour en haut -->
    <button class="scroll-top" id="scrollTop" aria-label="Retour en haut">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <!-- Scripts -->
    <script src="js/audio-utils.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            SECURA_AUDIO.preload();
        });
    </script>
    
    <!-- Librairies -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    
    <!-- Scripts locaux -->

    <script src="js/storage.js"></script>
    <script src="js/auth-check.js"></script>
    <script defer src="js/particles-config.js"></script>
    <script defer src="js/theme.js"></script>
    <script defer src="js/main.js"></script>
    <script defer src="js/sidebar.js"></script>
    <script defer src="js/langue.js"></script>
    <script src="js/auth.js"></script>
    
    <script>
        // Variables globales
        let currentStep = 1;
        let eventId = null;
        let isEditing = false;
        let currentUser = null;
        
        // Structure complète des données de l'événement
        let eventData = {
            // Informations de base
            name: '',
            type: '',
            date: '',
            time: '',
            location: '',
            capacity: null,
            description: '',
            welcomeMessage: '',
            active: true,
            status: 'draft',
            organizerId: null, // ← Initialiser à null
            
            // Paramètres
            settings: {
                allowGuestRegistration: true,
                requireApproval: false,
                maxGuestsPerUser: 5,
                allowQRSharing: true,
                autoGenerateQRCodes: true,
                enablePhotoGallery: false,
                enableGuestMessages: false,
                enableTableQR: false,
                enableNotifications: false
            },
            
            // Design
            design: {
                primaryColor: '#D97706',
                secondaryColor: '#3B82F6',
                backgroundImage: null,
                logo: null,
                theme: 'modern',
                customCSS: ''
            },
            
            // Métadonnées
            metadata: {
                tags: [],
                category: 'general',
                visibility: 'private',
                timezone: 'Africa/Douala',
                createdBy: null,
                updatedBy: null // ← Ajouter updatedBy
            },
            
            // Statistiques (initiales)
            stats: {
                totalGuests: 0,
                confirmedGuests: 0,
                scannedGuests: 0,
                totalScans: 0,
                scanRate: 0,
                lastScan: null
            }
        };


        // Initialisation
        document.addEventListener('DOMContentLoaded', async function() {
           
            currentUser = await storage.getProfile();
            eventData.metadata.createdBy = currentUser.id;

            if (!isEditing) {
                eventData.organizerId = currentUser?.id;
                eventData.metadata.createdBy = currentUser?.id;
                eventData.metadata.updatedBy = currentUser?.id;
            }
            
            // Vérifier si c'est une édition
            const urlParams = new URLSearchParams(window.location.search);
            eventId = urlParams.get('id');
            
            if (eventId) {
                isEditing = true;
                await loadEventForEditing();
            } else {
                initializeFormWithDefaults();
            }
            
            // Initialiser les écouteurs
            initEventListeners();
            
            // Mettre à jour la prévisualisation
            updatePreview();
            
            // Charger la progression sauvegardée
            loadProgress();
            
            // Focus sur le premier champ
            document.getElementById('eventName')?.focus();
        });

        function initializeFormWithDefaults() {
            const defaultDate = new Date();
            defaultDate.setDate(defaultDate.getDate() + 30);
            const formattedDate = defaultDate.toISOString().split('T')[0];
            
            document.getElementById('eventDate').value = formattedDate;
            document.getElementById('eventDate').min = new Date().toISOString().split('T')[0];
            
            document.getElementById('eventTime').value = '18:00';
            
            updateEventDataFromForm();
        }

        function canUserEditEvent(event) {
            const currentUserId = currentUser?.id;
            const isAdmin = currentUser?.role === 'admin';
            
            if (isAdmin) return true;
            
            return event.organizerId === currentUserId || 
                event.metadata?.createdBy === currentUserId;
        }

        async function loadEventForEditing() {
            try {
                const event = storage.getEventById(eventId);
           
                if (!event) {
                    await Swal.fire({
                        icon: 'error',
                        title: 'Événement introuvable',
                        text: 'L\'événement que vous essayez de modifier n\'existe pas',
                        confirmButtonColor: '#D97706'
                    });
                    window.location.href = 'events.html';
                    return;
                }

                if (!canUserEditEvent(event)) {
                    await Swal.fire({
                        icon: 'warning',
                        title: 'Accès refusé',
                        text: 'Vous n\'êtes pas autorisé à modifier cet événement',
                        confirmButtonColor: '#D97706'
                    });
                    window.location.href = 'events.html';
                    return;
                }
                
                eventData = { ...eventData, ...event };
                const name = eventData.name;


                if (!eventData.organizerId) {
                    eventData.organizerId = currentUser?.id;
                }

                document.querySelector('.form-title').textContent = name;
                document.querySelector('.form-subtitle').textContent = 'Modifiez les informations de votre événement';
                document.getElementById('submitEvent').innerHTML = '<i class="fas fa-save"></i> Enregistrer';
                document.querySelector('.progress-title').textContent = 'MODIFICATION D\'ÉVÉNEMENT';
                
                // Remplir les champs
                populateFormFields();
                updateSummary();
                updatePreview();
                
                // Mettre à jour l'indicateur de statut
                updateStatusIndicator();
                
            } catch (error) {
                console.error('Erreur chargement événement:', error);
                await Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de charger l\'événement',
                    confirmButtonColor: '#D97706'
                });
                window.location.href = 'events.html';
            }
        }

        // Remplir les champs du formulaire
        function populateFormFields() {
            // Informations de base
            document.getElementById('eventName').value = eventData.name;
            document.getElementById('eventType').value = eventData.type;
            document.getElementById('eventDate').value = eventData.date;
            document.getElementById('eventTime').value = eventData.time;
            document.getElementById('eventLocation').value = eventData.location;
            document.getElementById('eventCapacity').value = eventData.capacity || '';
            document.getElementById('eventDescription').value = eventData.description;
            document.getElementById('eventWelcomeMessage').value = eventData.welcomeMessage;
            
            // Paramètres
            document.getElementById('allowRegistration').checked = eventData.settings.allowGuestRegistration;
            document.getElementById('registrationApproval').value = eventData.settings.requireApproval ? 'manual' : 'auto';
            document.getElementById('maxGuestsPerUser').value = eventData.settings.maxGuestsPerUser;
            document.getElementById('autoGenerateQRCodes').checked = eventData.settings.autoGenerateQRCodes;
            document.getElementById('allowQRSharing').checked = eventData.settings.allowQRSharing;
            document.getElementById('enablePhotoGallery').checked = eventData.settings.enablePhotoGallery;
            document.getElementById('enableGuestMessages').checked = eventData.settings.enableGuestMessages;
            document.getElementById('enableTableQR').checked = eventData.settings.enableTableQR;
            document.getElementById('enableNotifications').checked = eventData.settings.enableNotifications;
            document.getElementById('eventVisibility').value = eventData.metadata.visibility;
            document.getElementById('eventTags').value = eventData.metadata.tags?.join(', ') || '';
            document.getElementById('eventTimezone').value = eventData.metadata.timezone;
            
            // Design
            document.getElementById('eventPrimaryColor').value = eventData.design.primaryColor;
            document.getElementById('primaryColorText').value = eventData.design.primaryColor;
            document.getElementById('primaryColorPreview').style.backgroundColor = eventData.design.primaryColor;
            
            document.getElementById('eventSecondaryColor').value = eventData.design.secondaryColor;
            document.getElementById('secondaryColorText').value = eventData.design.secondaryColor;
            document.getElementById('secondaryColorPreview').style.backgroundColor = eventData.design.secondaryColor;
            
            document.getElementById('eventTheme').value = eventData.design.theme;
            document.getElementById('eventCustomCSS').value = eventData.design.customCSS;
            
            // Mettre à jour les compteurs de caractères
            updateCharCount('eventDescription', 'descriptionCharCount', 1000);
            updateCharCount('eventWelcomeMessage', 'welcomeCharCount', 500);

            if (eventData.design.backgroundImage) {
                updateImagePreview('background', eventData.design.backgroundImage, 'Image de fond');
            }
            
            if (eventData.design.logo) {
                    updateImagePreview('logo', eventData.design.logo, 'Logo');
            } else {
                    document.getElementById('logoActions').style.display = 'none';
            }
                
            
            updateTagsDisplay();
        }

        // Initialiser les écouteurs d'événements
        function initEventListeners() {
            // Navigation des étapes
            document.getElementById('nextStep1').addEventListener('click', () => validateAndGoToStep(1, 2));
            document.getElementById('nextStep2').addEventListener('click', () => validateAndGoToStep(2, 3));
            document.getElementById('nextStep3').addEventListener('click', () => validateAndGoToStep(3, 4));
            
            document.getElementById('prevStep2').addEventListener('click', () => goToStep(1));
            document.getElementById('prevStep3').addEventListener('click', () => goToStep(2));
            document.getElementById('prevStep4').addEventListener('click', () => goToStep(3));
            
            // Bouton d'édition depuis la confirmation
            document.getElementById('editEventBtn').addEventListener('click', () => {
                Swal.fire({
                    title: 'Modifier quelle étape ?',
                    input: 'select',
                    inputOptions: {
                        1: 'Étape 1: Informations de base',
                        2: 'Étape 2: Paramètres',
                        3: 'Étape 3: Personnalisation'
                    },
                    inputPlaceholder: 'Sélectionnez une étape',
                    background: 'var(--card-bg)',
                    showCancelButton: true,
                    confirmButtonText: 'Modifier',
                    cancelButtonText: 'Annuler',
                    confirmButtonColor: '#D97706'
                }).then((result) => {
                    if (result.isConfirmed && result.value) {
                        goToStep(parseInt(result.value));
                    }
                });
            });
            
            // Validation en temps réel
            setupRealTimeValidation();
            
            // Compteurs de caractères
            document.getElementById('eventDescription').addEventListener('input', () => {
                updateCharCount('eventDescription', 'descriptionCharCount', 1000);
                updateEventDataFromForm();
            });
            
            document.getElementById('eventWelcomeMessage').addEventListener('input', () => {
                updateCharCount('eventWelcomeMessage', 'welcomeCharCount', 500);
                updateEventDataFromForm();
            });
            
            // Gestion des tags
            document.getElementById('eventTags').addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ',') {
                    e.preventDefault();
                    addTagFromInput();
                }
            });
            
            document.getElementById('eventTags').addEventListener('blur', addTagFromInput);
            
            // Gestion des couleurs
            document.getElementById('eventPrimaryColor').addEventListener('input', function() {
                document.getElementById('primaryColorText').value = this.value;
                document.getElementById('primaryColorPreview').style.backgroundColor = this.value;
                updateEventDataFromForm();
                updatePreview();
            });
            
            document.getElementById('primaryColorText').addEventListener('input', function() {
                const color = this.value;
                if (/^#[0-9A-F]{6}$/i.test(color)) {
                    document.getElementById('eventPrimaryColor').value = color;
                    document.getElementById('primaryColorPreview').style.backgroundColor = color;
                    updateEventDataFromForm();
                    updatePreview();
                }
            });
            
            document.getElementById('eventSecondaryColor').addEventListener('input', function() {
                document.getElementById('secondaryColorText').value = this.value;
                document.getElementById('secondaryColorPreview').style.backgroundColor = this.value;
                updateEventDataFromForm();
                updatePreview();
            });
            
            document.getElementById('secondaryColorText').addEventListener('input', function() {
                const color = this.value;
                if (/^#[0-9A-F]{6}$/i.test(color)) {
                    document.getElementById('eventSecondaryColor').value = color;
                    document.getElementById('secondaryColorPreview').style.backgroundColor = color;
                    updateEventDataFromForm();
                    updatePreview();
                }
            });
            
            // Upload d'images
                document.getElementById('backgroundPreview').addEventListener('click', () => {
                    document.getElementById('eventBackgroundImage').click();
                });
                
                document.getElementById('logoPreview').addEventListener('click', () => {
                    document.getElementById('eventLogo').click();
                });
                
               
                
             
                
                document.getElementById('eventBackgroundImage').addEventListener('change', (e) => {
                    handleImageUpload(e, 'background');
                });
                
                document.getElementById('eventLogo').addEventListener('change', (e) => {
                    handleImageUpload(e, 'logo');
                });
                
                // Drag and drop pour les images
                ['backgroundPreview', 'logoPreview'].forEach(id => {
                    const element = document.getElementById(id);
                    
                    element.addEventListener('dragover', (e) => {
                        e.preventDefault();
                        element.style.borderColor = 'var(--primary)';
                        element.style.background = 'rgba(217, 119, 6, 0.1)';
                    });
                    
                    element.addEventListener('dragleave', (e) => {
                        e.preventDefault();
                        element.style.borderColor = '';
                        element.style.background = '';
                    });
                    
                    element.addEventListener('drop', (e) => {
                        e.preventDefault();
                        element.style.borderColor = '';
                        element.style.background = '';
                        
                        const files = e.dataTransfer.files;
                        if (files.length > 0) {
                            const file = files[0];
                            if (file.type.startsWith('image/')) {
                                const type = id === 'backgroundPreview' ? 'background' : 'logo';
                                handleFileUpload(file, type);
                            }
                        }
                    });
                });
            
            // Sauvegarde brouillon
            document.getElementById('saveDraftBtn').addEventListener('click', saveDraft);
            
            // Soumission finale
            document.getElementById('submitEvent').addEventListener('click', submitEvent);
            
            // Clic sur les étapes de progression
            document.querySelectorAll('.step-item').forEach(item => {
                item.addEventListener('click', async () => {
                    const step = parseInt(item.dataset.step);
                    if (step < currentStep) {
                        await goToStep(step);
                    } else if (step > currentStep) {
                        // Valider l'étape actuelle avant d'aller à la suivante
                        await validateAndGoToStep(currentStep, step);
                    }
                });
            });
        }

        // Configurer la validation en temps réel
        function setupRealTimeValidation() {
            // Étape 1
            document.getElementById('eventName').addEventListener('input', updateEventDataFromForm);
            document.getElementById('eventType').addEventListener('change', updateEventDataFromForm);
            document.getElementById('eventDate').addEventListener('change', updateEventDataFromForm);
            document.getElementById('eventTime').addEventListener('change', updateEventDataFromForm);
            document.getElementById('eventLocation').addEventListener('input', updateEventDataFromForm);
            document.getElementById('eventCapacity').addEventListener('input', updateEventDataFromForm);
            
            // Étape 2
            document.getElementById('allowRegistration').addEventListener('change', updateEventDataFromForm);
            document.getElementById('registrationApproval').addEventListener('change', updateEventDataFromForm);
            document.getElementById('maxGuestsPerUser').addEventListener('input', updateEventDataFromForm);
            document.getElementById('autoGenerateQRCodes').addEventListener('change', updateEventDataFromForm);
            document.getElementById('allowQRSharing').addEventListener('change', updateEventDataFromForm);
            document.getElementById('enablePhotoGallery').addEventListener('change', updateEventDataFromForm);
            document.getElementById('enableGuestMessages').addEventListener('change', updateEventDataFromForm);
            document.getElementById('enableTableQR').addEventListener('change', updateEventDataFromForm);
            document.getElementById('enableNotifications').addEventListener('change', updateEventDataFromForm);
            document.getElementById('eventVisibility').addEventListener('change', updateEventDataFromForm);
            document.getElementById('eventTimezone').addEventListener('change', updateEventDataFromForm);
            
            // Étape 3
            document.getElementById('eventTheme').addEventListener('change', updateEventDataFromForm);
            document.getElementById('eventCustomCSS').addEventListener('input', updateEventDataFromForm);
        }

        // Mettre à jour les données depuis le formulaire
        function updateEventDataFromForm() {
            // Informations de base
            eventData.name = document.getElementById('eventName').value.trim();
            eventData.type = document.getElementById('eventType').value;
            eventData.date = document.getElementById('eventDate').value;
            eventData.time = document.getElementById('eventTime').value;
            eventData.location = document.getElementById('eventLocation').value.trim();
            
            const capacityValue = document.getElementById('eventCapacity').value;
            eventData.capacity = capacityValue ? parseInt(capacityValue) : null;
            
            eventData.description = document.getElementById('eventDescription').value.trim();
            eventData.welcomeMessage = document.getElementById('eventWelcomeMessage').value.trim();
            
            // Paramètres
            eventData.settings.allowGuestRegistration = document.getElementById('allowRegistration').checked;
            eventData.settings.requireApproval = document.getElementById('registrationApproval').value === 'manual';
            eventData.settings.maxGuestsPerUser = parseInt(document.getElementById('maxGuestsPerUser').value) || 5;
            eventData.settings.autoGenerateQRCodes = document.getElementById('autoGenerateQRCodes').checked;
            eventData.settings.allowQRSharing = document.getElementById('allowQRSharing').checked;
            eventData.settings.enablePhotoGallery = document.getElementById('enablePhotoGallery').checked;
            eventData.settings.enableGuestMessages = document.getElementById('enableGuestMessages').checked;
            eventData.settings.enableTableQR = document.getElementById('enableTableQR').checked;
            eventData.settings.enableNotifications = document.getElementById('enableNotifications').checked;
            
            // Design
            eventData.design.primaryColor = document.getElementById('eventPrimaryColor').value;
            eventData.design.secondaryColor = document.getElementById('eventSecondaryColor').value;
            eventData.design.theme = document.getElementById('eventTheme').value;
            eventData.design.customCSS = document.getElementById('eventCustomCSS').value.trim();
            
            // Métadonnées
            eventData.metadata.visibility = document.getElementById('eventVisibility').value;
            eventData.metadata.timezone = document.getElementById('eventTimezone').value;
            
            // Mettre à jour la prévisualisation
            updatePreview();
            
            // Mettre à jour le récapitulatif si on est à l'étape 4
            if (currentStep === 4) {
                updateSummary();
            }
            
            // Sauvegarder la progression
            saveProgress();
        }

        // Mettre à jour le compteur de caractères
        function updateCharCount(textareaId, counterId, maxLength) {
            const textarea = document.getElementById(textareaId);
            const counter = document.getElementById(counterId);
            const length = textarea.value.length;
            
            counter.textContent = `${length}/${maxLength} caractères`;
            
            // Changer la couleur selon le pourcentage utilisé
            const percentage = (length / maxLength) * 100;
            counter.className = 'char-count';
            
            if (percentage > 90) {
                counter.classList.add('error');
            } else if (percentage > 75) {
                counter.classList.add('warning');
            }
        }

        // Ajouter un tag depuis l'input
        function addTagFromInput() {
            const input = document.getElementById('eventTags');
            const tagText = input.value.trim();
            
            if (tagText && tagText !== ',') {
                const tags = tagText.split(',').map(tag => tag.trim()).filter(tag => tag);
                tags.forEach(tag => {
                    if (!eventData.metadata.tags.includes(tag) && eventData.metadata.tags.length < 10) {
                        eventData.metadata.tags.push(tag);
                    }
                });
                
                input.value = '';
                updateTagsDisplay();
                saveProgress();
            }
        }

        // Supprimer un tag
        function removeTag(tag) {
            eventData.metadata.tags = eventData.metadata.tags.filter(t => t !== tag);
            updateTagsDisplay();
            saveProgress();
        }

        // Mettre à jour l'affichage des tags
        function updateTagsDisplay() {
            const container = document.getElementById('tagsContainer');
            container.innerHTML = '';
            
            eventData.metadata.tags.forEach(tag => {
                const tagElement = document.createElement('div');
                tagElement.className = 'tag';
                tagElement.innerHTML = `
                    ${escapeHtml(tag)}
                    <button class="tag-remove" onclick="removeTag('${escapeHtml(tag)}')">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                container.appendChild(tagElement);
            });
            
            // Afficher le nombre de tags restants
            if (eventData.metadata.tags.length < 10) {
                const remaining = 10 - eventData.metadata.tags.length;
                const info = document.createElement('div');
                info.className = 'form-help';
                info.textContent = `${remaining} tag(s) restant(s)`;
                container.appendChild(info);
            } else {
                const info = document.createElement('div');
                info.className = 'form-help';
                info.textContent = 'Maximum 10 tags atteint';
                container.appendChild(info);
            }
        }

        // Gérer l'upload d'images
        function handleImageUpload(e, type) {
            const file = e.target.files[0];
            if (!file) return;
            
            if (!file.type.startsWith('image/')) {
                Swal.fire({
                    icon: 'error',
                    title: 'Format invalide',
                    text: 'Veuillez sélectionner une image (JPG, PNG, GIF, WebP)',
                    confirmButtonColor: '#D97706',
                    timer: 2000
                });
                return;
            }
            
            // Vérifier la taille (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                Swal.fire({
                    icon: 'error',
                    title: 'Fichier trop volumineux',
                    text: 'L\'image ne doit pas dépasser 5 Mo',
                    confirmButtonColor: '#D97706',
                    timer: 2000
                });
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const imageData = event.target.result;
                
                if (type === 'background') {
                    eventData.design.backgroundImage = imageData;
                    updateImagePreview('background', imageData, file.name);
                } else {
                    eventData.design.logo = imageData;
                    updateImagePreview('logo', imageData, file.name);
                }
                
                updatePreview();
                saveProgress();
                
                // Afficher un message de succès
                Toastify({
                    text: "Image téléchargée avec succès",
                    duration: 3000,
                    gravity: "top",
                    position: "right",
                    backgroundColor: "var(--success)",
                    stopOnFocus: true
                }).showToast();
            };
            
            reader.readAsDataURL(file);
        }

        // Mettre à jour la prévisualisation d'image
        // Mettre à jour la prévisualisation d'image
        function updateImagePreview(type, imageData, fileName = '') {
            const previewId = type === 'background' ? 'backgroundPreview' : 'logoPreview';
            const previewElement = document.getElementById(previewId);
            
            // Nettoyer le contenu
            previewElement.innerHTML = '';
            
            // Créer l'image
            const img = document.createElement('img');
            img.src = imageData;
            img.alt = type === 'background' ? 'Image de fond' : 'Logo';
            
            // Créer l'overlay (différent quand il y a une image)
            const overlay = document.createElement('div');
            overlay.className = 'image-overlay';
            overlay.innerHTML = `
                <i class="fas fa-image"></i>
                <p>Cliquez pour changer</p>
                ${fileName ? `<p class="form-help">${fileName}</p>` : ''}
                <p class="form-help">${type === 'background' ? '1920×1080px' : '200×200px'}</p>
            `;
            
            previewElement.appendChild(img);
            previewElement.appendChild(overlay);
            previewElement.classList.add('has-image');
            
            
        }


        // Gérer le drag and drop de fichiers
        function handleFileUpload(file, type) {
            if (!file.type.startsWith('image/')) {
                Swal.fire({
                    icon: 'error',
                    title: 'Format invalide',
                    text: 'Veuillez sélectionner une image',
                    confirmButtonColor: '#D97706'
                });
                return;
            }
            
            // Vérifier la taille
            if (file.size > 5 * 1024 * 1024) {
                Swal.fire({
                    icon: 'error',
                    title: 'Fichier trop volumineux',
                    text: 'L\'image ne doit pas dépasser 5 Mo',
                    confirmButtonColor: '#D97706'
                });
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(event) {
                const imageData = event.target.result;
                
                if (type === 'background') {
                    eventData.design.backgroundImage = imageData;
                    updateImagePreview('background', imageData, file.name);
                } else {
                    eventData.design.logo = imageData;
                    updateImagePreview('logo', imageData, file.name);
                }
                
                updatePreview();
                saveProgress();
            };
            
            reader.readAsDataURL(file);
        }

        // Supprimer une image
        // Supprimer une image
        function removeImage(type) {
            Swal.fire({
                title: 'Supprimer l\'image ?',
                text: type === 'background' ? 'L\'image de fond sera supprimée' : 'Le logo sera supprimé',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Oui, supprimer',
                cancelButtonText: 'Annuler',
                confirmButtonColor: '#EF4444',
                cancelButtonColor: '#6B7280'
            }).then((result) => {
                if (result.isConfirmed) {
                    const previewId = type === 'background' ? 'backgroundPreview' : 'logoPreview';
                    const previewElement = document.getElementById(previewId);
                    
                    const inputId = type === 'background' ? 'eventBackgroundImage' : 'eventLogo';
                    
                    // Réinitialiser la prévisualisation
                    previewElement.innerHTML = `
                        <div class="image-overlay">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Cliquez pour ajouter ${type === 'background' ? 'une image' : 'un logo'}</p>
                            <p class="form-help">Taille recommandée: ${type === 'background' ? '1920x1080px' : '200x200px'}</p>
                        </div>
                    `;
                    previewElement.classList.remove('has-image');
                    
                   
                    
                    // Réinitialiser l'input file
                    document.getElementById(inputId).value = '';
                    
                    // Supprimer de eventData
                    if (type === 'background') {
                        eventData.design.backgroundImage = null;
                    } else {
                        eventData.design.logo = null;
                    }
                    
                    updatePreview();
                    saveProgress();
                    
                    Toastify({
                        text: "Image supprimée avec succès",
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        backgroundColor: "var(--danger)"
                    }).showToast();
                }
            });
        }

        // Mettre à jour l'aperçu

        function updatePreview() {
    const previewContainer = document.querySelector('.preview-container');
    if (!previewContainer) return;
    
    // Créer la carte d'aperçu selon le style de renderGridView
    const isUpcoming = eventData.date ? new Date(eventData.date) >= new Date() : false;
    const guests = []; // Pour la prévisualisation, on n'a pas encore d'invités
    const scannedGuests = 0;
    
    // Nettoyer le conteneur existant
    previewContainer.innerHTML = `
        <div class="preview-title">
            <i class="fas fa-eye"></i>
            Aperçu de la carte
        </div>
        <div id="eventCardPreview" class="event-card-pro"></div>
    `;
    
    const eventCard = document.getElementById('eventCardPreview');
    
    // Appliquer les styles et contenu
    eventCard.style.backgroundImage = `url('${getEventImage(eventData.type)}')`;
    eventCard.style.borderLeft = `4px solid ${eventData.design?.primaryColor || '#D97706'}`;
    
    eventCard.innerHTML = `
        ${isUpcoming ? '<div class="upcoming-ribbon" style="background: linear-gradient(45deg, #3B82F6, #8B5CF6);">À VENIR</div>' : ''}
        
        <div class="event-type-badge" style="background: ${getTypeColor(eventData.type)}">
            ${getTypeLabel(eventData.type) || 'Autre'}
        </div>
        
        <div class="event-content">
            <h3 class="event-title">${escapeHtml(eventData.name || 'Nom de l\'événement')}</h3>
            <p class="event-welcome">${escapeHtml(eventData.welcomeMessage || '')}</p>
            
            <div class="event-meta">
                <div class="meta-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span>${eventData.date ? new Date(eventData.date).toLocaleDateString('fr-FR') : 'Date non définie'}</span>
                </div>
                ${eventData.time ? `
                <div class="meta-item">
                    <i class="fas fa-clock"></i>
                    <span>${eventData.time}</span>
                </div>` : ''}
                ${eventData.location ? `
                <div class="meta-item">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>${eventData.location}</span>
                </div>` : ''}
            </div>

            <div class="event-stats-circle">
                <div class="stat-circle">
                    <div class="circle" style="border-color: ${eventData.design?.primaryColor || '#D97706'}20;">
                        <span class="value">${guests.length}</span>
                        <span class="label">Invités</span>
                    </div>
                </div>
                <div class="stat-circle">
                    <div class="circle" style="border-color: #10B98120;">
                        <span class="value">${scannedGuests}</span>
                        <span class="label">Présents</span>
                    </div>
                </div>
                <div class="stat-circle">
                    <div class="circle" style="border-color: #3B82F620;">
                        <span class="value">${eventData.capacity || '∞'}</span>
                        <span class="label">Capacité</span>
                    </div>
                </div>
            </div>

           
        </div>
    `;
}


        // Mettre à jour le récapitulatif
function updateSummary() {
    // Informations principales
    document.getElementById('summaryName').textContent = eventData.name || '-';
    document.getElementById('summaryType').textContent = getTypeLabel(eventData.type) || '-';
    
    if (eventData.date) {
        const dateObj = new Date(eventData.date);
        document.getElementById('summaryDate').textContent = dateObj.toLocaleDateString('fr-FR');
    } else {
        document.getElementById('summaryDate').textContent = '-';
    }
    
    document.getElementById('summaryTime').textContent = eventData.time || '-';
    document.getElementById('summaryLocation').textContent = eventData.location || '-';
    document.getElementById('summaryCapacity').textContent = eventData.capacity ? 
        `${eventData.capacity} personnes` : 'Illimité';
    
    // Paramètres
    document.getElementById('summaryRegistration').textContent = 
        eventData.settings.allowGuestRegistration ? 'Activées' : 'Désactivées';
    document.getElementById('summaryApproval').textContent = 
        eventData.settings.requireApproval ? 'Manuelle' : 'Automatique';
    document.getElementById('summaryQR').textContent = 
        eventData.settings.autoGenerateQRCodes ? 'Automatique' : 'Manuel';
    document.getElementById('summaryVisibility').textContent = 
        getVisibilityLabel(eventData.metadata.visibility);
    document.getElementById('summaryTimezone').textContent = 
        getTimezoneLabel(eventData.metadata.timezone);
    
    // Fonctionnalités
    const features = [];
    if (eventData.settings.enablePhotoGallery) features.push('Galerie photo');
    if (eventData.settings.enableGuestMessages) features.push('Messages');
    if (eventData.settings.enableTableQR) features.push('QR tables');
    if (eventData.settings.enableNotifications) features.push('Notifications');
    document.getElementById('summaryFeatures').textContent = 
        features.length > 0 ? features.join(', ') : 'Aucune';
    
    // Design
    document.getElementById('summaryPrimaryColor').textContent = eventData.design.primaryColor;
    document.getElementById('summaryColorPreview').style.backgroundColor = eventData.design.primaryColor;
    document.getElementById('summaryTheme').textContent = getThemeLabel(eventData.design.theme);
    
    // Images avec aperçu
    const summaryBackground = document.getElementById('summaryBackground');
    const summaryLogo = document.getElementById('summaryLogo');
    
    // Nettoyer les éléments existants
    summaryBackground.innerHTML = '';
    summaryLogo.innerHTML = '';
    
    // Image de fond
    const backgroundText = document.createElement('span');
    backgroundText.textContent = eventData.design.backgroundImage ? 'Oui' : 'Non';
    summaryBackground.appendChild(backgroundText);
    
    if (eventData.design.backgroundImage) {
        const previewBtn = document.createElement('div');
        previewBtn.className = 'image-thumbnail';
        previewBtn.style.cssText = 'margin-top: 5px; cursor: pointer; color: var(--primary); font-size: 0.8rem;';
        previewBtn.innerHTML = '<i class="fas fa-eye"></i> Aperçu';
        previewBtn.onclick = () => viewImagePreview('background');
        summaryBackground.appendChild(previewBtn);
    }
    
    // Logo
    const logoText = document.createElement('span');
    logoText.textContent = eventData.design.logo ? 'Oui' : 'Non';
    summaryLogo.appendChild(logoText);
    
    if (eventData.design.logo) {
        const previewBtn = document.createElement('div');
        previewBtn.className = 'image-thumbnail';
        previewBtn.style.cssText = 'margin-top: 5px; cursor: pointer; color: var(--primary); font-size: 0.8rem;';
        previewBtn.innerHTML = '<i class="fas fa-eye"></i> Aperçu';
        previewBtn.onclick = () => viewImagePreview('logo');
        summaryLogo.appendChild(previewBtn);
    }
    
    
    // Description
    document.getElementById('summaryDescription').textContent = eventData.description || 'Aucune description fournie';
    document.getElementById('summaryWelcomeMessage').textContent = eventData.welcomeMessage || 'Aucun message de bienvenue fournie';
        
}

// Fonction pour voir l'aperçu d'image en plein écran (à ajouter dans tes fonctions utilitaires)
function viewImagePreview(type) {
    const imageUrl = type === 'background' ? eventData.design.backgroundImage : eventData.design.logo;
    if (!imageUrl) return;
    
    Swal.fire({
        title: type === 'background' ? 'Image de fond' : 'Logo',
        html: `
            <div style="text-align: center;">
                <img src="${imageUrl}" 
                     style="max-width: 100%; max-height: 400px; border-radius: 8px; margin-bottom: 15px;">
                <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem;">
                    ${type === 'background' ? '1920×1080px' : '200×200px'}
                </p>
            </div>
        `,
        showConfirmButton: false,
        showCloseButton: true,
        width: '50%',
        background: 'var(--card-bg)'
    });
}


        // Valider et aller à une étape
        async function validateAndGoToStep(current, next) {
            let isValid = true;
            let errorMessage = '';
            
            switch(current) {
                case 1:
                    // Validation étape 1
                    if (!eventData.name || eventData.name.length < 3) {
                        isValid = false;
                        errorMessage = 'Le nom doit contenir au moins 3 caractères';
                        showValidation('nameValidation', errorMessage, false);
                    } else {
                        showValidation('nameValidation', 'Nom valide', true);
                    }
                    
                    if (!eventData.type) {
                        isValid = false;
                        errorMessage = 'Veuillez sélectionner un type d\'événement';
                        showValidation('typeValidation', errorMessage, false);
                    } else {
                        showValidation('typeValidation', 'Type valide', true);
                    }
                    
                    if (!eventData.date) {
                        isValid = false;
                        errorMessage = 'La date est obligatoire';
                        showValidation('dateValidation', errorMessage, false);
                    } else {
                        const eventDate = new Date(eventData.date);
                        const today = new Date();
                        today.setHours(0, 0, 0, 0);
                        
                        if (eventDate < today && !isEditing) {
                            isValid = false;
                            errorMessage = 'La date ne peut pas être dans le passé';
                            showValidation('dateValidation', errorMessage, false);
                        } else {
                            showValidation('dateValidation', 'Date valide', true);
                        }
                    }
                    
                    if (!eventData.location || eventData.location.length < 3) {
                        isValid = false;
                        errorMessage = 'Le lieu doit contenir au moins 3 caractères';
                        showValidation('locationValidation', errorMessage, false);
                    } else {
                        showValidation('locationValidation', 'Lieu valide', true);
                    }
                    
                    if (eventData.capacity && (eventData.capacity < 1 || eventData.capacity > 100000)) {
                        isValid = false;
                        errorMessage = 'La capacité doit être entre 1 et 100000';
                        showValidation('capacityValidation', errorMessage, false);
                    } else {
                        showValidation('capacityValidation', 'Capacité valide', true);
                    }
                    break;
                    
                case 2:
                    // Validation étape 2
                    if (eventData.settings.maxGuestsPerUser < 1 || eventData.settings.maxGuestsPerUser > 50) {
                        isValid = false;
                        errorMessage = 'Le nombre d\'invités par personne doit être entre 1 et 50';
                    }
                    break;
                    
                case 3:
                    // Validation étape 3
                    if (!/^#[0-9A-F]{6}$/i.test(eventData.design.primaryColor)) {
                        isValid = false;
                        errorMessage = 'La couleur principale doit être au format hexadécimal (#RRGGBB)';
                        showValidation('colorValidation', errorMessage, false);
                    } else {
                        showValidation('colorValidation', 'Couleur valide', true);
                    }
                    break;
            }
            
            if (!isValid) {
                // Animer l'étape pour attirer l'attention
                const currentStepElement = document.querySelector(`.step-item[data-step="${current}"]`);
                currentStepElement.style.animation = 'none';
                setTimeout(() => {
                    currentStepElement.style.animation = 'shake 0.5s ease';
                }, 10);
                
                await Swal.fire({
                    icon: 'error',
                    title: 'Validation échouée',
                    text: errorMessage,
                    confirmButtonColor: '#D97706',
                    timer: 3000
                });
                
                return;
            }
            
            goToStep(next);
        }

        // Aller à une étape spécifique
        function goToStep(step) {
            // Mettre à jour l'étape actuelle
            currentStep = step;
            
            // Mettre à jour les indicateurs de progression
            document.querySelectorAll('.step-item').forEach(indicator => {
                const stepNum = parseInt(indicator.dataset.step);
                indicator.classList.remove('active', 'completed');
                
                if (stepNum < step) {
                    indicator.classList.add('completed');
                } else if (stepNum === step) {
                    indicator.classList.add('active');
                }
            });
            
            // Mettre à jour le contenu des étapes
            document.querySelectorAll('.step-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(`step${step}`).classList.add('active');
            
            // Mettre à jour le pourcentage de progression
            const progress = Math.round(((step - 1) / 3) * 100);
            document.getElementById('progressPercentage').textContent = `${progress}%`;
            
            // Mettre à jour le récapitulatif si on est à l'étape 4
            if (step === 4) {
                updateSummary();
            }
            
            // Sauvegarder la progression
            saveProgress();
            
            // Scroll vers le haut
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Sauvegarder la progression
        function saveProgress() {
            const progress = {
                currentStep,
                eventData,
                isEditing,
                eventId,
                timestamp: new Date().toISOString()
            };
            
            localStorage.setItem('secura_event_form_progress', JSON.stringify(progress));
        }

        // Charger la progression sauvegardée
        function loadProgress() {
    const saved = localStorage.getItem('secura_event_form_progress');
    
    if (saved && !isEditing) {
        try {
            const progress = JSON.parse(saved);
            const savedTime = new Date(progress.timestamp);
            const now = new Date();
            const hoursDiff = (now - savedTime) / (1000 * 60 * 60);

            const hasRealData = progress.eventData && (
                (progress.eventData.name && progress.eventData.name.trim() !== '') || 
                (progress.eventData.location && progress.eventData.location.trim() !== '') ||
                (progress.eventData.type && progress.eventData.type !== '')
            );

            if (hoursDiff < 24 && hasRealData) {
                Swal.fire({
                    title: 'Reprendre la création ?',
                    text: `Vous avez un événement "${progress.eventData.name || 'sans nom'}" en cours.`,
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonText: 'Oui, reprendre',
                    cancelButtonText: 'Non, recommencer',
                    confirmButtonColor: '#D97706',
                    cancelButtonColor: '#6B7280'
                }).then((result) => {
                    if (result.isConfirmed) {
                        currentStep = progress.currentStep;
                        eventData = progress.eventData;
                        isEditing = progress.isEditing;
                        eventId = progress.eventId;
                        
                        populateFormFields();
                        goToStep(currentStep);
                    } else {
                        localStorage.removeItem('secura_event_form_progress');
                        // initializeFormWithDefaults(); // Optionnel si déjà fait au chargement
                    }
                });
            }
        } catch (err) {
            console.error("Erreur de parsing JSON:", err);
            localStorage.removeItem('secura_event_form_progress');
        }
    }
}
        // Sauvegarder comme brouillon
        async function saveDraft() {
            try {
                updateEventDataFromForm();
                
                // S'assurer que l'événement est en statut brouillon
                eventData.status = 'draft';
                eventData.active = false;
                
                // Ajouter les dates
                const now = new Date().toISOString();
                if (!eventData.createdAt) {
                    eventData.createdAt = now;
                }
                eventData.updatedAt = now;
                
                // Désactiver le bouton
                const saveBtn = document.getElementById('saveDraftBtn');
                saveBtn.disabled = true;
                saveBtn.innerHTML = '<div class="spinner"></div> Sauvegarde...';
                
                // Sauvegarder
                let savedEvent;
                if (isEditing && eventId) {
                    savedEvent = await storage.updateEvent(eventId, eventData);
                } else {
                    savedEvent = await storage.createEvent(eventData);
                    eventId = savedEvent.id;
                    isEditing = true;
                }
                
                if (savedEvent) {
                    // Nettoyer la progression
                    localStorage.removeItem('secura_event_form_progress');
                    
                    // Mettre à jour l'indicateur de statut
                    updateStatusIndicator();
                    
                    // Afficher le succès
                    await Swal.fire({
                        icon: 'success',
                        title: 'Brouillon enregistré',
                        text: 'Votre événement a été sauvegardé comme brouillon',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    Toastify({
                        text: "Brouillon sauvegardé avec succès",
                        duration: 3000,
                        gravity: "top",
                        position: "right",
                        backgroundColor: "var(--success)"
                    }).showToast();
                }
            } catch (error) {
                console.error('Erreur sauvegarde brouillon:', error);
                await Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    text: 'Impossible de sauvegarder le brouillon',
                    confirmButtonColor: '#D97706'
                });
            } finally {
                // Réactiver le bouton
                const saveBtn = document.getElementById('saveDraftBtn');
                saveBtn.disabled = false;
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Sauvegarder brouillon';
            }
        }

        // Soumettre l'événement
        async function submitEvent() {
            updateEventDataFromForm();
            
            if (!eventData.name || !eventData.type || !eventData.date || !eventData.location) {
                await Swal.fire({
                    icon: 'error',
                    title: 'Informations manquantes',
                    text: 'Veuillez compléter toutes les informations obligatoires',
                    confirmButtonColor: '#D97706'
                });
                goToStep(1);
                return;
            }
            
            // Confirmation
            const result = await Swal.fire({
                title: isEditing ? 'Mettre à jour l\'événement ?' : 'Créer l\'événement ?',
                html: `
                    <div style="text-align: left; padding: 10px 0;">
                        <p>Vous êtes sur le point de ${isEditing ? 'mettre à jour' : 'créer'} l'événement :</p>
                        <p><strong>"${escapeHtml(eventData.name)}"</strong></p>
                        <p><i class="fas fa-calendar-alt"></i> ${eventData.date ? new Date(eventData.date).toLocaleDateString('fr-FR') : 'Date non définie'}</p>
                        <p><i class="fas fa-map-marker-alt"></i> ${escapeHtml(eventData.location || 'Lieu non défini')}</p>
                        <hr style="margin: 15px 0;">
                        <p style="color: var(--warning); font-size: 0.9rem;">
                            <i class="fas fa-exclamation-triangle"></i> Cette action est ${isEditing ? 'irréversible' : 'définitive'}
                        </p>
                    </div>
                `,
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: isEditing ? '<i class="fas fa-save"></i> Enregistrer' : '<i class="fas fa-check-circle"></i> Créer',
                cancelButtonText: 'Annuler',
                confirmButtonColor: '#D97706',
                cancelButtonColor: '#6B7280',
                reverseButtons: true
            });
            
            if (!result.isConfirmed) return;
            
            // Désactiver le bouton
            const submitBtn = document.getElementById('submitEvent');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="spinner"></div> Enregistrement...';
            
            try {
                // ⚠️ IMPORTANT : Gérer différemment création vs édition
                if (!isEditing) {
                    // MODE CRÉATION : L'utilisateur courant devient l'organisateur
                    eventData.organizerId = currentUser?.id;
                    eventData.metadata.createdBy = currentUser?.id;
                    eventData.metadata.updatedBy = currentUser?.id;
                } else {
                    // MODE ÉDITION : Conserver l'organisateur original
                    // Ne pas modifier organizerId et createdBy
                    // Seulement mettre à jour updatedBy
                    eventData.metadata.updatedBy = currentUser?.id;
                }
                
                eventData.status = 'active';
                eventData.active = true;
                
                const now = new Date().toISOString();
                if (!eventData.createdAt) {
                    eventData.createdAt = now;
                }
                eventData.updatedAt = now;
                
                // Sauvegarder
                let savedEvent;
                if (isEditing && eventId) {
                    savedEvent = await storage.updateEvent(eventId, eventData);
                } else {
                    savedEvent = await storage.createEvent(eventData);
                }
                
                if (savedEvent) {
                    localStorage.removeItem('secura_event_form_progress');
                    SECURA_AUDIO.play('success');
                    
                    confetti({
                        particleCount: 100,
                        spread: 70,
                        origin: { y: 0.6 }
                    });
                    
                    await Swal.fire({
                        icon: 'success',
                        title: isEditing ? 'Événement mis à jour !' : 'Événement créé !',
                        html: `
                            <div style="text-align: center; padding: 20px 0;">
                                <i class="fas fa-check-circle" style="font-size: 4rem; color: var(--success); margin-bottom: 15px;"></i>
                                <p><strong>"${escapeHtml(savedEvent.name)}"</strong> a été ${isEditing ? 'mis à jour' : 'créé'} avec succès.</p>
                                ${!isEditing ? `<p><i class="fas fa-user"></i> Vous êtes l'organisateur de cet événement</p>` : ''}
                                <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-top: 10px;">
                                    Redirection vers la liste des événements...
                                </p>
                            </div>
                        `,
                        confirmButtonColor: '#D97706',
                        willClose: () => {
                            window.location.href = 'events.html';
                        }
                    });
                }
            } catch (error) {
                console.error('Erreur soumission événement:', error);
                
                SECURA_AUDIO.play('error');
                
                await Swal.fire({
                    icon: 'error',
                    title: 'Erreur',
                    html: `
                        <div style="text-align: center; padding: 20px 0;">
                            <i class="fas fa-exclamation-triangle" style="font-size: 4rem; color: var(--danger); margin-bottom: 15px;"></i>
                            <p>Impossible de ${isEditing ? 'mettre à jour' : 'créer'} l'événement.</p>
                            <p style="color: rgba(255,255,255,0.7); font-size: 0.9rem; margin-top: 10px;">
                                ${error.message || 'Une erreur est survenue'}
                            </p>
                        </div>
                    `,
                    confirmButtonColor: '#D97706'
                });
            } finally {
                // Réactiver le bouton
                submitBtn.disabled = false;
                submitBtn.innerHTML = isEditing ? 
                    '<i class="fas fa-save"></i> Enregistrer les modifications' :
                    '<i class="fas fa-check-circle"></i> Créer l\'événement';
            }
        }
        // Mettre à jour l'indicateur de statut
        function updateStatusIndicator() {
            const statusIndicator = document.createElement('div');
            statusIndicator.className = `status-indicator status-${eventData.status}`;
            
            let statusText = '';
            switch(eventData.status) {
                case 'draft':
                    statusText = 'Brouillon';
                    break;
                case 'active':
                    statusText = 'Actif';
                    break;
                case 'archived':
                    statusText = 'Archivé';
                    break;
                default:
                    statusText = eventData.status;
            }
            
            statusIndicator.innerHTML = `
                <i class="fas fa-circle"></i>
                <span>${statusText}</span>
            `;
            
            // Ajouter à l'en-tête
            const formHeader = document.querySelector('.form-header');
            const existingIndicator = formHeader.querySelector('.status-indicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
            formHeader.appendChild(statusIndicator);
        }

        // Fonctions utilitaires
        function showValidation(elementId, message, isValid) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `validation-message ${isValid ? 'valid' : 'invalid'}`;
            
            // Animation d'entrée
            element.style.opacity = '0';
            element.style.transform = 'translateY(-5px)';
            
            setTimeout(() => {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
            }, 10);
            
            return isValid;
        }


        // Fonctions utilitaires pour l'aperçu
function getEventImage(type) {
    const defaultImages = {
        marriage: 'https://images.unsplash.com/photo-1519167758481-83f550bb49b3?w=800&q=80',
        anniversaire: 'https://images.unsplash.com/photo-1464349095431-e9a21285b5f3?w=800&q=80',
        conference: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=800&q=80',
        corporate: 'https://images.unsplash.com/photo-1515187029135-18ee286d815b?w=800&q=80',
        concert: 'https://images.unsplash.com/photo-1470229722913-7c0e2dbbafd3?w=800&q=80',
        gala: 'https://images.unsplash.com/photo-1511578314322-379afb476865?w=800&q=80',
        football: 'https://images.unsplash.com/photo-1574629810360-7efbbe195018?w=800&q=80',
        autre: 'https://images.unsplash.com/photo-1501281668745-f7f579dff10e?w=800&q=80'
    };
    
    return defaultImages[type] || defaultImages.autre;
}

function getTypeColor(type) {
    const colors = {
        marriage: '#EC4899',
        anniversaire: '#8B5CF6',
        conference: '#3B82F6',
        corporate: '#10B981',
        concert: '#F59E0B',
        gala: '#EF4444',
        football: '#84CC16',
        autre: '#6B7280'
    };
    return colors[type] || '#6B7280';
}

        function getTypeLabel(type) {
            const labels = {
                marriage: 'Mariage',
                anniversaire: 'Anniversaire',
                conference: 'Conférence',
                corporate: 'Corporate',
                concert: 'Concert',
                gala: 'Gala',
                football: 'Football',
                autre: 'Autre'
            };
            return labels[type] || 'Autre';
        }

        function getVisibilityLabel(visibility) {
            const labels = {
                private: 'Privé',
                public: 'Public',
                unlisted: 'Non listé'
            };
            return labels[visibility] || visibility;
        }

        function getThemeLabel(theme) {
            const labels = {
                modern: 'Moderne',
                classic: 'Classique',
                elegant: 'Élégant',
                minimal: 'Minimaliste',
                festive: 'Festif'
            };
            return labels[theme] || theme;
        }

        function getTimezoneLabel(timezone) {
            const labels = {
                'Africa/Douala': 'Douala (GMT+1)',
                'Europe/Paris': 'Paris (GMT+1/2)',
                'America/New_York': 'New York (GMT-5/-4)',
                'Asia/Tokyo': 'Tokyo (GMT+9)',
                'Australia/Sydney': 'Sydney (GMT+10/+11)'
            };
            return labels[timezone] || timezone;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Gestion de la fermeture de page
        window.addEventListener('beforeunload', (e) => {
            if (currentStep > 1 && !eventData.name && !isEditing) {
                e.preventDefault();
                e.returnValue = 'Vous avez des modifications non sauvegardées. Voulez-vous vraiment quitter ?';
                return e.returnValue;
            }
        });

        // Gestion du retour en arrière
        window.addEventListener('popstate', (e) => {
            if (currentStep > 1) {
                e.preventDefault();
                confirmGoBack();
            }
        });

        async function confirmGoBack() {
            const result = await Swal.fire({
                title: 'Quitter la création ?',
                text: 'Vos modifications non sauvegardées seront perdues',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Oui, quitter',
                cancelButtonText: 'Rester',
                confirmButtonColor: '#EF4444',
                cancelButtonColor: '#6B7280'
            });
            
            if (result.isConfirmed) {
                localStorage.removeItem('secura_event_form_progress');
                window.location.href = 'events.html';
            } else {
                // Réajouter l'état dans l'historique
                history.pushState(null, '', window.location.href);
            }
        }

        // Animation CSS pour secouer
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                20%, 40%, 60%, 80% { transform: translateX(5px); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>