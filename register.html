<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>SECURA | Création de Compte</title>
    <link rel="icon" href="assets/images/icon.png" type="image/x-icon"/>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="preload" href="js/auth-check.js" as="script">
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



    <link rel="icon" href="assets/images/icon.png" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">

<link rel="stylesheet" href="css/loading.css">
<link rel="stylesheet" href="css/dash.css">
    <link rel="stylesheet" href="css/toastify.css">
    <link rel="stylesheet" href="css/styles.css">
    
    
    <style>
        :root {
            --primary: #D97706; --primary-dark: #B45309; --primary-light: #F59E0B;
            --dark: #0A0A0A; --dark-card: #121212; --dark-elevated: #1A1A1A;
            --gradient: linear-gradient(135deg, #B45309 0%, #D97706 50%, #F59E0B 100%);
            --transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            --success: #10B981; --danger: #EF4444; --warning: #F59E0B;
            --border-radius: 16px; --border-radius-sm: 10px;
            --card-shadow: 0 12px 40px rgba(0,0,0,0.4);
        }

        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--dark);
            color: #fff !important;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(217, 119, 6, 0.15) 0%, transparent 30%),
                radial-gradient(circle at 90% 80%, rgba(217, 119, 6, 0.15) 0%, transparent 30%);
            overflow-x: hidden;
        }

        /* === CONTENEUR PRINCIPAL === */
        .register-main-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            margin-top: 80px;
        }

        .logo-text{
            color: white;
        }


        .register-wrapper {
            display: flex;
            width: 100%;
            max-width:900px;
            background: linear-gradient(145deg, var(--dark-elevated) 0%, var(--dark-card) 100%);
            border-radius: var(--border-radius);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(20px);
            overflow: hidden;
            height: 650px;
            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* === PANEL DE PROGRESSION (GAUCHE) === */
        .progress-panel {
            flex: 0 0 300px;
            background: rgba(0, 0, 0, 0.2);
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(255,255,255,0.08);
        }

        .progress-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: rgba(255,255,255,0.7);
            margin-bottom: 40px;
            letter-spacing: 0.5px;
        }

        .steps-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: auto;
        }

        .step-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 18px 20px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            
            position: relative;
            overflow: hidden;
        }

        .step-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--gradient);
            transform: scaleY(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .step-item.active {
            background: rgba(217, 119, 6, 0.08);
            border: 1px solid rgba(217, 119, 6, 0.2);
        }

        .step-item.active::before {
            transform: scaleY(1);
        }

        .step-item.completed {
            opacity: 0.8;
        }

        .step-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.08);
            border: 2px solid rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9rem;
            color: rgba(255,255,255,0.5);
            
        }

        .step-item.active .step-number {
            background: var(--gradient);
            border-color: var(--primary);
            color: white;
            box-shadow: 0 0 0 4px rgba(217, 119, 6, 0.15);
        }

        .step-item.completed .step-number {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .step-info {
            flex: 1;
        }

        .step-label {
            display: block;
            font-weight: 600;
            font-size: 0.95rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 4px;
        }

        .step-item.active .step-label {
            color: var(--primary-light);
        }

        .step-description {
            display: block;
            font-size: 0.8rem;
            color: rgba(255,255,255,0.5);
            line-height: 1.3;
        }

        .progress-info {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.08);
        }

        .progress-text {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.5);
            margin-bottom: 8px;
        }

        .progress-percentage {
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* === PANEL DE FORMULAIRE (DROITE) === */
        .form-panel {
            flex: 1;
            padding: 40px;
            overflow: hidden;
            position: relative;
        }

        .form-header {
            margin-bottom: 40px;
        }

        .form-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .form-subtitle {
            font-size: 0.95rem;
            color: rgba(255,255,255,0.6);
            line-height: 1.5;
        }

        /* === CONTENU DES ÉTAPES === */
        .step-content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 40px;
            opacity: 0;
            transform: translateX(40px);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            overflow-y: auto;
        }

        .step-content::-webkit-scrollbar {
            width: 6px;
        }

        .step-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 3px;
        }

        .step-content::-webkit-scrollbar-thumb {
            background: var(--gradient);
            border-radius: 3px;
        }

        .step-content.active {
            opacity: 1;
            transform: translateX(0);
            pointer-events: all;
        }

        /* === FORMULAIRES === */
        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-light);
            margin-bottom: 8px;
        }

        .input-wrapper {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--primary);
            font-size: 1rem;
            pointer-events: none;
            z-index: 2;
        }

        .form-control {
            width: 100%;
            background: rgba(255,255,255,0.04);
            border: 1.5px solid rgba(255,255,255,0.12);
            color: white;
            padding: 12px 16px 12px 44px;
            border-radius: var(--border-radius-sm);
            font-size: 0.95rem;
            
            font-family: inherit;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
        }

        .form-control::placeholder {
            color: rgba(255,255,255,0.4);
            font-size: 0.9rem;
        }

        .password-toggle {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.4);
            font-size: 1rem;
            cursor: pointer;
            
            z-index: 2;
        }

        .password-toggle:hover {
            color: var(--primary);
        }

        /* === CODE DE VÉRIFICATION === */
        .code-container {
            max-width: 400px;
            margin: 20px auto 30px;
        }

        .code-inputs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .code-input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: 600;
            background: rgba(255,255,255,0.04);
            border: 1.5px solid rgba(255,255,255,0.12);
            border-radius: var(--border-radius-sm);
            color: white;
            
        }

        .code-input:focus {
            outline: none;
            border-color: var(--primary);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 0 0 3px rgba(217, 119, 6, 0.1);
        }

        .code-input.filled {
            border-color: var(--primary);
            background: rgba(217, 119, 6, 0.08);
        }

        .resend-section {
            text-align: center;
            margin-top: 20px;
        }

        .resend-link {
            color: var(--primary-light);
            background: none;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            text-decoration: underline;
            padding: 5px;
        }

        .resend-link:hover:not(:disabled) {
            color: white;
        }

        .resend-link:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .timer {
            color: rgba(255,255,255,0.4);
            font-size: 0.85rem;
            margin-top: 8px;
        }

        /* === BOUTONS DE NAVIGATION === */
        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.08);
        }

        .btn {
            padding: 12px 28px;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-prev {
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.7);
        }

        .btn-prev:hover:not(:disabled) {
            background: rgba(255,255,255,0.1);
            color: white;
        }

        .btn-next, .btn-submit {
            background: var(--gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(217, 119, 6, 0.25);
        }

        .btn-next:hover:not(:disabled), .btn-submit:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(217, 119, 6, 0.35);
        }

        .btn-skip {
            background: transparent;
            color: rgba(255,255,255,0.5);
            text-decoration: underline;
            font-size: 0.9rem;
            padding: 8px 16px;
        }

        .btn-skip:hover {
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* === MESSAGES DE VALIDATION === */
        .validation-message {
            font-size: 0.8rem;
            margin-top: 6px;
            justify-content: center;
            text-align: center;
            display: flex;
            align-items: center;
            gap: 5px;
        }

         .validation-message.valid {
            color: var(--success);
            background: #233126;
            border-left: 3px solid var(--success);
        }

        .validation-message.invalid {
            color: var(--danger);
            background: #312121;
            border-left: 3px solid var(--danger);

        }

        /* === LIEN DE CONNEXION === */
      

        .login-link {
            text-align: center;
        }

        .login-link p {
            font-size: 0.95rem;
            opacity: 0.7;
        }

        .login-link a {
            color: var(--primary-light);
            text-decoration: none;
            font-weight: 600;
            
        }

        .login-link a:hover {
            color: white;
            text-decoration: underline;
        }

        /* === RESPONSIVE === */
        @media (max-width: 992px) {
            .register-wrapper {
                flex-direction: column;
                height: auto;
                max-height: 90vh;
            }
            
            .progress-panel {
                flex: none;
                border-right: none;
                border-bottom: 1px solid rgba(255,255,255,0.08);
            }
            
            .steps-container {
                flex-direction: row;
                overflow-x: auto;
                padding-bottom: 10px;
            }
            
            .step-item {
                min-width: 200px;
            }
        }

        @media (max-width: 768px) {
            .register-main-container {
                margin-top: 60px;
                padding: 15px;
            }
            
            .register-wrapper {
                border-radius: 12px;
            }
            
            .form-panel {
                padding: 30px 20px;
            }
            
            .step-content {
                padding: 30px 20px;
            }
            
            .code-input {
                width: 40px;
                height: 40px;
                font-size: 1rem;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 480px) {
            .form-title {
                font-size: 1.5rem;
            }
            
            .progress-panel {
                padding: 25px 20px;
            }
            
            .step-item {
                padding: 15px;
            }
        }

        /* === RESPONSIVE - PETITS ÉCRANS === */
@media (max-width: 992px) {
    .register-wrapper {
        flex-direction: column;
        height: auto;
        max-height: none;
        min-height: auto;
    }
    
    .progress-panel {
        flex: none;
        border-right: none;
        border-bottom: 1px solid rgba(255,255,255,0.08);
        padding: 25px 20px;
        width: 100%;
    }
    
    .steps-container {
        flex-direction: row;
        overflow-x: auto;
        padding-bottom: 10px;
        gap: 15px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: thin;
    }
    
    .step-item {
        min-width: 160px;
        flex-shrink: 0;
        padding: 15px;
        gap: 12px;
    }
    
   
    
    .step-label {
        font-size: 0.85rem;
        white-space: nowrap;
    }
    
    .step-description {
        font-size: 0.75rem;
    }
    
    .progress-info {
        margin-top: 20px;
        padding-top: 15px;
    }
    
    .form-panel {
        padding: 30px 20px;
        max-height: none;
        overflow-y: visible;
    }
    
    .step-content {
        padding: 20px;
        position: relative;
        opacity: 1;
        transform: none;
        display: none;
    }
    
    .step-content.active {
        display: block;
        animation: fadeIn 0.3s ease;
    }
    
    .form-title {
        font-size: 1.5rem;
    }
    
    .form-subtitle {
        font-size: 0.9rem;
    }
    
    .code-input {
        width: 40px;
        height: 40px;
        font-size: 1rem;
    }
    
    .navigation-buttons {
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .btn {
        min-width: 120px;
    }
    
    .btn-skip {
        order: 3;
        width: 100%;
        text-align: center;
        margin-top: 10px;
    }
}

/* === TRÈS PETITS ÉCRANS === */
@media (max-width: 480px) {
    .register-main-container {
        margin-top: 60px;
        padding: 10px;
    }
    
    .register-wrapper {
        border-radius: 12px;
        margin: 10px;
    }
    
    .step-item {
        min-width: 140px;
        padding: 12px;
    }
    
    .step-number {
        width: 28px;
        height: 28px;
        font-size: 0.8rem;
    }
    
    .code-inputs {
        gap: 8px;
    }
    
    .code-input {
        width: 35px;
        height: 35px;
        font-size: 0.9rem;
    }
    
    .form-control {
        padding: 12px 16px 12px 44px;
        font-size: 0.9rem;
    }
    
    .input-icon {
        left: 12px;
        font-size: 0.9rem;
    }
    
    .password-toggle {
        right: 12px;
        font-size: 0.9rem;
    }
    
    .form-row {
        gap: 15px;
    }
    
    textarea.form-control {
        min-height: 100px;
        font-size: 0.9rem;
    }
}

/* === ANIMATIONS POUR LE RESPONSIVE === */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* === SCROLLBAR PERSONNALISÉE === */
.steps-container::-webkit-scrollbar {
    height: 4px;
}

.steps-container::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.05);
    border-radius: 2px;
}

.steps-container::-webkit-scrollbar-thumb {
    background: var(--gradient);
    border-radius: 2px;
}

/* === TOOLTIP POUR LES ÉTAPES SUR MOBILE === */
.step-item {
    position: relative;
}

.step-tooltip {
    display: none;
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 8px 12px;
    border-radius: 6px;
    font-size: 0.8rem;
    white-space: nowrap;
    z-index: 100;
    margin-bottom: 8px;
    border: 1px solid rgba(255,255,255,0.1);
}

.step-tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 5px solid transparent;
    border-top-color: rgba(0,0,0,0.9);
}

@media (max-width: 992px) {
    .step-item:hover .step-tooltip {
        display: block;
    }
}



    </style>

</head>
<body>
    <!-- Particules -->
    <div id="particles-js"></div>

    <!-- Header -->
    <header class="header">
           <div class="header-content">

            
        <a href="index.html" class="logo-section " style="text-decoration: none;">
                <div class="logo-icon">
                    <img src="assets/images/icon.png" alt="logo secura">
                </div>
            <div class="logo-text">
                <h1>SECURA</h1>
                <p>Inscription</p>
            </div>
        </a>

       

            <div class="header-actions">

                <a href="index.html" class="home-btn">
                    <i class="fas fa-home"></i>
                    <span>Accueil</span>
                </a>

                

            </div>
</div>

    </header>

    <!-- Contenu principal -->
    <main class="register-main-container main-content">
        <div class="register-wrapper">
            <!-- Panneau de progression (gauche) -->
            <div class="progress-panel">
                <div class="progress-title">CRÉATION DE COMPTE</div>
                
                <div class="steps-container">
                    <div class="step-item active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-info">
                            <span class="step-label">Informations de base</span>
                            <span class="step-description">Email et mot de passe</span>
                        </div>

                    <div class="step-tooltip">Informations de base - Email et mot de passe</div>
                    </div>
                    
                    <div class="step-item" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-info">
                            <span class="step-label">Vérification</span>
                            <span class="step-description">Code de sécurité</span>
                        </div>
                    </div>
                    
                    <div class="step-item" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-info">
                            <span class="step-label">Profil</span>
                            <span class="step-description">Informations personnelles</span>
                        </div>
                    </div>
                </div>
                
                <div class="progress-info">
                    <div class="progress-text">Progression</div>
                    <div class="progress-percentage" id="progressPercentage">33%</div>
                </div>
            </div>

            <!-- Panneau de formulaire (droite) -->
            <div class="form-panel">
                <!-- Étape 1: Informations de base -->
                <div class="step-content active" id="step1">
                    <div class="form-header">
                        <h2 class="form-title">Informations de base</h2>
                        <p class="form-subtitle">Créez vos identifiants pour accéder à la plateforme</p>
                    </div>

                    <form id="step1Form">
                        <div class="form-group">
                            <label class="form-label">
                                <i class="bi bi-envelope"></i>
                                Adresse e-mail *
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="email"
                                    id="email"
                                    class="form-control"
                                    placeholder="votre@email.com"
                                    required
                                    autocomplete="email"
                                />
                                <i class="bi bi-envelope input-icon"></i>
                            </div>
                            <div class="validation-message" id="emailValidation"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="bi bi-lock"></i>
                                Mot de passe *
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="password"
                                    id="password"
                                    class="form-control"
                                    placeholder="••••••••"
                                    required
                                    minlength="6"
                                    autocomplete="new-password"
                                />
                                <i class="bi bi-lock input-icon"></i>
                                <i class="bi bi-eye password-toggle" id="togglePassword1"></i>
                            </div>
                            <div class="validation-message" id="passwordValidation"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="bi bi-lock"></i>
                                Confirmer le mot de passe *
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="password"
                                    id="confirmPassword"
                                    class="form-control"
                                    placeholder="••••••••"
                                    required
                                    autocomplete="new-password"
                                />
                                <i class="bi bi-lock input-icon"></i>
                                <i class="bi bi-eye password-toggle" id="togglePassword2"></i>
                            </div>
                            <div class="validation-message" id="confirmPasswordValidation"></div>
                        </div>
                    </form>

                    <div class="navigation-buttons">
                        <div class="login-link">
                            <p>Vous avez déjà un compte ? <a href="/login.html">Se connecter</a></p>
                        </div>
                        <button class="btn btn-next" id="nextStep1">
                            Suivant
                            <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Étape 2: Vérification -->
                <div class="step-content" id="step2">
                    <div class="form-header">
                        <h2 class="form-title">Vérification de sécurité</h2>
                        <p class="form-subtitle">
                            Un code à 6 chiffres a été envoyé à <strong id="verificationEmail"></strong>.
                            Entrez-le ci-dessous pour vérifier votre compte.
                        </p>
                    </div>

                    <div class="code-container">
                        <div class="code-inputs" id="codeInputs">
                            <input type="text" class="code-input" maxlength="1" data-index="0">
                            <input type="text" class="code-input" maxlength="1" data-index="1">
                            <input type="text" class="code-input" maxlength="1" data-index="2">
                            <input type="text" class="code-input" maxlength="1" data-index="3">
                            <input type="text" class="code-input" maxlength="1" data-index="4">
                            <input type="text" class="code-input" maxlength="1" data-index="5">
                        </div>
                        
                        <div class="resend-section">
                            <button type="button" class="resend-link" id="resendCode">
                                Renvoyer le code
                            </button>
                            <div class="timer" id="resendTimer" style="display: none;">
                                Nouvelle tentative dans <span id="timer">60</span> secondes
                            </div>
                        </div>
                        
                        <div class="validation-message" id="codeValidation"  style="text-align: center;"></div>
                    </div>

                    <div class="navigation-buttons">
                        <button class="btn btn-prev" id="prevStep2">
                            <i class="bi bi-arrow-left"></i>
                            Retour
                        </button>
                        <button class="btn btn-next" id="nextStep2">
                            Vérifier
                            <i class="bi bi-check-lg"></i>
                        </button>
                    </div>
                </div>

                <!-- Étape 3: Profil -->
                <div class="step-content" id="step3">
                    <div class="form-header">
                        <h2 class="form-title">Informations du profil</h2>
                        <p class="form-subtitle">Complétez votre profil pour personnaliser votre expérience</p>
                    </div>

                    <form id="step3Form">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-person"></i>
                                    Prénom
                                </label>
                                <div class="input-wrapper">
                                    <input
                                        type="text"
                                        id="firstName"
                                        class="form-control"
                                        placeholder="Jean"
                                        autocomplete="given-name"
                                    />
                                    <i class="bi bi-person input-icon"></i>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-person"></i>
                                    Nom
                                </label>
                                <div class="input-wrapper">
                                    <input
                                        type="text"
                                        id="lastName"
                                        class="form-control"
                                        placeholder="Dupont"
                                        autocomplete="family-name"
                                    />
                                    <i class="bi bi-person input-icon"></i>
                                </div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-telephone"></i>
                                    Téléphone
                                </label>
                                <div class="input-wrapper">
                                    <input
                                        type="tel"
                                        id="phone"
                                        class="form-control"
                                        placeholder="+237 672 03 73 00"
                                        autocomplete="tel"
                                    />
                                    <i class="bi bi-telephone input-icon"></i>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">
                                    <i class="bi bi-building"></i>
                                    Entreprise
                                </label>
                                <div class="input-wrapper">
                                    <input
                                        type="text"
                                        id="company"
                                        class="form-control"
                                        placeholder="Nom de l'entreprise"
                                        autocomplete="organization"
                                    />
                                    <i class="bi bi-building input-icon"></i>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="bi bi-geo-alt"></i>
                                Adresse
                            </label>
                            <div class="input-wrapper">
                                <input
                                    type="text"
                                    id="address"
                                    class="form-control"
                                    placeholder="123 Rue de la République"
                                    autocomplete="street-address"
                                />
                                <i class="bi bi-geo-alt input-icon"></i>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">
                                <i class="bi bi-info-circle"></i>
                                À propos de vous
                            </label>
                            <textarea
                                id="bio"
                                class="form-control"
                                placeholder="Parlez-nous un peu de vous..."
                                rows="3"
                                style="padding: 12px; resize: vertical;"
                            ></textarea>
                        </div>
                    </form>

                    <div class="navigation-buttons">
                        <button class="btn btn-prev" id="prevStep3">
                            <i class="bi bi-arrow-left"></i>
                            Retour
                        </button>
                        <div>
                            <button class="btn-skip" id="skipProfile">
                                Passer cette étape
                            </button>
                            <button class="btn btn-submit" id="submitRegistration">
                                <i class="bi bi-check-circle"></i>
                                Terminer l'inscription
                            </button>
                        </div>
                    </div>
                </div>

               
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script src="js/auth.js"></script>
    <script src="js/auth-check.js"></script>
    
    <script>
        // État global
        let currentStep = 1;
        let step1Data = {};
        let verificationToken = '';
        let resendTimer = null;
        let timeLeft = 60;

        // Éléments DOM
        const stepItems = document.querySelectorAll('.step-item');
        const stepContents = document.querySelectorAll('.step-content');
        const progressPercentage = document.getElementById('progressPercentage');
        
        // Step 1 elements
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const togglePassword1 = document.getElementById('togglePassword1');
        const togglePassword2 = document.getElementById('togglePassword2');
        const nextStep1Btn = document.getElementById('nextStep1');
        
        // Step 2 elements
        const verificationEmail = document.getElementById('verificationEmail');
        const codeInputs = document.querySelectorAll('.code-input');
        const resendCodeBtn = document.getElementById('resendCode');
        const resendTimerDiv = document.getElementById('resendTimer');
        const timerSpan = document.getElementById('timer');
        const prevStep2Btn = document.getElementById('prevStep2');
        const nextStep2Btn = document.getElementById('nextStep2');
        
        // Step 3 elements
        const prevStep3Btn = document.getElementById('prevStep3');
        const submitBtn = document.getElementById('submitRegistration');
        const skipProfileBtn = document.getElementById('skipProfile');

        // ============================================
        // FONCTIONS UTILITAIRES
        // ============================================
        function updateProgress() {
            // Mettre à jour les étapes
            stepItems.forEach(item => {
                const stepNum = parseInt(item.dataset.step);
                item.classList.remove('active', 'completed');
                
                if (stepNum < currentStep) {
                    item.classList.add('completed');
                } else if (stepNum === currentStep) {
                    item.classList.add('active');
                }
            });
            
            // Mettre à jour le pourcentage
            const progress = Math.round(((currentStep - 1) / (stepItems.length - 1)) * 100);
            progressPercentage.textContent = `${progress}%`;
            
            // Animer le changement de pourcentage
            progressPercentage.style.transform = 'scale(1.1)';
            setTimeout(() => {
                progressPercentage.style.transform = 'scale(1)';
            }, 200);
            
            // Mettre à jour le contenu
            stepContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `step${currentStep}`) {
                    content.classList.add('active');
                }
            });
        }

        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validatePassword(password) {
            return password.length >= 6;
        }

        function showValidation(elementId, message, isValid) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `validation-message ${isValid ? 'valid' : 'invalid'}`;
            
            // Animation d'entrée
            element.style.opacity = '0';
            element.style.transform = 'translateY(-5px)';

            if(elementId == 'codeValidation'){

            }
            setTimeout(() => {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
            }, 10);
            
            return isValid;
        }

        function clearValidation(elementId) {
            const element = document.getElementById(elementId);
            element.textContent = '';
            element.className = 'validation-message';
        }

        function startResendTimer() {
            timeLeft = 60;
            resendCodeBtn.disabled = true;
            resendTimerDiv.style.display = 'block';
            
            resendTimer = setInterval(() => {
                timeLeft--;
                timerSpan.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(resendTimer);
                    resendCodeBtn.disabled = false;
                    resendTimerDiv.style.display = 'none';
                }
            }, 1000);
        }


function confirmGoBack(currentStep) {
    return new Promise((resolve) => {
        Swal.fire({
            title: 'Attention !',
            html: `
                <div style="text-align: center;">
                    <i class="bi bi-exclamation-triangle" style="font-size: 3rem; color: var(--warning); margin-bottom: 15px;"></i>
                    <p>Si vous revenez en arrière, votre progression actuelle sera perdue.</p>
                    <p style="font-size: 0.9rem; color: rgba(255,255,255,0.6); margin-top: 10px;">
                        Vous devrez recommencer l'étape ${currentStep}.
                    </p>
                </div>
            `,
            icon: 'warning',
            color: 'white',
            showCancelButton: true,
            confirmButtonColor: '#EF4444',
            cancelButtonColor: '#6B7280',
            confirmButtonText: 'Oui, revenir en arrière',
            cancelButtonText: 'Annuler',
            background: 'rgba(26, 26, 26, 0.95)',
            backdrop: 'rgba(0, 0, 0, 0.7)',
            customClass: {
                popup: 'dark-swal'
            }
        }).then((result) => {
            resolve(result.isConfirmed);
        });
    });
}


        // ============================================
        // GESTION DES ÉTAPES
        // ============================================
    
function saveProgress(step, data = {}) {
    const progress = {
        currentStep: step,
        step1Data: step === 1 ? data : step1Data,
        step2Data: step === 2 ? data : {},
        verificationToken: verificationToken,
        timestamp: new Date().toISOString()
    };
    
    localStorage.setItem('secura_registration', JSON.stringify(progress));
}

async function loadProgress() {    
    const saved = localStorage.getItem('secura_registration');
    if (saved) {
        const progress = JSON.parse(saved);
       


    try {
        const response = await authManager.verifyTempToken(progress.verificationToken);
        if (!response.valid) {
            clearProgress();
            currentStep = 1;
            updateProgress();
            return;
        }
    } catch (err) {
        clearProgress();
        currentStep = 1;
        updateProgress();
        return;
    }
        
        const savedTime = new Date(progress.timestamp);
        const now = new Date();
        const hoursDiff = (now - savedTime) / (1000 * 60 * 60);
        
        if (hoursDiff < 24) {
            return progress;
        } else {
            localStorage.removeItem('secura_registration');
        }
    }
    return null;
}

function clearProgress() {
    localStorage.removeItem('secura_registration');
    step1Data = {};
    verificationToken = '';
    currentStep = 1;
    updateProgress();
}



async function goToStep(step) {

    saveProgress(currentStep);

    // Si on revient en arrière, demander confirmation

    
    if (step < currentStep && currentStep > 1) {
        const confirmed = await confirmGoBack(currentStep);
        if (!confirmed) return;
        
        // Supprimer les données temporaires si on revient de l'étape 2 ou 3
        if (currentStep >= 2 && verificationToken) {
            await cancelRegistration(verificationToken);
            verificationToken = '';
            step1Data = {};
        }
    }
    
    // Animation de sortie
    const currentContent = document.querySelector('.step-content.active');
    if (currentContent) {
        currentContent.style.opacity = '0';
        currentContent.style.transform = 'translateX(-40px)';
    }
    
    setTimeout(() => {
        currentStep = step;
        updateProgress();
        saveProgress(step);
        
        // Animation d'entrée
        const newContent = document.getElementById(`step${step}`);
        if (newContent) {
            newContent.style.transform = 'translateX(40px)';
            setTimeout(() => {
                newContent.style.transform = 'translateX(0)';
            }, 10);
        }
        
        // Focus sur le premier champ
        setTimeout(() => {
            switch(step) {
                case 1:
                    emailInput?.focus();
                    break;
                case 2:
                    codeInputs[0]?.focus();
                    break;
                case 3:
                    document.getElementById('firstName')?.focus();
                    break;
            }
        }, 100);
    }, 300);

    
}


        // ============================================
        // ÉTAPE 1: INFORMATIONS DE BASE
        // ============================================
        // Toggle password visibility
        togglePassword1?.addEventListener('click', () => {
            const type = passwordInput.type === 'password' ? 'text' : 'password';
            passwordInput.type = type;
            togglePassword1.classList.toggle('bi-eye');
            togglePassword1.classList.toggle('bi-eye-slash');
        });

        togglePassword2?.addEventListener('click', () => {
            const type = confirmPasswordInput.type === 'password' ? 'text' : 'password';
            confirmPasswordInput.type = type;
            togglePassword2.classList.toggle('bi-eye');
            togglePassword2.classList.toggle('bi-eye-slash');
        });

        // Validation en temps réel
        emailInput?.addEventListener('input', () => {
            const email = emailInput.value.trim();
            if (!email) {
                clearValidation('emailValidation');
            } else if (!validateEmail(email)) {
                showValidation('emailValidation', 'Format d\'email invalide', false);
            } else {
                showValidation('emailValidation', 'Format d\'email valide', true);
            }
        });

        passwordInput?.addEventListener('input', () => {
            const password = passwordInput.value;
            if (!password) {
                clearValidation('passwordValidation');
            } else if (!validatePassword(password)) {
                showValidation('passwordValidation', '6 caractères minimum', false);
            } else {
                showValidation('passwordValidation', 'Mot de passe valide', true);
            }
            
            // Vérifier la confirmation
            if (confirmPasswordInput.value) {
                const confirmPassword = confirmPasswordInput.value;
                if (password !== confirmPassword) {
                    showValidation('confirmPasswordValidation', 'Les mots de passe ne correspondent pas', false);
                } else {
                    showValidation('confirmPasswordValidation', 'Mots de passe identiques', true);
                }
            }
        });

        confirmPasswordInput?.addEventListener('input', () => {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            if (!confirmPassword) {
                clearValidation('confirmPasswordValidation');
            } else if (password !== confirmPassword) {
                showValidation('confirmPasswordValidation', 'Les mots de passe ne correspondent pas', false);
            } else {
                showValidation('confirmPasswordValidation', 'Mots de passe identiques', true);
            }
        });

        // Soumission étape 1
        nextStep1Btn?.addEventListener('click', async () => {
            const email = emailInput.value.trim();
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            
            // Validation
            let isValid = true;
            
            if (!validateEmail(email)) {
                showValidation('emailValidation', 'Format d\'email invalide', false);
                isValid = false;
            }
            
            if (!validatePassword(password)) {
                showValidation('passwordValidation', '6 caractères minimum', false);
                isValid = false;
            }
            
            if (password !== confirmPassword) {
                showValidation('confirmPasswordValidation', 'Les mots de passe ne correspondent pas', false);
                isValid = false;
            }
            
            if (!isValid) {
                Swal.fire({
                    icon: 'error',
                    title: 'Formulaire invalide',
                    text: 'Veuillez corriger les erreurs avant de continuer',
                    confirmButtonColor: '#D97706',
                    timer: 2000
                });
                return;
            }
            
            // Désactiver le bouton
            nextStep1Btn.disabled = true;
            nextStep1Btn.innerHTML = '<div class="spinner"></div>';
            
            try {
                // Appeler l'API d'inscription étape 1
                const result = await authManager.registerStep1(email, password);
             
                
                if (result.success) {
                    step1Data = { email, password };
                    verificationToken = result.token;
                    
                    verificationEmail.textContent = email;
                    
                    // Démarrer le timer pour renvoyer le code
                    startResendTimer();
                    
                    // Aller à l'étape 2
                    goToStep(2);
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Erreur d\'inscription',
                        text: result.message || 'Une erreur est survenue',
                        confirmButtonColor: '#D97706'
                    });
                }
            } catch (err) {
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur de connexion',
                    text: 'Impossible de contacter le serveur',
                    confirmButtonColor: '#D97706'
                });
            } finally {
                // Réactiver le bouton
                nextStep1Btn.disabled = false;
                nextStep1Btn.innerHTML = 'Suivant <i class="bi bi-arrow-right"></i>';
            }
        });

        // ============================================
        // ÉTAPE 2: VÉRIFICATION
        // ============================================
        // Retour à l'étape 1
        prevStep2Btn?.addEventListener('click', async () => {
            await goToStep(1);
        });
        // Gestion des inputs de code
        codeInputs.forEach((input, index) => {
            input.addEventListener('input', (e) => {
                const value = e.target.value;
                
                // Ne garder que les chiffres
                if (!/^\d*$/.test(value)) {
                    e.target.value = '';
                    return;
                }
                
                // Mettre à jour la classe
                if (value) {
                    e.target.classList.add('filled');
                    
                    // Passer à l'input suivant
                    if (index < codeInputs.length - 1 && value) {
                        codeInputs[index + 1].focus();
                    }
                } else {
                    e.target.classList.remove('filled');
                }
            });
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    // Aller à l'input précédent
                    codeInputs[index - 1].focus();
                }
            });
            
            input.addEventListener('paste', (e) => {
                e.preventDefault();
                const pastedData = e.clipboardData.getData('text');
                const digits = pastedData.replace(/\D/g, '').split('').slice(0, 6);
                
                digits.forEach((digit, digitIndex) => {
                    if (codeInputs[digitIndex]) {
                        codeInputs[digitIndex].value = digit;
                        codeInputs[digitIndex].classList.add('filled');
                    }
                });
                
                // Focus sur le dernier input rempli
                const lastFilledIndex = Math.min(digits.length - 1, codeInputs.length - 1);
                if (codeInputs[lastFilledIndex]) {
                    codeInputs[lastFilledIndex].focus();
                }
            });
        });

        // Renvoyer le code
        resendCodeBtn?.addEventListener('click', async () => {
            if (resendCodeBtn.disabled) return;
            
            // Désactiver le bouton
            resendCodeBtn.disabled = true;
            resendCodeBtn.innerHTML = '<div class="spinner" style="width: 16px; height: 16px;"></div>';
            
            try {
                // Appeler l'API pour renvoyer le code
                const result = await authManager.forgotPassword(step1Data.email);
                
                if (result.success) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Code renvoyé',
                        text: 'Un nouveau code a été envoyé à votre adresse email',
                        timer: 2000,
                        showConfirmButton: false
                    });
                    
                    // Redémarrer le timer
                    startResendTimer();
                    
                    // Effacer les inputs
                    codeInputs.forEach(input => {
                        input.value = '';
                        input.classList.remove('filled');
                    });
                    codeInputs[0].focus();
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Erreur',
                        text: result.message || 'Impossible de renvoyer le code',
                        confirmButtonColor: '#D97706'
                    });
                }
            } catch (err) {
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur de connexion',
                    text: 'Impossible de contacter le serveur',
                    confirmButtonColor: '#D97706'
                });
            } finally {
                // Réactiver le bouton (le timer le gérera)
                resendCodeBtn.disabled = false;
                resendCodeBtn.innerHTML = 'Renvoyer le code';
            }
        });

        // Vérification du code
        nextStep2Btn?.addEventListener('click', async () => {
            // Récupérer le code
            let code = '';
            codeInputs.forEach(input => {
                code += input.value;
            });
            
            if (code.length !== 6) {
                showValidation('codeValidation', 'Code à 6 chiffres requis', false);
                return;
            }
            
            // Désactiver le bouton
            nextStep2Btn.disabled = true;
            nextStep2Btn.innerHTML = '<div class="spinner"></div>';
            
            try {
                // Appeler l'API de vérification
                const result = await authManager.registerStep2(code, verificationToken);
                
                if (result.success) {
                    goToStep(3);
                    verificationToken = result.token;
                } else {

                    // Si token invalide/expiré
                    if (result.error?.includes('Token') || result.message?.includes('Token') || result.message?.includes('expiré')) {
                        clearProgress();
                        Swal.fire({
                            icon: 'error',
                            title: 'Session expirée',
                            text: 'Votre session a expiré. Veuillez recommencer l\'inscription.',
                            confirmButtonColor: '#D97706'
                        }).then(() => {
                            goToStep(1);
                        });
                        return;
                    }
    
                    showValidation('codeValidation', result.message || 'Code invalide', false);
                    
                    // Effacer les inputs en cas d'erreur
                    codeInputs.forEach(input => {
                        input.value = '';
                        input.classList.remove('filled');
                    });
                    codeInputs[0].focus();
                }
            } catch (err) {
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur de vérification',
                    text: 'Impossible de vérifier le code',
                    confirmButtonColor: '#D97706'
                });
            } finally {
                // Réactiver le bouton
                nextStep2Btn.disabled = false;
                nextStep2Btn.innerHTML = 'Vérifier <i class="bi bi-check-lg"></i>';
            }
        });

        // ============================================
        // ÉTAPE 3: PROFIL
        // ============================================
        // Retour à l'étape 2
        prevStep3Btn?.addEventListener('click', async () => {
            await goToStep(2);
        });

        
        // Passer l'étape profil
        skipProfileBtn?.addEventListener('click', async () => {
            // Créer un profil minimal
            const profileData = {
                firstName: '',
                lastName: '',
                phone: '',
                company: '',
                address: '',
                bio: ''
            };
            
            await completeRegistration(profileData);
        });

        // Soumission finale
        submitBtn?.addEventListener('click', async () => {
            const profileData = {
                firstName: document.getElementById('firstName').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                phone: document.getElementById('phone').value.trim(),
                company: document.getElementById('company').value.trim(),
                address: document.getElementById('address').value.trim(),
                bio: document.getElementById('bio').value.trim()
            };
            
            await completeRegistration(profileData);
        });

        async function completeRegistration(profileData) {
            // Désactiver les boutons
            submitBtn.disabled = true;
            skipProfileBtn.disabled = true;
            submitBtn.innerHTML = '<div class="spinner"></div> Création...';
            
            try {
                const saved = localStorage.getItem('secura_registration');
                const progress = JSON.parse(saved);
       

        
                const result = await authManager.registerStep3(profileData, progress.verificationToken);
                
                if (result.success) {
                    clearProgress();
                    Swal.fire({
                        icon: 'success',
                        title: 'Compte créé !',
                        text: 'Votre compte a été créé avec succès',
                        timer: 2000,
                        showConfirmButton: false,
                        willClose: () => {
                            if (result.user?.role === 'admin') {
                                window.location.href = '/dashboard.html';
                            } else {
                                window.location.href = '/home.html';
                            }
                        }
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'Erreur',
                        text: result.message || 'Erreur lors de la création du compte',
                        confirmButtonColor: '#D97706'
                    });
                }
            } catch (err) {
                Swal.fire({
                    icon: 'error',
                    title: 'Erreur de connexion',
                    text: 'Impossible de finaliser l\'inscription',
                    confirmButtonColor: '#D97706'
                });
            } finally {
                // Réactiver les boutons
                submitBtn.disabled = false;
                skipProfileBtn.disabled = false;
                submitBtn.innerHTML = '<i class="bi bi-check-circle"></i> Terminer l\'inscription';
            }
        }


stepItems.forEach(item => {
    item.addEventListener('click', async () => {
        const step = parseInt(item.dataset.step);
        if (step < currentStep) {
            await goToStep(step);
        }
    });
});

        // ============================================
        // INITIALISATION
        // ============================================
        document.addEventListener('DOMContentLoaded', async () => {
           
            // Vérifier si déjà connecté
            const token = localStorage.getItem('secura_token');
            if (token) {
                window.location.href = '/dashboard.html';
            }


    // Charger la progression
    const savedProgress = await loadProgress();
    
    if (savedProgress) {
        // Demander à l'utilisateur s'il veut reprendre
        Swal.fire({
            title: 'Reprendre l\'inscription?',
            text: 'Une inscription en cours a été détectée. Souhaitez-vous reprendre là où vous en étiez?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Oui, reprendre',
            cancelButtonText: 'Non, recommencer',
            confirmButtonColor: '#D97706'
        }).then((result) => {
            if (result.isConfirmed) {
                currentStep = savedProgress.currentStep;
                step1Data = savedProgress.step1Data || {};
                verificationToken = savedProgress.verificationToken || '';
                
                if (step1Data.email) {
                    emailInput.value = step1Data.email;
                    verificationEmail.textContent = step1Data.email;
                }
                
                updateProgress();
                
                setTimeout(() => {
                    switch(currentStep) {
                        case 1: emailInput?.focus(); break;
                        case 2: codeInputs[0]?.focus(); break;
                        case 3: document.getElementById('firstName')?.focus(); break;
                    }
                }, 100);
                
                if (currentStep === 2) {
                    startResendTimer();
                }
            } else {
                clearProgress();
                emailInput?.focus();
            }
        });
    } else {
        emailInput?.focus();
    }
            
function adjustLayout() {
    const formPanel = document.querySelector('.form-panel');
    const progressPanel = document.querySelector('.progress-panel');
    
    if (window.innerWidth <= 992) {
        // Mode mobile
        formPanel.style.maxHeight = 'none';
        formPanel.style.overflowY = 'visible';
        
        // Assurer que le contenu n'est pas coupé
        const activeContent = document.querySelector('.step-content.active');
        if (activeContent) {
            activeContent.style.minHeight = 'auto';
        }
    } else {
        // Mode desktop
        const activeContent = document.querySelector('.step-content.active');
        if (activeContent && formPanel) {
            const neededHeight = activeContent.scrollHeight + 80;
            const maxHeight = window.innerHeight - 200;
            
            if (neededHeight > maxHeight) {
                formPanel.style.maxHeight = `${maxHeight}px`;
                formPanel.style.overflowY = 'auto';
            } else {
                formPanel.style.maxHeight = 'none';
                formPanel.style.overflowY = 'visible';
            }
        }
    }
}

// Appeler cette fonction au chargement et au redimensionnement
window.addEventListener('load', adjustLayout);
window.addEventListener('resize', adjustLayout);

// Et aussi quand on change d'étape
const stepObserver = new MutationObserver(adjustLayout);
const formPanel = document.querySelector('.form-panel');
if (formPanel) {
    stepObserver.observe(formPanel, { childList: true, subtree: true });
}


window.addEventListener('beforeunload', (e) => {
    if (currentStep > 1 && !e.defaultPrevented) {
        saveProgress(currentStep);
    }
});

window.addEventListener('pageshow', (event) => {
    if (event.persisted) {
        const token = localStorage.getItem('secura_token');
        if (token) {
            clearProgress();
        }
    }
});
            
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="js/toastify.js"></script>
</body>
</html>