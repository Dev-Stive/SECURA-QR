<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SECURA - Scanner QR Code</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/dash.css">
    
</head>
<body class="light-theme">
    <div id="particles-js"></div>

 
 <!-- Header Premium -->
<header class="header">
    <div class="header-content">
        <div class="logo-section">
            <div class="logo-icon">
                <i class="bi bi-shield-check"></i>
            </div>
            <div class="logo-text">
                <h1>SECURA</h1>
                <p>Tableau de Bord • Gestion Sécurisée</p>
            </div>
        </div>

        <nav class="nav-menu" id="navMenu">
            <a href="index.html" class="nav-link ">Accueil</a>
            <a href="events.html" class="nav-link">Événements</a>
            <a href="guests.html" class="nav-link">Invités</a>
            <a href="qr-generator.html" class="nav-link">Générateur QR</a>
            <a href="ticket-generator.html" class="nav-link">Billets</a>
            <a href="scanner.html" class="nav-link active">Scanner</a>
        </nav>

        <div class="header-actions">
            <button class="theme-toggle" id="themeToggle" aria-label="Changer le thème">
                <i class="fas fa-moon"></i>
            </button>
            <button class="fullscreen-toggle" id="fullscreenToggle" aria-label="Plein écran">
                <i class="fas fa-expand"></i>
            </button>
            <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Menu">
                <i class="fas fa-bars"></i>
            </button>
        </div>

        <!-- BOUTON PROFIL DANS LE HEADER -->
        <button class="profile-toggle header-profile-btn" id="profileToggle" aria-haspopup="true" aria-expanded="false">
            <div class="profile-avatar">
                <i class="bi bi-person-circle"></i>
            </div>
            <div class="profile-info">
                <span class="profile-name" id="profileName">Chargement...</span>
                <span class="profile-role" id="profileRole">Utilisateur</span>
            </div>
            <i class="bi bi-chevron-down profile-arrow"></i>
        </button>
    </div>
</header>

<!-- MENU PROFIL FLOTTANT (HORS HEADER) -->
<div class="floating-profile-menu" id="floatingProfileMenu">
    <div class="profile-dropdown show" id="profileDropdown" role="menu">
        <div class="profile-header">
            <div class="profile-avatar large">
                <i class="bi bi-person-circle"></i>
            </div>
            <div class="profile-details">
                <strong id="dropdownName">Chargement...</strong>
                <small id="dropdownEmail">email@exemple.com</small>
                <span class="badge-role" id="dropdownRole">Utilisateur</span>
            </div>
        </div>

        <div class="dropdown-actions">
            <a href="profile.html" class="dropdown-item" role="menuitem">
                <i class="bi bi-person"></i> Mon Profil
            </a>
            <a href="settings.html" class="dropdown-item" role="menuitem">
                <i class="bi bi-gear"></i> Paramètres
            </a>
            <hr class="dropdown-divider">
            <button class="dropdown-item text-danger" id="logout-btn" role="menuitem">
                <i class="bi bi-box-arrow-right"></i> Déconnexion
            </button>
        </div>
    </div>
</div>

    <!-- Hero Section -->
  

    <main class="main-content">
        <div class="container">
            <div class="page-header animate-fade-in">
                <div>
                    <h1><i class="fas fa-camera"></i> Scanner QR Code</h1>
                    <p>Scannez les QR Codes des invités pour valider leur présence</p>
                </div>
            </div>

            <div class="scanner-container">
                <div class="scanner-panel">
                    <div class="scanner-modes">
                        <button class="mode-btn active" id="cameraModeBtn"><i class="fas fa-camera"></i> <span>Caméra</span></button>
                        <button class="mode-btn" id="fileModeBtn"><i class="fas fa-image"></i> <span>Image</span></button>
                    </div>

                    <div class="scanner-view" id="cameraScanner">
                        <div class="camera-container">
                            <video id="cameraPreview" autoplay muted playsinline></video>
                            <canvas id="scannerCanvas"></canvas>
                            <div class="scanner-overlay"><div class="scan-region"></div></div>
                        </div>

                        <!-- NOUVEAU : zone capture -->
                        <div id="capturePreview" class="capture-preview" style="display:none;">
                           <img id="capturedPreview" alt="Capture" style="display:none; width:100%; border-radius:12px;">
                            <div class="capture-actions">
                                <button class="btn btn-success" id="analyzeCaptureBtn">
                                    <i class="fas fa-search"></i> Analyser cette photo
                                </button>
                                <button class="btn btn-outline" id="newScanBtn"><i class="fas fa-redo"></i> Nouveau scan</button>
                            </div>
                        </div>

                        <div class="scanner-controls">
                            <button class="btn btn-primary" id="startScanBtn">
                                <i class="fas fa-play"></i> Démarrer caméra
                            </button>
                            <button class="btn btn-danger" id="stopScanBtn" style="display:none;">
                                <i class="fas fa-stop"></i> Arrêter
                            </button>
                            <button class="btn btn-warning" id="captureBtn" style="display:none;">
                                <i class="fas fa-camera"></i> CAPTURER
                            </button>
                            <select id="cameraSelect" class="form-input" style="display:none;"></select>
                        </div>
                    </div>

                    <div class="scanner-view" id="fileScanner" style="display: none;">
                        <div class="file-upload-zone" id="qrFileDropZone">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <p>Glissez une image</p>
                            <p class="text-sm">ou</p>
                            <button type="button" class="btn btn-secondary" onclick="document.getElementById('qrFileInput').click()">Choisir</button>
                            <input type="file" id="qrFileInput" accept="image/*" style="display: none;">
                        </div>
                        <div id="filePreview" style="display: none;">
                            <img id="uploadedImage" alt="QR Code">
                            <button class="btn btn-primary" id="scanImageBtn"><i class="fas fa-search"></i> Analyser</button>
                        </div>
                    </div>
                </div>

                <div class="results-panel">
                    <h3><i class="fas fa-clipboard-check"></i> Résultat</h3>
                    <div class="scan-result-placeholder" id="scanPlaceholder">
                        <i class="fas fa-qrcode"></i> <p>En attente...</p>
                    </div>
                    <div class="scan-result-card" id="scanResult" style="display: none;">
                        <div class="result-header">
                            <div class="status-badge success" id="resultStatus"><i class="fas fa-check-circle"></i> <span>Valide</span></div>
                            <span class="scan-time" id="scanTime"></span>
                        </div>
                        <div class="welcome-message" id="welcomeMessage"></div>
                        <div class="guest-details">
                            <div class="detail-row"><span class="detail-label"><i class="fas fa-user"></i> Invité:</span> <span class="detail-value" id="resultName">-</span></div>
                            <div class="detail-row"><span class="detail-label"><i class="fas fa-envelope"></i> Email:</span> <span class="detail-value" id="resultEmail">-</span></div>
                            <div class="detail-row"><span class="detail-label"><i class="fas fa-phone"></i> Téléphone:</span> <span class="detail-value" id="resultPhone">-</span></div>
                            <div class="detail-row"><span class="detail-label"><i class="fas fa-calendar"></i> Événement:</span> <span class="detail-value" id="resultEvent">-</span></div>
                            <div class="detail-row"><span class="detail-label"><i class="fas fa-clock"></i> Date & Heure:</span> <span class="detail-value" id="resultDateTime">-</span></div>
                            <div class="detail-row"><span class="detail-label"><i class="fas fa-clock"></i> Note:</span> <span class="detail-value" id="resultNote">-</span></div>
                            <div class="detail-row"><span class="detail-label"><i class="fas fa-map-marker-alt"></i> Lieu:</span> <span class="detail-value" id="resultLocation">-</span></div>
                        </div>
                        <div class="result-actions">
                            <button class="btn btn-success" id="markPresentBtn"><i class="fas fa-check"></i> Marquer présent</button>
                            <button class="btn btn-outline" id="newScan"><i class="fas fa-redo"></i> Nouveau scan</button>
                        </div>
                    </div>

                    <div class="scan-history">
                        <h4><i class="fas fa-history"></i> Historique <span class="badge" id="scanCount">0</span></h4>
                        <div class="history-list" id="scanHistory"></div>
                    </div>
                </div>
            </div>

            <div class="scan-statistics">
                <h3><i class="fas fa-chart-bar"></i> Statistiques du jour</h3>
             

        <div class="container">
            <div class="stats-grid">
                <div class="stat-card animate-slide-up">
                    <div class="stat-icon">
                        <i class="bi bi-clock"></i>
                    </div>
                    <div class="stat-value" id="lastScanTime">0</div>
                    <div class="stat-label">Dernier</div>
                </div>
               
                <div class="stat-card animate-slide-up">
                    <div class="stat-icon">
                        <i class="bi bi-qr-code"></i>
                    </div>
                    <div class="stat-value" id="todayPresent">0</div>
                    <div class="stat-label">Présents</div>
                </div>
                <div class="stat-card animate-slide-up">
                    <div class="stat-icon">
                        <i class="bi bi-upc-scan"></i>
                    </div>
                    <div class="stat-value" id="todayScans">0</div>
                    <div class="stat-label">Scans</div>
                </div>
            </div>
            </div>
     
</div>

        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                <div class="d-flex align-items-center gap-2">
                    <i class="bi bi-shield-check" style="font-size:1.5rem;"></i>
                    <span style="font-weight:600;">SECURA</span>
                </div>
                <p class="mb-0">© 2025 SECURA. Tous droits réservés.</p>
                <div class="d-flex gap-3">
                    <a href="#" class="footer-link">Confidentialité</a>
                    <a href="#" class="footer-link">Conditions</a>
                    <a href="#" class="footer-link">Support</a>
                </div>
            </div>
        </div>
    </footer>

    <button class="scroll-top" id="scrollTop"><i class="fas fa-arrow-up"></i></button>



    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

     <!-- Précharge audio -->
      <script src="js/audio-utils.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                SECURA_AUDIO.preload();
            });
        </script>


    <script src="js/particles-config.js"></script>
    <script src="js/theme.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/scanner.js"></script>
    <script src="js/main.js"></script>
</body>
